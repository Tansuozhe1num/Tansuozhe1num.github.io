<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Codeforces-1007div2题解</title>
    <url>/2025/03/01/Codeforces-1007div2%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="A-D1题解"><a href="#A-D1题解" class="headerlink" title="A - D1题解"></a>A - D1题解</h2><p>连续掉分ing, 什么时候才能变得又快又猛呢hehehe。。。</p>
<h2 id="A-The-Play-Never-Ends"><a href="#A-The-Play-Never-Ends" class="headerlink" title="A. The Play Never Ends"></a>A. The Play Never Ends</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i64 k;</span><br><span class="line">    cin &gt;&gt; k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (k % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Yes\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="B-Perfecto"><a href="#B-Perfecto" class="headerlink" title="B. Perfecto"></a>B. Perfecto</h2><p>打表观察 从 1 到 300 sum的和是平方数的数字，发现和是平方数的只有  1 36 1225…..， 想要不出现平方数，只需要在前 i 个（其中 i 是使得sum是平方数的数字）不全是i的排列，也就是把每个满足和是平方数的最后一个数字和下一个数字替换，如果不超出范围就可以，否则-1</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i64 n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    i64 sum = <span class="number">0</span>;</span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        a[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        sum += a[i];</span><br><span class="line">        i64 g = <span class="built_in">sqrt</span>(sum);</span><br><span class="line">        <span class="keyword">if</span> (g * g == sum) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i + <span class="number">1</span> &gt; n) &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;-1&quot;</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            sum -= a[i];</span><br><span class="line">            <span class="built_in">swap</span>(a[i], a[i + <span class="number">1</span>]);</span><br><span class="line">            sum += a[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cout &lt;&lt; a[i] &lt;&lt; <span class="string">&quot; \n&quot;</span>[i == n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    i64 t;</span><br><span class="line">    cin &gt;&gt; t;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="C-Trapmigiano-Reggiano"><a href="#C-Trapmigiano-Reggiano" class="headerlink" title="C. Trapmigiano Reggiano"></a>C. Trapmigiano Reggiano</h2><p> 以en为根， 对树进行分层，每次取深度较大的节点，之后取深度较小的节点，走最深的情况是一条链，这时候会走 n / 2个点，之后n / 2个操作又会回到根，其他情况会在某条最长链的某个节点来后跳（因为有别的树链），如果最后回到原点直接输出，否则-1</p>
<blockquote>
<p>update: 看了大佬们说答案似乎不可能出现-1， 好像可以直接后序遍历，答案总会存在</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> inf = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, st, en;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; st &gt;&gt; en;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">e</span>(n + <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        e[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        e[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dis</span><span class="params">(n + <span class="number">1</span>, <span class="number">-1</span>)</span></span>;</span><br><span class="line">    dis[en] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> dfs = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u, <span class="type">int</span> fa) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v : e[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">                dis[v] = dis[u] + <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">self</span>(self, v, u);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">dfs</span>(dfs, en, <span class="number">-1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        ans[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(ans.<span class="built_in">begin</span>() + <span class="number">1</span>, ans.<span class="built_in">end</span>(), </span><br><span class="line">        [&amp;](<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">            <span class="keyword">return</span> dis[a] &gt; dis[b];</span><br><span class="line">        &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//cerr &lt;&lt; &quot;dis:&quot; &lt;&lt; dis[st] &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    <span class="keyword">if</span> (dis[st] == <span class="number">-1</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;-1\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            cout &lt;&lt; ans[i] &lt;&lt; <span class="string">&quot; \n&quot;</span>[i == n];</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="D1-Infinite-Sequence-Easy-Version"><a href="#D1-Infinite-Sequence-Easy-Version" class="headerlink" title="D1. Infinite Sequence (Easy Version)"></a>D1. Infinite Sequence (Easy Version)</h2><p> 手玩样例， 发现 7 = 8, 78 = 79……, 那么每对在 “^” 内（也就是除以二一样）的数字总是一样的，他们作为下一个数字的异或和的时候总是不做贡献，可以忽略。</p>
<p>我们不妨补全给定的n数组，使得n总是奇数（这样下一位置开始时候总是出现两两相等情况）</p>
<p>继续观察，发现</p>
<ul>
<li>当 x / 2是奇数时候，这时除了前n个给定的数字，其他总是两两成对出现， 此时 x = s[ n ] &amp; 1;</li>
<li>当 x / 2是偶数的时候，除了x / 2,在n + 1到x / 2之间的所有数字都是成对出现，不参与计算，故 x = s[ n ] &amp; (x / 2),</li>
</ul>
<p>这样递归下去可以找到答案，最坏时间复杂度为o(logn);</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i64 n, l, r;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; l &gt;&gt; r;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">s</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        s[i] = s[i - <span class="number">1</span>] + a[i];</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        n++;</span><br><span class="line">        a.<span class="built_in">push_back</span>(s[n / <span class="number">2</span>] &amp; <span class="number">1</span>);</span><br><span class="line">        s.<span class="built_in">push_back</span>(s[n - <span class="number">1</span>] + a[n]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> f = [&amp;](<span class="keyword">auto</span> self, i64 x) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= n) &#123;</span><br><span class="line">            <span class="keyword">return</span> a[x];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x / <span class="number">2</span> &lt;= n) &#123;</span><br><span class="line">            <span class="keyword">return</span> (s[x / <span class="number">2</span>] &amp; <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> g;</span><br><span class="line">        <span class="keyword">if</span> ((((x / <span class="number">2</span>) - n) &amp; <span class="number">1</span>)) &#123;</span><br><span class="line">            g = <span class="built_in">self</span>(self, x / <span class="number">2</span>) ^ (s[n] &amp; <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            g = (s[n] &amp; <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> g;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (l &lt;= n * 2) &#123;</span></span><br><span class="line">    <span class="comment">//     for (int i = n + 1; i &lt;= l; i++) &#123;</span></span><br><span class="line">    <span class="comment">//         a.push_back(s[i / 2] &amp; 1);</span></span><br><span class="line">    <span class="comment">//         s.push_back(a[i] + s[i - 1]);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//     cout &lt;&lt; a[l] &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="built_in">f</span>(f, l) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>codeforce题解</category>
      </categories>
      <tags>
        <tag>codeforce</tag>
      </tags>
  </entry>
  <entry>
    <title>CodeTonRound4-div1+div2题解</title>
    <url>/2025/02/27/CodeTonRound4-div1-div2%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="题解-A-E"><a href="#题解-A-E" class="headerlink" title="题解 A - E"></a>题解 A - E</h2><hr>
<blockquote>
<p>Dream is so far ~</p>
</blockquote>
<h4 id="A-Beautiful-Sequence"><a href="#A-Beautiful-Sequence" class="headerlink" title="A. Beautiful Sequence"></a>A. Beautiful Sequence</h4><p>检查每一位对应的数字是否小于等于位置，如果可以说明这个数字可以移动到对应位置上， 遍历即可</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] &lt;= i) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Yes\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="B-Candies"><a href="#B-Candies" class="headerlink" title="B. Candies"></a>B. Candies</h4><p>考虑到从一开始往后面变，且每次只能变为 $2 <em> n - 1$ 或 $2 </em> n + 1$ ， 显然这些数都是奇数， 考虑从末位往前处理， 每次除以二如果是奇数说明这一次选了2来到这一步，否则将除以二结果加一，同时意味着这一步选了1。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i64 n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">    <span class="keyword">while</span> (n != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="type">int</span> now = n / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (!(now &amp; <span class="number">1</span>)) &#123;</span><br><span class="line">            now ++;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        n = now;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans.<span class="built_in">size</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = ans.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        cout &lt;&lt; ans[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="C-Make-It-Permutation"><a href="#C-Make-It-Permutation" class="headerlink" title="C. Make It Permutation"></a>C. Make It Permutation</h4><p>首先考虑有一个以上数字，显然需要使用第二步操作去掉（否则将不会形成一排列），<br>之后对于去重后数组， 将其排序， 从后面往前面dp过去， 考虑把后面全部删掉或者是在这两位之间补齐剩下的数字， 有<br>$dp[i] = min(dp[i + 1] + (b[i + 1] - b[i] - 1) <em> d, c </em> (nn - 1 - i));$<br>即当前位置最小需要等于上一位到这一位之间需要补齐数字和把后面全部删掉的数字。<br>注意一开始的1要补上（if no one in this array)</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i64 n, c, d;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; c &gt;&gt; d;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(a.<span class="built_in">begin</span>() + <span class="number">1</span>, a.<span class="built_in">end</span>());</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; b;</span><br><span class="line"></span><br><span class="line">    i64 sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (a[<span class="number">1</span>] != <span class="number">1</span>) &#123;</span><br><span class="line">        b.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">        sum += d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    b.<span class="built_in">push_back</span>(a[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] == a[i - <span class="number">1</span>]) &#123;</span><br><span class="line">            sum += c;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        b.<span class="built_in">push_back</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> nn = b.<span class="built_in">size</span>();</span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">dp</span><span class="params">(nn)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = nn - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        dp[i] = <span class="built_in">min</span>&lt;i64&gt;(dp[i + <span class="number">1</span>] + (b[i + <span class="number">1</span>] - b[i] - <span class="number">1</span>) * d, c * (nn - <span class="number">1</span> - i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; dp[<span class="number">0</span>] + sum &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="D-Climbing-The-Tree"><a href="#D-Climbing-The-Tree" class="headerlink" title="D. Climbing The Tree"></a>D. Climbing The Tree</h4><p>蜗牛爬树，很好玩的数学题， 直接给代码 ： 思路见代码</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fun</span> <span class="params">(<span class="type">int</span> h, <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (h &lt;= x) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">ceil</span> ( (h - x) * <span class="number">1.0</span> / (x - y) ) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> q;</span><br><span class="line">    cin &gt;&gt; q;</span><br><span class="line">    <span class="type">bool</span> f = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> l, r;</span><br><span class="line">    <span class="keyword">while</span> (q --) &#123;</span><br><span class="line">        <span class="type">int</span> op, a, b, n;</span><br><span class="line">        cin &gt;&gt; op &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line">            cin &gt;&gt; n;</span><br><span class="line">            <span class="keyword">if</span> (!f) &#123;</span><br><span class="line">                <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">                    l = <span class="number">1</span>;</span><br><span class="line">                    r = a;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    l = a * n - b * n - a + <span class="number">2</span> * b + <span class="number">1</span>;</span><br><span class="line">                    r = a * n - b * n + b;</span><br><span class="line">                &#125;</span><br><span class="line">                f = <span class="literal">true</span>;</span><br><span class="line">                cout &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> x, y;</span><br><span class="line">                <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">                    x = <span class="number">1</span>;</span><br><span class="line">                    y = a;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    x = a * n - b * n - a + <span class="number">2</span> * b + <span class="number">1</span>;</span><br><span class="line">                    y = a * n - b * n + b;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">max</span> (x, l) &gt; <span class="built_in">min</span> (y, r) ) cout &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    l = <span class="built_in">max</span> (x, l);</span><br><span class="line">                    r = <span class="built_in">min</span> (y, r);</span><br><span class="line">                    cout &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!f) cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">fun</span> (l, a, b) == <span class="built_in">fun</span> (r, a, b) ) cout &lt;&lt; <span class="built_in">fun</span> (l, a, b) &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">                <span class="keyword">else</span> cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (t --) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="E-Monster"><a href="#E-Monster" class="headerlink" title="E. Monster"></a>E. Monster</h4><p>给出一张图， 点 u 的遍历需要先经过这一个点所需权值 a[ u ] 个点后才可遍历， 一开始想这道题会想着先选出所有点权为 0 的点， 以这个点作为起点开始bfs 维护一个Krusal树，想着想着不知道怎么写了，换个了思路， 用一个小根堆记录当前能到达的点的相邻所有点， 一开始把所有0的点压入堆中， 用个变量记录当前已经走过的点的数量，之后每次从堆中取出一个点， 检查这个点的权是否小于已经走过的点的数量， 如果大于说明不能到达，直接停止（因为开的是小根堆）， 否则对这个点周围的点进行遍历，如果可以到达就让走过的点++ ， 否则压入堆中等待处理。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> inf = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> u, w;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> node&amp; a) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;w &gt; a.w; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">e</span>(n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        e[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        e[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vis</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> fun = [&amp;](<span class="type">int</span> s) -&gt; <span class="type">bool</span> &#123;</span><br><span class="line">        priority_queue&lt;node, vector&lt;node&gt;, greater&lt;node&gt;&gt; q;</span><br><span class="line">        <span class="comment">//queue&lt;int&gt; Q;</span></span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        q.<span class="built_in">push</span>(&#123;s, a[s]&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">auto</span> [u, w] = q.<span class="built_in">top</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span> (vis[u] == s) <span class="keyword">continue</span>;</span><br><span class="line">            vis[u] = s;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cnt &gt;= w) &#123;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) <span class="keyword">if</span> (vis[v] != s) &#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(&#123;v, a[v]&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//cerr &lt;&lt; &quot;cnt : &quot; &lt;&lt; cnt &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">        <span class="keyword">return</span> (cnt == n);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] == <span class="number">0</span> &amp;&amp; !vis[i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">fun</span>(i)) &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;Yes\n&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>codeforce题解</category>
      </categories>
      <tags>
        <tag>codeforce</tag>
      </tags>
  </entry>
  <entry>
    <title>Educational-codeforce-Round174题解</title>
    <url>/2025/02/27/Educational-codeforce-Round174%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<p><a href="https://codeforces.com/contest/2069">Edu174</a></p>
<h2 id="A-Was-there-an-Array"><a href="#A-Was-there-an-Array" class="headerlink" title="A Was there an Array?"></a>A Was there an Array?</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">观察题目发现如果给定的B[i] = 1, 左右都得是相等的， 如果出现了连续三个数字( i - 1, i , i + 1 ) 对应是 1 0 1，则有 a[i - 1] = a[ i ], a[ i ] = a[i + 1],  得出 a[i - 1] = a[i + 1], 但是i == 0 又推出 a[i - 1] != a[i + 1]矛盾，所以只需要判断一下是否出现了这种结构即可</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">b</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; b[i];</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b[i] == <span class="number">0</span> &amp;&amp; b[i - <span class="number">1</span>] == <span class="number">1</span> &amp;&amp; b[i + <span class="number">1</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Yes\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="B-Set-of-Strangers"><a href="#B-Set-of-Strangers" class="headerlink" title="B. Set of Strangers"></a>B. Set of Strangers</h2><p>观察到如果出现有相邻的相同数字，则对应数字需要操作两次才能变成另外一个数字，如果没有出现相邻，那么同一种数字总是需要1次即可完成操作，</p>
<p>暴力统计每个数字需要的操作次数，取最小的 n - 1 次累计求和就是答案。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="type">int</span> way[<span class="number">4</span>][<span class="number">2</span>] = &#123; <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span> &#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector <span class="title">a</span><span class="params">(n + <span class="number">1</span>, vector&lt;<span class="type">int</span>&gt; (m + <span class="number">1</span>))</span>, <span class="title">vis</span><span class="params">(n + <span class="number">1</span>, vector&lt;<span class="type">int</span>&gt; (m + <span class="number">1</span>))</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            cin &gt;&gt; a[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line">    <span class="type">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span> dfs = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> g) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        vis[x][y] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> dx = x + way[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> dy = y + way[i][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (dx &lt;= <span class="number">0</span> || dy &lt;= <span class="number">0</span> || dx &gt; n || dy &gt; m || vis[dx][dy] || a[dx][dy] != g) <span class="keyword">continue</span>;</span><br><span class="line">            f = <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">self</span>(self, dx, dy, g);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis[i][j]) &#123;</span><br><span class="line">                f = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">dfs</span>(dfs, i, j, a[i][j]);</span><br><span class="line">                <span class="keyword">if</span> (f) &#123;</span><br><span class="line">                    mp[a[i][j]] = <span class="number">2</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!mp.<span class="built_in">count</span>(a[i][j])) &#123;</span><br><span class="line">                        mp[a[i][j]] = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [x, y] : mp) &#123;</span><br><span class="line">        b.<span class="built_in">push_back</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(b.<span class="built_in">begin</span>(), b.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; b.<span class="built_in">size</span>() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        ans += b[i];</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="C-Beautiful-Sequence"><a href="#C-Beautiful-Sequence" class="headerlink" title="C. Beautiful Sequence"></a>C. Beautiful Sequence</h2><p>我的思路 ： </p>
<p>题目要求Beautiful序列满足以下条件：</p>
<ol>
<li><strong>左侧条件</strong>：除第一个元素外，每个元素左侧存在一个比它小的元素。</li>
<li><strong>右侧条件</strong>：除最后一个元素外，每个元素右侧存在一个比它大的元素。</li>
</ol>
<p>当元素只能取1、2、3时，序列结构必为 <code>[1, 2, ..., 2, 3]</code>，原因如下：</p>
<h3 id="首元素必须为1"><a href="#首元素必须为1" class="headerlink" title="首元素必须为1"></a>首元素必须为1</h3><ul>
<li>若首元素为2或3，后续元素无法满足左侧条件（如首元素为2时只能接3，但长度不足；首元素为3时无后续元素）。</li>
</ul>
<h3 id="末元素必须为3"><a href="#末元素必须为3" class="headerlink" title="末元素必须为3"></a>末元素必须为3</h3><ul>
<li>若末元素非3（如1或2），倒数第二个元素无法满足右侧条件（如末元素为2时，右侧无更大元素）。</li>
</ul>
<h3 id="中间元素必须全为2"><a href="#中间元素必须全为2" class="headerlink" title="中间元素必须全为2"></a>中间元素必须全为2</h3><ul>
<li>中间元素不能为1（左侧无更小元素）或3（右侧无更大元素），因此只能由2构成，且至少包含一个2（长度≥3）。</li>
</ul>
<p>综上，Beautiful序列的结构必为：</p>
<p> [ 1 2 2 2   … 3 ]</p>
<hr>


统计所有满足条件的子序列：
1. 选择一个1的位置`i`作为首元素。
2. 选择一个3的位置`j`（`j > i`）作为末元素。
3. 中间区间`(i, j)`中至少有一个2，且所有元素为2。

设区间`(i, j)`中有`c`个2，则中间部分的子序列组合数为：
$$
2^c - 1
$$

总答案为所有`(i, j)`对的组合数之和：
$$
\text{ans} = \sum_{\substack{i: a[i]=1}} \sum_{\substack{j>i: a[j]=3}} \left(2^{\text{\#}\{k \in (i,j): a[k]=2\}} - 1\right)
$$

---

### 前缀和数组
定义前缀和数组`P`，其中：
$$
P[i] = \text{数组前}i\text{个元素中2的个数}
$$
区间`(i, j)`中2的数量为：
$$
P[j-1] - P[i]
$$

### 优化内层求和
将内层求和转换为线性遍历：
- 对于每个位置`j`（`a[j]=3`），计算`X = P[j-1]`。
- 累加所有`i < j`且`a[i]=1`的贡献：
  $$
  \sum_{\substack{i: a[i]=1 \\ i < j}} \left(2^{X - P[i]} - 1\right)
  $$

通过分解公式：
$$
2^{X - P[i]} = 2^X \cdot 2^{-P[i]}
$$
定义累加量：
- `sumInv`：所有左侧1对应的`2^{-P[i]`之和。
- `cntOne`：左侧1的个数。

则当前`j`的贡献为：
$$
2^X \cdot \text{sumInv} - \text{cntOne}
$$

### 实现步骤
1. **遍历数组**，维护前缀和`P`。
2. **遇到1时**：更新`cntOne`和`sumInv += 2^{-P[i]}`。
3. **遇到3时**：根据当前`X = P[j-1]`计算贡献并累加。

---

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="结构限制"><a href="#结构限制" class="headerlink" title="结构限制"></a>结构限制</h3><ul>
<li>Beautiful序列严格遵循<code>[1, 2, ..., 2, 3]</code>形式，中间至少一个2。</li>
</ul>
<h3 id="计数公式"><a href="#计数公式" class="headerlink" title="计数公式"></a>计数公式</h3><ul>
<li>每个合法的<code>(i, j)</code>对贡献为<code>2^&#123;中间2的个数&#125; - 1</code>。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> T <span class="title">power</span><span class="params">(T a, i64 b, T mod)</span> </span>&#123;</span><br><span class="line">    T res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; b; b /= <span class="number">2</span>, a = a * a % mod) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b % <span class="number">2</span>) &#123;</span><br><span class="line">            res = (res * a) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200005</span>;</span><br><span class="line"><span class="function">vector&lt;i64&gt; <span class="title">pow2</span><span class="params">(N)</span>, <span class="title">inv</span><span class="params">(N)</span></span>;</span><br><span class="line"></span><br><span class="line">i64 inv2 = <span class="built_in">power</span>&lt;i64&gt;(<span class="number">2</span>, mod - <span class="number">2</span>, mod);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">P</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        P[i] = P[i - <span class="number">1</span>] + (a[i] == <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i64 one = <span class="number">0</span>, sum = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[j] == <span class="number">1</span>) &#123;</span><br><span class="line">            one = (one + <span class="number">1</span>) % mod;</span><br><span class="line">            sum = (sum + inv[P[j]]) % mod;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a[j] == <span class="number">2</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> X = P[j - <span class="number">1</span>];</span><br><span class="line">            i64 g = ((pow2[X] * sum) % mod - one) % mod;</span><br><span class="line">            <span class="keyword">if</span> (g &lt; <span class="number">0</span>) g += mod;</span><br><span class="line">            ans = (ans + g) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; ans % mod &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    pow2[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        pow2[i] = (pow2[i - <span class="number">1</span>] * <span class="number">2</span>) % mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inv[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</span><br><span class="line">        inv[i] = (inv[i - <span class="number">1</span>] * inv2) % mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>题解dp思路 :<br> 等我看完了再update</p>
<h2 id="D-Palindrome-Shuffle"><a href="#D-Palindrome-Shuffle" class="headerlink" title="D. Palindrome Shuffle"></a>D. Palindrome Shuffle</h2><p>首先知道前后本来就回文的字母可以先移除，所以只需要处理一个前后两个字母不一样的字符串即可，那么问题就变成处理一个字符串S， 只能重新排列S的某个前缀或者后缀子串使得它变成Palindrome</p>
<p>来看样例4 : </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">acbacddacbca</span><br></pre></td></tr></table></figure>
<p>可以看出需要再4 - 5进行操作，那么也可以在 4 - 6, 4 - 7 等等长度大于他的子串（只需要包含他）进行操作，即长度具有单调性，可以使用二分答案。</p>
<p>我们处理从前开始翻转情况，那么从后开始翻转情况可以reverse后套用从前面开始的情况进行操作。</p>
<p> <strong>check函数</strong>：</p>
<blockquote>
<p>首先统计待处理字符串中每个字母出现的次数，之后分两种情况 : </p>
</blockquote>
<ul>
<li><p>情况一 ： <strong>L（左字符串起始位置） + len - 1 &lt;= n / 2</strong><br>此时和样例4一样，需要在len范围内前缀和后缀里面的所有字符数量相同，同时保证没操作到的字符本来就是回文的（可以多开一个数组预处理记录，看代码is, ned部分）</p>
<ul>
<li>情况二 ： <strong>L（左字符串起始位置） + len - 1 &gt; n / 2</strong><br>只需要左边的每个字符数量全部<strong>大于或等于</strong>右边剩下的即可。</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    cin &gt;&gt; s;</span><br><span class="line"></span><br><span class="line">    s = <span class="string">&#x27; &#x27;</span> + s;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = s.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = n;</span><br><span class="line">    <span class="keyword">while</span> (s[l] == s[r] &amp;&amp; l &lt;= r) &#123;</span><br><span class="line">        l++, r--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l &gt; r) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">c</span><span class="params">(<span class="number">27</span> + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">        c[s[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">is</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">ned</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n / <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] != s[n - i + <span class="number">1</span>]) &#123;</span><br><span class="line">            is[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is[i + <span class="number">1</span>] == <span class="number">1</span> || ned[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            ned[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> ck = [&amp;](<span class="type">int</span> len) -&gt; <span class="type">bool</span> &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; <span class="built_in">g</span>(<span class="number">28</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= l + len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            g[s[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (l + len - <span class="number">1</span> &lt;= n / <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = r; i &gt;= r - len + <span class="number">1</span>; i--) &#123;</span><br><span class="line">                g[s[i] - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (g[i] != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ned[l + len - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (c[i] - g[i] &gt; g[i]) &#123;</span><br><span class="line">                    <span class="comment">//cout &lt;&lt; len &lt;&lt; &#x27; &#x27; &lt;&lt; char(i + &#x27;a&#x27;) &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> lo = <span class="number">2</span>, ri = r - l;</span><br><span class="line">    <span class="keyword">while</span> (lo &lt;= ri) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (lo + ri) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ck</span>(mid)) &#123;</span><br><span class="line">            ri = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lo = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = lo;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">reverse</span>(s.<span class="built_in">begin</span>() + <span class="number">1</span>, s.<span class="built_in">end</span>());</span><br><span class="line">    n = s.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    l = <span class="number">1</span>, r = n;</span><br><span class="line">    <span class="keyword">while</span> (s[l] == s[r] &amp;&amp; l &lt;= r) &#123;</span><br><span class="line">        l++, r--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l &gt; r) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">h</span><span class="params">(<span class="number">27</span> + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">        h[s[i] - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">is2</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">ned2</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n / <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] != s[n - i + <span class="number">1</span>]) &#123;</span><br><span class="line">            is2[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is2[i + <span class="number">1</span>] == <span class="number">1</span> || ned2[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            ned2[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ll = <span class="number">2</span>, rr = r - l;</span><br><span class="line">    <span class="keyword">while</span> (ll &lt;= rr) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (ll + rr) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ck</span>(mid)) &#123;</span><br><span class="line">            rr = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ll = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ans = <span class="built_in">min</span>(ans, ll);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>codeforce题解</category>
      </categories>
      <tags>
        <tag>codeforce</tag>
      </tags>
  </entry>
  <entry>
    <title>Educational codeforceRound 173 题解</title>
    <url>/2024/12/26/Educational-codeforceRound-173-%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">constexpr</span> i64 inf = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">tuple&lt;T, T, T&gt; <span class="title">MaxArray</span><span class="params">(<span class="type">const</span> vector&lt;T&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nums.<span class="built_in">size</span>() == <span class="number">1</span>) <span class="keyword">return</span> &#123;<span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    T cur = nums[<span class="number">1</span>], maxp = nums[<span class="number">1</span>];      </span><br><span class="line">    <span class="type">int</span> start = <span class="number">1</span>;              </span><br><span class="line">    <span class="type">int</span> le = <span class="number">1</span>;        </span><br><span class="line">    <span class="type">int</span> ri = <span class="number">1</span>;            </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt; nums.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur + nums[i] &lt; nums[i]) &#123;</span><br><span class="line">            cur = nums[i];</span><br><span class="line">            start = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cur += nums[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cur &gt; maxp) &#123;</span><br><span class="line">            maxp = cur;</span><br><span class="line">            le = start; </span><br><span class="line">            ri = i;       </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;le, ri, maxp&#125;; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> pos = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        <span class="keyword">if</span> (a[i] != <span class="number">1</span> &amp;&amp; a[i] != <span class="number">-1</span>) &#123;</span><br><span class="line">            pos = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pos == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">auto</span> [x, y, z] = <span class="built_in">MaxArray</span>&lt;i64&gt; (a);</span><br><span class="line">        i64 tp = <span class="built_in">max</span>(<span class="number">0LL</span>, z);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            a[i] = -a[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> [h, j, p] = <span class="built_in">MaxArray</span>&lt;i64&gt; (a);</span><br><span class="line"></span><br><span class="line">        i64 kp = <span class="built_in">max</span>(<span class="number">0LL</span>, p);</span><br><span class="line">        kp = -kp;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; tp - kp + <span class="number">1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = kp; i &lt;= tp; i++) &#123;</span><br><span class="line">            cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">l</span><span class="params">(<span class="number">1</span>)</span>, <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; pos; i++) &#123;</span><br><span class="line">        l.<span class="built_in">push_back</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos + <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        r.<span class="built_in">push_back</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [x, y, z] = <span class="built_in">MaxArray</span>(l);</span><br><span class="line">    z = <span class="built_in">max</span>(<span class="number">0LL</span>, z);</span><br><span class="line">    i64 lmax = z;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= l.<span class="built_in">size</span>() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        l[i] = -l[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [p, u, b] = <span class="built_in">MaxArray</span>(l);</span><br><span class="line">    b = <span class="built_in">max</span>(<span class="number">0LL</span>, b);</span><br><span class="line">    i64 lmin = -b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [gg, ee, f] = <span class="built_in">MaxArray</span>(r);</span><br><span class="line">    f = <span class="built_in">max</span>(<span class="number">0LL</span>, f);</span><br><span class="line">    i64 rmax = f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= r.<span class="built_in">size</span>() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        r[i] = -r[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [ioi, powp, w] = <span class="built_in">MaxArray</span>(r);</span><br><span class="line">    w = <span class="built_in">max</span>(w, <span class="number">0LL</span>);</span><br><span class="line">    i64 rmin = -w;</span><br><span class="line"></span><br><span class="line">    set&lt;i64&gt; is;</span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="built_in">min</span>(rmin, lmin); i &lt;= <span class="number">0</span>; i++) &#123;</span><br><span class="line">        is.<span class="built_in">insert</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="built_in">max</span>(lmax, rmax); i++) &#123;</span><br><span class="line">        is.<span class="built_in">insert</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i64 sum = <span class="number">0</span>;</span><br><span class="line">    i64 mp = <span class="number">0</span>;</span><br><span class="line">    i64 mi = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = pos + <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        sum += a[i];</span><br><span class="line">        mp = <span class="built_in">max</span>(<span class="number">0LL</span>, <span class="built_in">max</span>(mp, sum));</span><br><span class="line">        mi = <span class="built_in">min</span>(<span class="number">0LL</span>, <span class="built_in">min</span>(mi, sum));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i64 mmp = <span class="number">0</span>, mmi = <span class="number">0</span>;</span><br><span class="line">    sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i64 i = pos - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">        sum += a[i];</span><br><span class="line">        mmp = <span class="built_in">max</span>(<span class="number">0LL</span>, <span class="built_in">max</span>(mmp, sum));</span><br><span class="line">        mmi = <span class="built_in">min</span>(<span class="number">0LL</span>, <span class="built_in">min</span>(mmi, sum));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i64 tminp = mmi + mi;</span><br><span class="line">    i64 tmaxp = mmp + mp;</span><br><span class="line">    <span class="comment">//cerr &lt;&lt; tminp &lt;&lt; &#x27; &#x27; &lt;&lt; tmaxp &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i64 i = a[pos] + tminp; i &lt;= a[pos] + tmaxp; i++) &#123;</span><br><span class="line">        is.<span class="built_in">insert</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; is.<span class="built_in">size</span>() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : is) &#123;</span><br><span class="line">        cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="D"><a href="#D" class="headerlink" title="D"></a>D</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">constexpr</span> i64 inf = <span class="number">1e18</span> + <span class="number">9</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    i64 l, r, g;</span><br><span class="line">    cin &gt;&gt; l &gt;&gt; r &gt;&gt; g;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (g &gt; r) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i64 de = (l / g) + ((l % g) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    i64 kp = (r / g);</span><br><span class="line">   <span class="comment">// cerr &lt;&lt; &quot;!:&quot; &lt;&lt; de &lt;&lt; &#x27; &#x27; &lt;&lt; kp &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    <span class="keyword">if</span> (g == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (l == <span class="number">1</span>) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">1LL</span> * r &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        i64 maxp = <span class="number">0</span>;</span><br><span class="line">        i64 ll = l, rr = r;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i64 i = l; i &lt;= r; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r - i &lt;= maxp) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (i64 j = r; j &gt;= l; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j - i &lt;= maxp) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">gcd</span>(i, j) == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (j - i &gt; maxp) &#123;</span><br><span class="line">                        maxp = j - i, ll = i, rr = j;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="number">1LL</span> * ll &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">1LL</span> * rr &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (de &gt; kp) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (de == kp) &#123;</span><br><span class="line">        <span class="keyword">if</span> (de == <span class="number">1</span>) &#123;</span><br><span class="line">            cout &lt;&lt; g &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; g &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cout &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (de == <span class="number">1</span>) &#123;</span><br><span class="line">            cout &lt;&lt; g &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">1LL</span> * g * kp &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        i64 ll = de, rr = kp;</span><br><span class="line">        i64 maxp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i64 li = de; li &lt;= kp; li++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (kp - li &lt;= maxp) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (i64 j = kp; j &gt;= li; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j - li &lt;= maxp) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">gcd</span>(j, li) == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (j - li &gt; maxp) &#123;</span><br><span class="line">                        maxp = j - li;</span><br><span class="line">                        rr = j, ll = li;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; ll * <span class="number">1LL</span> * g &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; rr * <span class="number">1LL</span> * g &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> t;</span><br><span class="line">    cin &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(t--) &#123;</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>codeforce题解</category>
      </categories>
      <tags>
        <tag>codeforce</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML</title>
    <url>/2025/03/01/HTML/</url>
    <content><![CDATA[<blockquote>
<p>html 是一门制作网页的语言。</p>
<h2 id="1-html基本结构-骨架标签"><a href="#1-html基本结构-骨架标签" class="headerlink" title="1.html基本结构(骨架标签)"></a>1.html基本结构(骨架标签)</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>//声明html类型（html5)</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>//语言是什么</span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>yrb.个人网页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    我只能说教教我</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一般标签都是成对存在，称为双标签<br>但是有的单标签不用如&lt; br / &gt;</p>
</blockquote>
<ul>
<li><h4 id="html标签"><a href="#html标签" class="headerlink" title="html标签"></a>html标签</h4> head标签代表页面的头，，定义一些特殊的内容，这些内容往往都是“不可见的内容”（浏览器页面不可见）</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>&lt; head &gt;</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt; title &gt;</td>
<td>定义网页的标题</td>
</tr>
<tr>
<td>&lt; meta &gt;</td>
<td>定义网页的基本信息</td>
</tr>
<tr>
<td>&lt; style &gt;</td>
<td>定义CSS样式</td>
</tr>
<tr>
<td>&lt; link &gt;</td>
<td>链接外部的CSS文件或者脚本文件</td>
</tr>
<tr>
<td>&lt; scripe &gt;</td>
<td>定义脚本语言</td>
</tr>
<tr>
<td>&lt; base &gt;</td>
<td>定义所有页面的基础定位</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><h4 id="body标签"><a href="#body标签" class="headerlink" title="body标签"></a>body标签</h4><p>  body标签代表页面的身体，定义网页的内容，这些内容往往都是“可见的”，在浏览器里面</p>
</li>
<li><h3 id="标签关系："><a href="#标签关系：" class="headerlink" title="标签关系："></a>标签关系：</h3><ul>
<li>包含关系：</li>
<li>并列关系：</li>
</ul>
</li>
</ul>
<h2 id="2-段落与文字"><a href="#2-段落与文字" class="headerlink" title="2.段落与文字"></a>2.段落与文字</h2><ul>
<li><h3 id="段落标签"><a href="#段落标签" class="headerlink" title="段落标签"></a>段落标签</h3>  段落与文字标签：</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>标签</th>
<th>语义</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt; h1&gt;~&lt; h6&gt;</td>
<td>header</td>
<td>标题</td>
</tr>
<tr>
<td>&lt; p&gt;</td>
<td>paragraph</td>
<td>段落</td>
</tr>
<tr>
<td>&lt; br&gt;</td>
<td>break</td>
<td>换行<br></td>
</tr>
<tr>
<td>&lt; hr&gt;</td>
<td>horizontal rule</td>
<td>水平线</td>
</tr>
<tr>
<td>&lt; div&gt;</td>
<td>division</td>
<td>分割元素块（块元素）</td>
</tr>
<tr>
<td>&lt; span&gt;</td>
<td>span</td>
<td>区域（行内元素）</td>
</tr>
</tbody>
</table>
</div>
<hr>
<blockquote>
<p>&lt; html  lang=”  “&gt;引号里面指名网页的语言：(定义为中文英文都可以互通)</p>
<ul>
<li>en为英语<ul>
<li>zh-CN为中文</li>
</ul>
</li>
<li>fr为法语</li>
</ul>
<p>&lt; meta charset =”UTF-8”&gt;字符集<br>不写编码形式会出现乱码</p>
<ul>
<li>常用的GB2312，BIG5,GBK,UTF-8，其中UTF-8称为万国码</li>
</ul>
</blockquote>
<hr>
<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><blockquote>
<p>h1 - h6</p>
</blockquote>
<p>html提供了各等级的标题标签，</p>
<ul>
<li>加了标题标签的文字会被加粗，字号也会变得更大</li>
<li>一个标题会独占一行</li>
</ul>
<blockquote>
<p>段落标签和换行标签<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>段落标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><br>可以把文字分为不同的段落</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>是空行，<span class="tag">&lt;<span class="name">br</span> /&gt;</span>强制换行</span><br></pre></td></tr></table></figure>
<p>br是一个单标签</p>
<hr>
<h3 id="文本格式化标签"><a href="#文本格式化标签" class="headerlink" title="文本格式化标签"></a>文本格式化标签</h3><h3 id="文本格式化标签-1"><a href="#文本格式化标签-1" class="headerlink" title="文本格式化标签"></a>文本格式化标签</h3><div class="table-container">
<table>
<thead>
<tr>
<th>标签</th>
<th>语义</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt; strong&gt;&lt; /strong&gt;或者&lt; b&gt;</td>
<td>strong（加强）</td>
<td>加粗</td>
</tr>
<tr>
<td>&lt; em&gt;</td>
<td>emphaseized（强调）</td>
<td>斜体</td>
</tr>
<tr>
<td>&lt; cite&gt;</td>
<td>cite（引用）</td>
<td>斜体</td>
</tr>
<tr>
<td>&lt; sup&gt;</td>
<td>superscripted</td>
<td>上标</td>
</tr>
<tr>
<td>&lt; sub&gt;</td>
<td>subscripted</td>
<td>下标</td>
</tr>
<tr>
<td>&lt; del&gt;</td>
<td></td>
<td>删除线</td>
</tr>
<tr>
<td>&lt; ins&gt;</td>
<td></td>
<td>下划线</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="lt-div-gt-和-lt-span-gt-标签"><a href="#lt-div-gt-和-lt-span-gt-标签" class="headerlink" title="&lt; div&gt;和&lt; span&gt;标签"></a>&lt; div&gt;和&lt; span&gt;标签</h3><blockquote>
<p>没有语义的用来装内容，当成一个盒子</p>
</blockquote>
<ul>
<li>&lt; div&gt;占用一哈</li>
<li>&lt; span&gt;跨距显示，一行有多个</li>
</ul>
<hr>
<h3 id="图像标签和路径"><a href="#图像标签和路径" class="headerlink" title="图像标签和路径"></a>图像标签和路径</h3><h5 id="1-图像标签"><a href="#1-图像标签" class="headerlink" title="1.图像标签"></a>1.图像标签</h5><p>在html中，&lt; img&gt;用来定义一个图像（imaging)<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=&quot;图像URL&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>src是必须属性，它用于指定图像文件的路径和文件名（属性就是这个图像标签的特性)</li>
<li>使用时把图片发在同一个文件夹里面</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>src</th>
<th>图像路径</th>
</tr>
</thead>
<tbody>
<tr>
<td>alt</td>
<td>文本提示（在图像无法显示时候会提示）</td>
</tr>
<tr>
<td>title</td>
<td>图像提示</td>
</tr>
<tr>
<td>width</td>
<td>宽度设置</td>
</tr>
<tr>
<td>height</td>
<td>高度设置</td>
</tr>
<tr>
<td>border</td>
<td>图像的边框</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>图像可以有多个属性，但是都放在img后面，且各个属性没有先后之分</li>
<li>需要用空格隔开</li>
<li>采取属性键对</li>
</ul>
<hr>
<h2 id="超链接标签（重点）"><a href="#超链接标签（重点）" class="headerlink" title="超链接标签（重点）"></a>超链接标签（重点）</h2><blockquote>
<p>在html中，&lt; a&gt;标签用于定义超链接，作用从一个页面链接到另一个页面</p>
</blockquote>
<h5 id="超链接的语法格式"><a href="#超链接的语法格式" class="headerlink" title="超链接的语法格式"></a>超链接的语法格式</h5><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;跳转目标&quot;</span> <span class="attr">target</span>=<span class="string">&quot;窗口弹出方式&quot;</span>&gt;</span>文本或者图像<span class="tag">&lt;<span class="name">a</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>链接分类：</p>
<ul>
<li>外部链接：必须写上绝对路径,加上https://</li>
<li>内部链接（同一目录【级别】下的链接）：直接写页面的名称如”index.html”</li>
<li>空链接：#</li>
<li>下载链接：地址链接的是 文件.exe 或者是 .zip 等压缩包形式,会直接下载这个exe或者zip，音频等。</li>
<li>网页链接元素，在网页里的各种网页元素，如文本，图像，表格，音频，视频都可以添加超链接。</li>
<li>锚点链接：点击该处可以快速定位到网页的某一个位置（也可以实现跳转到顶部等等）</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">target:</span><br><span class="line">  _self在当前页面打开(默认的），_blank在新的窗口打开</span><br></pre></td></tr></table></figure>
<ul>
<li>锚点链接的具体操作：<h2 id="先把字串里面的写入”-一段id”-之后找到目标的标签，在其之后加上”id-”这段id的名字””就可以实现锚点跳转。"><a href="#先把字串里面的写入”-一段id”-之后找到目标的标签，在其之后加上”id-”这段id的名字””就可以实现锚点跳转。" class="headerlink" title="先把字串里面的写入”#一段id”,之后找到目标的标签，在其之后加上”id=”这段id的名字””就可以实现锚点跳转。"></a>先把字串里面的写入”#一段id”,之后找到目标的标签，在其之后加上”id=”这段id的名字””就可以实现锚点跳转。</h2><h3 id="注释标签"><a href="#注释标签" class="headerlink" title="注释标签"></a>注释标签</h3><blockquote>
<p> html中注释形式如下:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注释 --&gt;</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
<li>可以使用”Ctrl + /或?”直接快捷键打出来</li>
<li>注释不会显示，只是用来</li>
</ul>
<hr>
<h4 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h4><p>  <img src="file:///d%3A/cworkspace/web/%E7%AC%94%E8%AE%B01.png" alt="D:\cworkspace\web\笔记1.png"></p>
<h2 id="重点记住空格和大于小于号。"><a href="#重点记住空格和大于小于号。" class="headerlink" title="   - 重点记住空格和大于小于号。"></a>   - 重点记住空格和大于小于号。</h2><h2 id="1-表格标签"><a href="#1-表格标签" class="headerlink" title="1.表格标签"></a>1.表格标签</h2><h4 id="1-1表格的主要作用"><a href="#1-1表格的主要作用" class="headerlink" title="1.1表格的主要作用"></a>1.1表格的主要作用</h4><blockquote>
<p>表格主要是用来显示，展示数据，因为它可以让数据显示的非常规律，可读性非常好，表格不是用来布局页面的，而是用来展示数据的。</p>
<h4 id="1-2表格的基本语法"><a href="#1-2表格的基本语法" class="headerlink" title="1.2表格的基本语法"></a>1.2表格的基本语法</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span>//表格里的行</span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>单元格内的文字<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    ···</span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  ···</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>&lt; table&gt;是用来定义表格的标签</li>
<li>&lt; tr&gt;&lt; /tr&gt;用来定义行，必须定义在table内部</li>
<li>&lt; td&gt;&lt; /td&gt;用来定义单元格，必须定义在&lt; tr&gt;内</li>
<li>&lt; th&gt;&lt; /th&gt;表头单元格标签，（table head)，表头内容会被加粗，同时居中。</li>
</ul>
</blockquote>
<h4 id="1-2表格属性-到这里去练习一下"><a href="#1-2表格属性-到这里去练习一下" class="headerlink" title="1.2表格属性(到这里去练习一下)"></a>1.2表格属性(到这里去练习一下)</h4><blockquote>
<p>不常用，因为后面会使用CSS</p>
</blockquote>
<ul>
<li>align （属性值：left ,right , center),设置表格的位置</li>
<li>border (1 或 “” ),规定表格是否具有边框，默认为””，表示没有边框</li>
<li>width （像素值或百分比），规定表格的宽度</li>
<li>height (像素值或百分比) ， 规定表格的长度</li>
<li>cellpadding (像素值)，规定单元边沿与其内容之间的空白，默认像素为1。</li>
<li>cellspacing （像素值），规定单元格之间的空白，默认像素值为2.</li>
</ul>
<h4 id="1-3表格结构标签"><a href="#1-3表格结构标签" class="headerlink" title="1.3表格结构标签"></a>1.3表格结构标签</h4><blockquote>
<p>使用场景：因为表格可能很长，</p>
</blockquote>
<hr>
<h4 id="音频文件"><a href="#音频文件" class="headerlink" title="音频文件"></a>音频文件</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//html里如果属性名字和属性值完全一致，可以只写属性名字。</span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line">//等同于<span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">controls</span>=<span class="string">&quot;controls&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>controls为显示控制面板</li>
<li>loop是循环播放</li>
<li>autoplay自动播放</li>
<li>支持mp3,WebM,Ogg文件</li>
</ul>
<hr>
<h4 id="视频文件"><a href="#视频文件" class="headerlink" title="视频文件"></a>视频文件</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;  .mp4&quot;</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>loop循环播放</li>
<li>mute静音播放</li>
<li>autoplay自动播放</li>
<li>支持mp4,WebM,Ogg文件</li>
</ul>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>前端</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaData类学习</title>
    <url>/2025/02/27/JavaData%E7%B1%BB%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<ul>
<li>Java的DATA类</li>
</ul>
<h2 id="Date类的概述"><a href="#Date类的概述" class="headerlink" title="Date类的概述"></a>Date类的概述</h2><ol>
<li><p>java.util,Date 表示日期和时间的类</p>
</li>
<li><p>类 Date 表示特定的瞬间，精确到千分之一秒（毫秒）</p>
</li>
<li><p>实例引入：获取时间原点到当前系统时间经历了多少秒</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">// 时间原点：1970 年 01 月 01 日 00:00:00 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoDate</span> &#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;       </span><br><span class="line">            System.out.println(System.currentTimeMillis());    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;       </span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Date类常用的构造方法和成员方法"><a href="#Date类常用的构造方法和成员方法" class="headerlink" title="Date类常用的构造方法和成员方法"></a>Date类常用的构造方法和成员方法</h2><h3 id="成员方法"><a href="#成员方法" class="headerlink" title="成员方法"></a>成员方法</h3><p>getTime()方法。返回：时间原点以来，此Date对象表示的毫秒数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoGetTime</span> &#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;        </span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();        </span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> date.getTime();                <span class="comment">// 输出：1578728202850       </span></span><br><span class="line">     <span class="comment">// 该方法类似于 System.currentTimeMillis()        </span></span><br><span class="line">         System.out.println(time);   </span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><h4 id="Date类的无参构造方法。"><a href="#Date类的无参构造方法。" class="headerlink" title="Date类的无参构造方法。"></a>Date类的无参构造方法。</h4><p>返回：当前系统的日期和时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoDate1</span> &#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;       </span><br><span class="line">         <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();         <span class="comment">// 输出：Sat Jan 11 15:40:50 CST 2020      </span></span><br><span class="line">        System.out.println(date);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Date类的带参构造方法"><a href="#Date类的带参构造方法" class="headerlink" title="Date类的带参构造方法"></a>Date类的带参构造方法</h4><p>Date(long date) 参数为一个毫秒值，把传入的毫秒值转换为Date日期</p>
<p>返回：传入参数（毫秒值）对应的的日期和时间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoDate2</span> &#123;   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;        </span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">0L</span>);         <span class="comment">// 这里输出的是0毫秒时的日期和时间，即时间原点的日期和时间        // 输出：Thu Jan 01 08:00:00 CST 1970        </span></span><br><span class="line">        System.out.println(date);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DateFormat抽象类和SimpleDateFormat实现类"><a href="#DateFormat抽象类和SimpleDateFormat实现类" class="headerlink" title="DateFormat抽象类和SimpleDateFormat实现类"></a>DateFormat抽象类和SimpleDateFormat实现类</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ol>
<li><p>java.text.DateFormat类，是日期/时间格式化子类的抽象类</p>
</li>
<li><p>作用：格式化(也就是日期-&gt;文本)、解析(文本-&gt;日期)</p>
</li>
<li><p>成员方法</p>
<ol>
<li>string format( Datedate)按照指定的模式,把Date日期,格式化为符合模式的字符串</li>
<li>Date parse( string source)把符合模式的字符串,解析为Dote日期</li>
</ol>
</li>
<li><p>DateFormat类是一个抽象类,无法直接创建对象使用，可以使用 DateFormat类的子类<strong>java.text.SimpleDateFormat extends DateFormat</strong></p>
</li>
<li><p>构造方法：<strong>SimpleDateFormat(String pattern)</strong>用给定的模式和默认语言环境的日期格式符号构造SimpleDateFormat</p>
</li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ol>
<li><p>测试DateFormat类的format方法，输出指定格式的日期、时间</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01FormatMethod</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建SimpleDateFormat对象，在SimpleDateFormat(String pattern)构造方法中传入指定的模式</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy 年 MM 月 dd 日 HH 时 mm 分 ss 秒&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 调用DateFormat的实现类SimpleDateFormat中的format方法，</span></span><br><span class="line">        <span class="comment">// 按照构造方法中指定的模式，把Date解析为符合模式的字符串（文本）</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">dateFormat</span> <span class="operator">=</span> simpleDateFormat.format(date);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Sat Jan 11 16:24:43 CST 2020</span></span><br><span class="line">        System.out.println(date);</span><br><span class="line">        <span class="comment">// 2020 年 01 月 11 日 16 时 24 分 43 秒</span></span><br><span class="line">        System.out.println(dateFormat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试DateFormat类的parse方法，把符合构造方法中模式的字符串，解析为Date日期</p>
</li>
</ol>
<pre><code class="lang-java">import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

public class Demo01ParseMethod &#123;
    public static void main(String[] args)
            throws ParseException &#123;
        // 创建SimpleDateFormat对象，在SimpleDateFormat(String pattern)构造方法中传入指定的模式
        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;yyyy 年 MM 月 dd 日 HH 时 mm 分 ss 秒&quot;);

        // 调用 SimpleDateFormat对象中的 parse方法，把符合构SimpleDateFormat(String pattern)造方法中模式的字符串，解析为Date日期
        Date dateParse = simpleDateFormat.parse(&quot;2020 年 01 月 11 日 16 时 24 分 43 秒&quot;);

        // Sat Jan 11 16:24:43 CST 2020
        System.out.println(dateParse);
    &#125;
&#125;
</code></pre>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java14新特性-Record类</title>
    <url>/2025/03/05/Java14%E6%96%B0%E7%89%B9%E6%80%A7-Record%E7%B1%BB/</url>
    <content><![CDATA[<h2 id="Java-中的-Record-类"><a href="#Java-中的-Record-类" class="headerlink" title="Java 中的 Record 类"></a>Java 中的 Record 类</h2><p>Record 类是 Java 14 引入的一种新特性，旨在简化不可变数据类的定义。它类似于枚举类，用于标记不可变的数据类。Record 类通过减少样板代码，使得类的定义更加简洁和紧凑<a href="https://blog.csdn.net/cz20010101/article/details/123957405">1</a><a href="https://www.jianshu.com/p/bf99938a369b">2</a>。</p>
<p>Record 类的定义</p>
<p>使用 <em>record</em> 关键字可以定义一个 Record 类。例如，定义一个包含 <em>start</em> 和 <em>end</em> 两个字段的 <em>range</em> 类，可以这样写：</p>
<p>public record range(int start, int end) {}</p>
<p>这相当于定义了一个 <em>final</em> 类，并自动实现了 <em>equals</em>、<em>hashCode</em> 和 <em>toString</em> 方法<a href="https://www.jianshu.com/p/bf99938a369b">2</a>。</p>
<p>使用示例</p>
<p>以下是一个使用 Record 类的示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">range</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">range</span>(<span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">        System.out.println(r.start()); <span class="comment">// 输出: 100</span></span><br><span class="line">        System.out.println(r.end()); <span class="comment">// 输出: 200</span></span><br><span class="line">        System.out.println(r); <span class="comment">// 输出: range[start=100, end=200]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，<em>range</em> 类自动生成了构造方法、字段访问方法以及 <em>toString</em> 方法特点和优势<br>Record 类具有以下特点和优势：</p>
<ol>
<li><p><strong>简洁性</strong>：使用 <em>record</em> 关键字可以一行代码定义一个不可变类，减少了样板代码<a href="https://blog.csdn.net/cz20010101/article/details/123957405">1</a>。</p>
</li>
<li><p><strong>自动生成方法</strong>：编译器会自动生成构造方法、<em>equals</em>、<em>hashCode</em> 和 <em>toString</em> 方法<a href="https://www.jianshu.com/p/bf99938a369b">2</a>。</p>
</li>
<li><p><strong>不可变性</strong>：Record 类是 <em>final</em> 类，所有字段也是 <em>final</em> 的，保证了类的不可变性<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1331429187256353">3</a>。</p>
</li>
</ol>
<p>扩展功能</p>
<p>虽然 Record 类简化了类的定义，但它仍然允许添加自定义方法、静态方法和构造方法。例如，可以为 <em>range</em> 类添加一个计算距离的方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">range</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">distance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> end - start;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以添加静态方法来创建实例：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">range</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> range <span class="title function_">of</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">range</span>(start, end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过这些扩展功能，Record 类不仅简化了类的定义，还提供了灵活性<a href="https://www.jianshu.com/p/bf99938a369b">2</a><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1331429187256353">3</a>。</p>
<p>Record 类是 Java 14 引入的一种新特性，旨在简化不可变数据类的定义。它通过减少样板代码，使得类的定义更加简洁和紧凑，同时提供了自动生成的方法和不可变性<a href="https://blog.csdn.net/cz20010101/article/details/123957405">1</a><a href="https://www.jianshu.com/p/bf99938a369b">2</a>。此外，Record 类还允许添加自定义方法和静态方法，提供了灵活性<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1331429187256353">3</a>。</p>
<h2 id="例题-Codeforce-Problem-D-Codeforces"><a href="#例题-Codeforce-Problem-D-Codeforces" class="headerlink" title="例题: Codeforce Problem - D - Codeforces"></a>例题: Codeforce <a href="https://codeforces.com/contest/1714/problem/D">Problem - D - Codeforces</a></h2><p>采用record记录pair快速操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">(Scanner sc)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> sc.next();</span><br><span class="line">        <span class="type">var</span> <span class="variable">h</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">var</span> <span class="variable">n</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; cp = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Collections.nCopies(n + <span class="number">1</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            cp.set(i, sc.next());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">var</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">int</span>[h + <span class="number">1</span>];</span><br><span class="line">        Map&lt;Integer, Integer&gt; res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; h; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">maxp</span> <span class="operator">=</span> <span class="number">0</span>, P = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>; k &lt;= n; k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (ck(cp.get(k), s, i, is) &amp;&amp; maxp &lt; cp.get(k).length()) &#123;</span><br><span class="line">                    maxp = cp.get(k).length();</span><br><span class="line">                    P = k;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (P != -<span class="number">1</span>) &#123;</span><br><span class="line">                res.put(i, P);</span><br><span class="line">                work(cp.get(P), is, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; h; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(-<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Move&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> entry : res.entrySet()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> entry.getKey(), y = entry.getValue();</span><br><span class="line">            <span class="type">int</span> <span class="variable">tp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cp.get(y).length(); i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is[x + i] &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                    tp++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (tp == cp.get(y).length()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cp.get(y).length(); i++) &#123;</span><br><span class="line">                    is[x + i]--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ans.add(<span class="keyword">new</span> <span class="title class_">Move</span>(y, x));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(ans.size());</span><br><span class="line">        <span class="keyword">for</span> (Move move : ans) &#123;</span><br><span class="line">            System.out.println(move.k() + <span class="string">&quot; &quot;</span> + (move.pos() + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">ck</span><span class="params">(String p, String s, <span class="type">int</span> pos, <span class="type">int</span>[] is)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>, h = s.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; p.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i + pos &gt;= h || p.charAt(i) != s.charAt(pos + i)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (is[i + pos] &gt; <span class="number">0</span>) c++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c != p.length();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">(String p, <span class="type">int</span>[] is, <span class="type">int</span> pos)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; p.length(); i++) &#123;</span><br><span class="line">            is[pos + i]++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Move</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> pos)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in)) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">            <span class="keyword">while</span> (t-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                solve(scanner);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>IO流 （附带算法竞赛模板）</title>
    <url>/2025/01/26/IO%E6%B5%81%EF%BC%88%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A8%A1%E6%9D%BF%EF%BC%89/</url>
    <content><![CDATA[<p>主要是BufferedReader + StringTokenizer（很快）</p>
<p>算法竞赛模板:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;  </span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">()</span> &#123;  </span><br><span class="line">            </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">         <span class="keyword">try</span> (<span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(System.out))) &#123;  </span><br><span class="line">             <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> in.nextInt();  </span><br><span class="line">             <span class="keyword">while</span> (t-- &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">                 solve();  </span><br><span class="line">             &#125;         </span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">             e.printStackTrace();  </span><br><span class="line">          &#125;    </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">static</span> <span class="type">InputReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputReader</span>();  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InputReader</span>&#123;  </span><br><span class="line">        <span class="keyword">private</span> StringTokenizer st;  </span><br><span class="line">        <span class="keyword">private</span> BufferedReader bf;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">InputReader</span><span class="params">()</span> &#123;  </span><br><span class="line">            bf = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in));  </span><br><span class="line">            st = <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">next</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">while</span>(st == <span class="literal">null</span> || !st.hasMoreTokens()) &#123;  </span><br><span class="line">                st = <span class="keyword">new</span> <span class="title class_">StringTokenizer</span>(bf.readLine());  </span><br><span class="line">            &#125;            </span><br><span class="line">            <span class="keyword">return</span> st.nextToken();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">nextLine</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">return</span> bf.readLine();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">nextInt</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(next());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextLong</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">return</span> Long.parseLong(next());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">nextDouble</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">return</span> Double.parseDouble(next());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> BigInteger <span class="title function_">nextBigInteger</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(next());  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> BigDecimal <span class="title function_">nextBigDecimal</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(next());  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript</title>
    <url>/2025/03/15/JavaScript/</url>
    <content><![CDATA[<ul>
<li>脚本语言，不用编译直接运行</li>
<li>组成<ul>
<li>ECMAScript： 规定了JS基础语法核心知识，包括变量，数据类型，流程控制，函数，对象等</li>
<li>BOM： 浏览器对象模型，用于操作浏览器本身，如：页面弹窗，地址栏操作，关闭窗口等。</li>
<li>DOM： 文档对象模型，用来操作HTML文档，如更改标签内内容，更改标签内字体样式</li>
</ul>
</li>
</ul>
<h2 id="JS-核心语法"><a href="#JS-核心语法" class="headerlink" title="JS 核心语法"></a>JS 核心语法</h2><h3 id="JS引入方式"><a href="#JS引入方式" class="headerlink" title="JS引入方式"></a>JS引入方式</h3><ul>
<li><p>内部引入</p>
<blockquote>
<ul>
<li>必须在\<script\>\</script> 之间</li>
<li>在HTML文档中可以在任何地方放任何数量script</li>
<li>一般把脚本置于\<body>元素底部</li>
</ul>
</blockquote>
</li>
<li><p>外部引入</p>
<blockquote>
<p>写完了引入</p>
</blockquote>
</li>
</ul>
<p><strong>书写规范</strong> : 结束符，每行结尾以分号结尾，结尾分号可有可无</p>
<hr>
<h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ul>
<li>JS中用 let 关键字声明变量（弱类型语言， 变量可以存放不同类型的值）<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">20</span>;</span><br><span class="line">    a = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="title function_">alert</span>(a);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li>const 声明常量</li>
</ul>
<p>输出方式<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>() <span class="comment">// 输出到控制台</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">alert</span>(a) <span class="comment">// 弹出警告框</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>() <span class="comment">// 输出到html内部</span></span><br></pre></td></tr></table></figure></p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ul>
<li>Js数据类型分为： 基本数据类型和引用数据类型（对象）</li>
<li><p>基本数据类型： </p>
<ul>
<li>number： 数字</li>
<li>boolean</li>
<li>null ： 对象为空（注意大小写）</li>
<li>undefined： 当声明的变量没有初始化，默认是undefined</li>
<li>string<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span> + 数据 <span class="comment">// 查看类型</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>模板字符串：</p>
<ul>
<li>` ` (反引号)</li>
<li>内容拼接的时候，使用${} 包裹变量<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="string">`Tom`</span>;</span><br><span class="line">    <span class="keyword">let</span> age = <span class="number">18</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`大家好，我是<span class="subst">$&#123;name&#125;</span>, 今年<span class="subst">$&#123;age&#125;</span>岁了`</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="具名函数"><a href="#具名函数" class="headerlink" title="具名函数"></a>具名函数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">functionName</span>(<span class="params">参数一， 参数二</span>) &#123;</span><br><span class="line">    <span class="comment">// 要执行的代码</span></span><br><span class="line">    (<span class="keyword">return</span> 值)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意道函数哪怕有返回值也不显示</p>
<ul>
<li>JS是弱类型，参数和返回值都没有显示类型</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">let c = add(a, b);</span><br><span class="line">alert(c);</span><br></pre></td></tr></table></figure>
<p>调用时候如果传入了过多的参数，只调用前几个参数。</p>
<h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">add</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> add = <span class="keyword">function</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义对象"><a href="#自定义对象" class="headerlink" title="自定义对象"></a>自定义对象</h3><ul>
<li>定义格式：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> 对象名 = &#123;</span><br><span class="line">    属性名<span class="number">1</span>： 属性值<span class="number">1</span></span><br><span class="line">    属性<span class="number">2</span> : 属性值<span class="number">2</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    方法名： <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>e.g:<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    name = <span class="string">&#x27;Tom&#x27;</span></span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">    <span class="attr">gender</span>: <span class="string">&#x27;男&#x27;</span></span><br><span class="line">    <span class="attr">sing</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;唱着好运来&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意在定义方法时候一般不用 “ =&gt; “, 由于此时this指向的不是当前对象而可能是他的父级对象</p>
<hr>
<h2 id="json"><a href="#json" class="headerlink" title="json"></a>json</h2><ul>
<li>JavaScript Object Notation, JavaScript对象标记文本（JS写的文本）</li>
<li>多作为数据载体</li>
<li>本质是一些字符串</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">JSON.parse() <span class="comment">// 变JS</span></span><br><span class="line">JSON.stringify() <span class="comment">// 变JSON</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;尼好&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(person); <span class="comment">// 输出object，看不出里面内容</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(person)) <span class="comment">// 输出对象里面所有属性，因为变成了文本</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><ul>
<li>文本对象模型，将整个标记语言（html）封装成文档对象</li>
<li><p>分为以下部分</p>
<ul>
<li>Document： 整个文档对象</li>
<li>Element： 元素对象</li>
<li>Attribute： 属性对象</li>
<li>Text： 文本对象</li>
<li>Comment： 注释对象</li>
</ul>
</li>
<li><p>核心思想： 将页面中所有元素看出对象</p>
</li>
</ul>
<p><strong>操作</strong> : </p>
<ul>
<li>获取DOM元素对象<br>根据CSS选择器获取DOM元素，</li>
<li>查看文档 <a href="https://www.w3school.com.cn/">w3school 在线教程</a> 获得对应属性的操作</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span> = <span class="string">&quot;Title1&quot;</span>&gt;</span> 1111<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>22222<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>33333<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 修改第一个h1标签中的文本内容</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1.1 获取DOM对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> h1 = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#Title1&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//1.2 调用DOM对象中的属性或者方法</span></span></span><br><span class="line"><span class="language-javascript">        h1.<span class="property">innerHTML</span> = <span class="string">&#x27;修改后的文本&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用querySecectorAll返回一个数组</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> hs = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;h1&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        hs[<span class="number">0</span>].<span class="property">innerHTML</span> = <span class="string">&#x27;修改元素&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h2><ul>
<li>语法： <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">事件源.<span class="title function_">addEventListener</span>(<span class="string">&#x27;时间类型&#x27;</span>, 事件触发执行函数);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>e.g<br><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;点我&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 事件监听</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#btn1&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;试试就试试&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>（和cf一开始时候Go to the task list 是一个道罢）</p>
<ul>
<li>早期写法： <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">事件源.<span class="property">on</span>事件 = <span class="keyword">function</span>(<span class="params"></span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>常见事件</strong></p>
<ul>
<li>鼠标事件<ul>
<li>click： 鼠标点击</li>
<li>mouseenter: 鼠标移入</li>
<li>mouseleave： 鼠标移出<ul>
<li>键盘事件</li>
<li>keydown: 键盘按下触发</li>
<li>keyup: 键盘抬起触发</li>
<li>焦点事件</li>
<li>focus: 获得焦点触发</li>
<li>blur: 失去焦点触发</li>
<li>表单事件</li>
<li>input: 用户输入时触发</li>
<li>submit: 用户提交时触发</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>事件监听优化：</p>
</blockquote>
<p>如果某个方法需要多次使用可以考虑将其单独写成一个工具类（js文件内，同时在当前引入JS使得不必要太过繁琐）.</p>
<p>定义时候export<br>引入的时候import</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">printlog</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ( printLog ) <span class="keyword">from</span> <span class="string">&#x27;./XXX.js&#x27;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Java包装类</title>
    <url>/2025/01/26/Java%E5%8C%85%E8%A3%85%E7%B1%BB/</url>
    <content><![CDATA[<h3 id="Java-的包装类（Wrapper-Classes）作用"><a href="#Java-的包装类（Wrapper-Classes）作用" class="headerlink" title="Java 的包装类（Wrapper Classes）作用"></a><strong>Java 的包装类（Wrapper Classes）作用</strong></h3><p>Java 的 <strong>包装类（Wrapper Class）</strong> 主要用于将 <strong>基本数据类型（primitive types）</strong> 转换为 <strong>对象类型（reference types）</strong>，它们提供了额外的方法，并且在某些情况下是必需的，比如在 <strong>集合框架（如 <code>ArrayList</code>）</strong> 中存储数据。</p>
<hr>
<h2 id="1-Java-包装类有哪些？"><a href="#1-Java-包装类有哪些？" class="headerlink" title="1. Java 包装类有哪些？"></a><strong>1. Java 包装类有哪些？</strong></h2><p>Java 为每种基本数据类型提供了对应的包装类：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>基本类型（Primitive Type）</th>
<th>包装类（Wrapper Class）</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>byte</code></td>
<td><code>Byte</code></td>
</tr>
<tr>
<td><code>short</code></td>
<td><code>Short</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>Integer</code></td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>Long</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>Float</code></td>
</tr>
<tr>
<td><code>double</code></td>
<td><code>Double</code></td>
</tr>
<tr>
<td><code>char</code></td>
<td><code>Character</code></td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>Boolean</code></td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="2-为什么需要包装类？"><a href="#2-为什么需要包装类？" class="headerlink" title="2. 为什么需要包装类？"></a><strong>2. 为什么需要包装类？</strong></h2><h3 id="1-在集合（ArrayList、HashMap-等）中存储基本类型"><a href="#1-在集合（ArrayList、HashMap-等）中存储基本类型" class="headerlink" title="(1) 在集合（ArrayList、HashMap 等）中存储基本类型"></a><strong>(1) 在集合（<code>ArrayList</code>、<code>HashMap</code> 等）中存储基本类型</strong></h3><p>Java <strong>集合框架</strong>（如 <code>ArrayList</code>、<code>HashMap</code>）<strong>不支持基本类型</strong>，必须使用对象类型。<br>例如，<code>ArrayList&lt;int&gt;</code> 是非法的，必须使用 <code>ArrayList&lt;Integer&gt;</code>。</p>
<p><strong>错误示例（不能使用 <code>int</code>）：</strong></p>
<p>java</p>
<p>复制编辑</p>
<p><code>ArrayList&lt;int&gt; list = new ArrayList&lt;&gt;(); // ❌ 错误！</code></p>
<p><strong>正确示例（使用 <code>Integer</code>）：</strong></p>
<p>java</p>
<p>复制编辑</p>
<p><code>ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(10); // 自动装箱 list.add(20); System.out.println(list.get(0)); // 输出 10</code></p>
<hr>
<h3 id="2-null-处理"><a href="#2-null-处理" class="headerlink" title="(2) null 处理"></a><strong>(2) <code>null</code> 处理</strong></h3><p>基本类型（如 <code>int</code>、<code>double</code>）<strong>不能赋值 <code>null</code></strong>，但包装类可以：</p>
<p>java</p>
<p>复制编辑</p>
<p><code>Integer a = null; // ✅ 合法 int b = null;     // ❌ 错误（基本类型不能为 null）</code></p>
<p>这在 <strong>数据库操作</strong> 或 <strong>JSON 解析</strong> 时很常见，比如 <code>null</code> 表示数据缺失。</p>
<hr>
<h3 id="3-提供了额外的方法"><a href="#3-提供了额外的方法" class="headerlink" title="(3) 提供了额外的方法"></a><strong>(3) 提供了额外的方法</strong></h3><p>包装类提供了许多有用的方法，比如：</p>
<ul>
<li><strong><code>Integer.parseInt(String)</code></strong> 将字符串转换为 <code>int</code></li>
<li><strong><code>Double.parseDouble(String)</code></strong> 将字符串转换为 <code>double</code></li>
<li><strong><code>Integer.toHexString(int)</code></strong> 将整数转换为十六进制字符串</li>
<li><strong><code>Boolean.valueOf(String)</code></strong> 解析布尔值</li>
</ul>
<p>java</p>
<p>复制编辑</p>
<p><code>String str = &quot;123&quot;; int num = Integer.parseInt(str); // 将字符串 &quot;123&quot; 转换为 int System.out.println(num * 2); // 输出 246</code></p>
<hr>
<h3 id="4-自动装箱（Autoboxing）和自动拆箱（Unboxing）"><a href="#4-自动装箱（Autoboxing）和自动拆箱（Unboxing）" class="headerlink" title="(4) 自动装箱（Autoboxing）和自动拆箱（Unboxing）"></a><strong>(4) 自动装箱（Autoboxing）和自动拆箱（Unboxing）</strong></h3><p><strong>Java 5 引入了自动装箱/拆箱，减少了手动转换的麻烦。</strong></p>
<h4 id="自动装箱（Autoboxing）"><a href="#自动装箱（Autoboxing）" class="headerlink" title="自动装箱（Autoboxing）"></a><strong>自动装箱（Autoboxing）</strong></h4><p>基本类型 <strong>→</strong> 包装类 <strong>自动转换</strong></p>
<p>java</p>
<p>复制编辑</p>
<p><code>Integer num = 10; // 相当于 Integer num = Integer.valueOf(10);</code></p>
<h4 id="自动拆箱（Unboxing）"><a href="#自动拆箱（Unboxing）" class="headerlink" title="自动拆箱（Unboxing）"></a><strong>自动拆箱（Unboxing）</strong></h4><p>包装类 <strong>→</strong> 基本类型 <strong>自动转换</strong></p>
<p>java</p>
<p>复制编辑</p>
<p><code>int x = num; // 相当于 int x = num.intValue();</code></p>
<p>示例：</p>
<p>java</p>
<p>复制编辑</p>
<p><code>ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(10); // 自动装箱 int value = list.get(0); // 自动拆箱 System.out.println(value + 1); // 输出 11</code></p>
<hr>
<h3 id="5-类型转换"><a href="#5-类型转换" class="headerlink" title="(5) 类型转换"></a><strong>(5) 类型转换</strong></h3><p>包装类允许不同类型之间的转换：</p>
<p>java</p>
<p>复制编辑</p>
<p><code>int i = 100; String str = Integer.toString(i); // int → String int j = Integer.parseInt(str); // String → int</code></p>
<hr>
<h2 id="3-包装类和基本类型的性能"><a href="#3-包装类和基本类型的性能" class="headerlink" title="3. 包装类和基本类型的性能"></a><strong>3. 包装类和基本类型的性能</strong></h2><p>包装类的对象在 <strong>堆内存（Heap）</strong> 分配，而基本类型通常在 <strong>栈内存（Stack）</strong> 中。<br>因此：</p>
<ul>
<li><strong>基本类型性能更好，占用内存更少</strong>。</li>
<li><strong>包装类需要额外的内存和时间</strong>，频繁使用时可能影响性能。</li>
</ul>
<h3 id="示例：包装类和基本类型性能对比"><a href="#示例：包装类和基本类型性能对比" class="headerlink" title="示例：包装类和基本类型性能对比"></a><strong>示例：包装类和基本类型性能对比</strong></h3><p>java</p>
<p>复制编辑</p>
<p><code>public class Test &#123;     public static void main(String[] args) &#123;         long startTime, endTime;          // 测试基本类型 int         startTime = System.nanoTime();         int sum1 = 0;         for (int i = 0; i &lt; 1000000; i++) &#123;             sum1 += i;         &#125;         endTime = System.nanoTime();         System.out.println(&quot;基本类型 int 耗时: &quot; + (endTime - startTime) + &quot; ns&quot;);          // 测试包装类 Integer         startTime = System.nanoTime();         Integer sum2 = 0;         for (int i = 0; i &lt; 1000000; i++) &#123;             sum2 += i; // 这里涉及大量的装箱和拆箱         &#125;         endTime = System.nanoTime();         System.out.println(&quot;包装类 Integer 耗时: &quot; + (endTime - startTime) + &quot; ns&quot;);     &#125; &#125;</code></p>
<p>💡 <strong>结论</strong>：包装类由于<strong>装箱/拆箱</strong>，性能比基本类型差很多，因此<strong>在性能敏感的场景下，应尽量使用基本类型</strong>。</p>
<hr>
<h2 id="4-小结"><a href="#4-小结" class="headerlink" title="4. 小结"></a><strong>4. 小结</strong></h2><div class="table-container">
<table>
<thead>
<tr>
<th><strong>用途</strong></th>
<th><strong>包装类（Wrapper Class）作用</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>集合存储</strong></td>
<td><code>ArrayList&lt;Integer&gt;</code> 不能存 <code>int</code>，只能存 <code>Integer</code></td>
</tr>
<tr>
<td><strong><code>null</code> 处理</strong></td>
<td>包装类可以存 <code>null</code>，基本类型不行</td>
</tr>
<tr>
<td><strong>提供方法</strong></td>
<td><code>Integer.parseInt()</code>、<code>Double.toString()</code></td>
</tr>
<tr>
<td><strong>自动装箱/拆箱</strong></td>
<td><code>Integer num = 10;</code> <strong>(装箱)</strong>，<code>int x = num;</code> <strong>(拆箱)</strong></td>
</tr>
<tr>
<td><strong>类型转换</strong></td>
<td><code>String → int</code>，<code>int → String</code></td>
</tr>
<tr>
<td><strong>性能考虑</strong></td>
<td>基本类型更快，占用内存更少</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="Integer"><a href="#Integer" class="headerlink" title="Integer"></a>Integer</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;  </span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;  </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Javastudy</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">// 验证字符串是否是一个邮箱地址  </span></span><br><span class="line">        ArrayList&lt;String&gt; lst = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        lst.add(<span class="string">&quot;12&quot;</span>);  </span><br><span class="line">        lst.add(<span class="string">&quot;13&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;  </span><br><span class="line">            sum += Integer.parseInt(lst.get(i));  </span><br><span class="line">            System.out.println(sum);  </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> Integer.toString(<span class="number">456</span>); <span class="comment">// toString把数据转化为String类型</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要出现的功能(以Int为例子):</p>
<ul>
<li>intValue()</li>
<li><strong>parseInt(String)</strong> 返回该string的int值.</li>
</ul>
<h2 id="BigInteger"><a href="#BigInteger" class="headerlink" title="BigInteger"></a>BigInteger</h2><h2 id="Java中的BigInteger范围"><a href="#Java中的BigInteger范围" class="headerlink" title="Java中的BigInteger范围"></a>Java中的BigInteger范围</h2><p>在Java中，<em>BigInteger</em>类是用于处理超出标准数据类型（如<em>int</em>、<em>long</em>）范围的大整数的。<em>BigInteger</em>类位于<em>java.math</em>包中，它提供了一系列方法来进行大整数的算术运算，比如加法、减法、乘法和除法等。<em>BigInteger</em>的一个关键特点是它可以表示非常大的数值，理论上只受限于计算机的内存大小。</p>
<p>要创建一个<em>BigInteger</em>实例，你可以使用其构造函数传入一个字符串表示的数值，例如：</p>
<p>BigInteger bi = new BigInteger(“1234567890”);</p>
<p>然后，你可以使用<em>BigInteger</em>提供的方法来执行各种算术操作。例如，要执行加法，你可以使用<em>add</em>方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">BigInteger</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line"><span class="type">BigInteger</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;12345678901234567890&quot;</span>);</span><br><span class="line"><span class="type">BigInteger</span> <span class="variable">sum</span> <span class="operator">=</span> i1.add(i2); <span class="comment">// 结果为12345678902469135780</span></span><br></pre></td></tr></table></figure>
<p>转换为基本数据类型</p>
<p>尽管<em>BigInteger</em>可以表示非常大的数值，但有时候我们需要将其转换为基本数据类型，如<em>long</em>。<em>BigInteger</em>提供了一系列方法来进行这种转换，例如<em>longValue()</em>和<em>longValueExact()</em>。<em>longValue()</em>方法会尝试将<em>BigInteger</em>的值转换为<em>long</em>类型，如果数值超出了<em>long</em>的范围，它会返回一个近似值。而<em>longValueExact()</em>方法在转换结果超出<em>long</em>范围时会抛出<em>ArithmeticException</em>异常。</p>
<p>使用<em>BigInteger</em>的一个缺点是其速度相对于原生类型（如<em>int</em>和<em>long</em>）较慢，因为<em>BigInteger</em>的运算是通过软件模拟实现的。因此，在性能敏感的应用中，如果可能，最好还是使用原生类型。</p>
<p>示例</p>
<p>以下是一个使用<em>BigInteger</em>的简单示例，它演示了如何创建<em>BigInteger</em>对象，执行幂运算，以及如何处理超出<em>long</em>范围时的情况：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">bi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line">        System.out.println(bi.pow(<span class="number">5</span>)); <span class="comment">// 输出: 2867971860299718107233761438093672048294900000</span></span><br><span class="line">  </span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;123456789000&quot;</span>);</span><br><span class="line">        System.out.println(i.longValue()); <span class="comment">// 输出: 123456789000</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(i.multiply(i).longValueExact()); <span class="comment">// 将抛出 java.lang.ArithmeticException</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;BigInteger out of long range&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，我们创建了一个<em>BigInteger</em>对象，并计算了它的五次方。然后，我们尝试将一个大<em>BigInteger</em>值转换为<em>long</em>类型，当转换结果超出<em>long</em>的范围时，捕获并处理了<em>ArithmeticException</em>异常。</p>
<p>总的来说，<em>BigInteger</em>是一个非常强大的类，它允许Java程序员处理超出标准整数类型范围的数值。不过，需要注意的是，使用<em>BigInteger</em>可能会牺牲一些性能。</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven</title>
    <url>/2025/03/15/Maven/</url>
    <content><![CDATA[<blockquote>
<p>Maven是管理Java项目根据，apache旗下一个东西</p>
</blockquote>
<ul>
<li>当前市场上的主流是Maven</li>
</ul>
<h3 id="1-Maven的基本概念"><a href="#1-Maven的基本概念" class="headerlink" title="1. Maven的基本概念"></a>1. <strong>Maven的基本概念</strong></h3><ul>
<li><p><strong>构建生命周期</strong>: Maven通过一组预定义的构建生命周期来管理项目的构建过程。最常用的生命周期有三个：</p>
<ul>
<li><strong>clean</strong>: 清理项目的输出目录。</li>
<li><strong>default</strong>: 执行项目的构建过程，包括编译、测试、打包等。</li>
<li><p><strong>site</strong>: 生成项目的文档。</p>
<p>每个生命周期由多个阶段组成，Maven会按照一定的顺序执行这些阶段。</p>
</li>
</ul>
</li>
<li><p><strong>插件和目标</strong>: Maven通过插件来扩展功能，每个插件包含若干个目标（goals）。比如，编译Java代码的插件是<code>maven-compiler-plugin</code>，它的目标是<code>compile</code>。</p>
</li>
<li><p><strong>依赖管理</strong>: Maven使用POM文件（<code>pom.xml</code>）来管理项目的依赖、构建配置等信息。每个依赖都由以下几部分定义：</p>
<ul>
<li><strong>Group ID</strong>: 依赖所属的组。</li>
<li><strong>Artifact ID</strong>: 依赖的唯一标识符。</li>
<li><strong>Version</strong>: 依赖的版本。</li>
</ul>
</li>
<li><strong>仓库</strong>: Maven通过仓库来存储和获取依赖项。可以是本地仓库、中央仓库或私有仓库。</li>
</ul>
<h3 id="2-Maven的优点"><a href="#2-Maven的优点" class="headerlink" title="2. Maven的优点"></a>2. <strong>Maven的优点</strong></h3><ol>
<li>方便快捷的依赖管理</li>
</ol>
<p>在正常情况下我们要引入jar包需要在主目录下新建一个lib文件，在lib文件内引入下载好的jar包，使用Maven管理后只需要在pom.xml文件内配置对应信息即可让项目自动下载</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>自动配置好了commons-io, 直接可以更换版本等，很方便</p>
<ol>
<li><p>标准化的跨平台的项目操作</p>
</li>
<li><p>统一的项目结构</p>
</li>
</ol>
<p>Eclipse和idea之间的项目不是互通的，但是使用Maven之后，不管用什么工具都可以共享</p>
<p>Maven是一个强大的构建工具，主要用于Java项目的构建、依赖管理、项目管理等。它简化了开发过程，尤其是在处理复杂的项目时。下面是对Maven的一些核心概念和使用的详细讲解：</p>
<h3 id="3-POM文件详解"><a href="#3-POM文件详解" class="headerlink" title="3. POM文件详解"></a>3. <strong>POM文件详解</strong></h3><p><code>pom.xml</code>是Maven项目的核心配置文件。它包含了项目的所有信息，如项目版本、依赖、插件等。一个典型的<code>pom.xml</code>文件结构如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Maven的工作原理和配置方法非常强大，通过正确配置<code>pom.xml</code>和使用适当的插件，你可以大大简化构建过程，提高开发效率。</p>
<h3 id="4-Maven-坐标"><a href="#4-Maven-坐标" class="headerlink" title="4. Maven 坐标"></a>4. Maven 坐标</h3><ul>
<li>坐标是资源jar的唯一标识</li>
<li>主要组成<ul>
<li>groupId: 定义隶属组织名称</li>
<li>artifactId: 定义Maven项目名称</li>
<li>version: 定义当前版本号<ul>
<li>SNAPSHOT: 功能不稳定</li>
<li>RELEASE： 功能趋于稳定，可以发行（如果没写那就是这个）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-Maven导入"><a href="#5-Maven导入" class="headerlink" title="5. Maven导入"></a>5. Maven导入</h3><ul>
<li>方式一： File -&gt; Project Structure -&gt; Modules -&gt; Import Module -&gt; 选择maven项目的pom.xml</li>
<li>方式二： maven面板 -&gt; +(Add Maven Project) -&gt; 选择maven的pom.xml</li>
</ul>
<blockquote>
<p>注意，导入的时候建议是先导入到自己的目录下，然后选择xml进行导入</p>
</blockquote>
<h3 id="6-Maven使用"><a href="#6-Maven使用" class="headerlink" title="6. Maven使用"></a>6. Maven使用</h3><ol>
<li><p><strong>安装Maven</strong>: 你可以通过<a href="https://maven.apache.org/download.cgi">官网下载</a>Maven的二进制文件，然后配置环境变量（<code>MAVEN_HOME</code>和<code>PATH</code>）以便在命令行使用。</p>
</li>
<li><p><strong>初始化Maven项目</strong>: 使用以下命令创建一个新的Maven项目：</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=com.example -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> 这会生成一个包含<code>pom.xml</code>和默认目录结构（如<code>src/main/java</code>）的Java项目。</p>
</li>
<li><p><strong>管理依赖</strong>: 在<code>pom.xml</code>文件中定义项目的依赖。示例如下：<br> 使用dependencies， 引入坐标, 如果不知道依赖的坐标信息，可以去<a href="https://mvnrepository.com/">MVN坐标搜索</a>中搜索</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><strong>排除依赖</strong>： 指主动断开资源<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>排除依赖内的不需要资源<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>具体东西<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>一旦配置依赖发送改变，记得去刷新， 如果引入依赖本地仓库不存在，记得连网</p>
</blockquote>
<h3 id="6-Maven的生命周期"><a href="#6-Maven的生命周期" class="headerlink" title="6. Maven的生命周期"></a>6. Maven的生命周期</h3><p>生命周期包含三个</p>
<ul>
<li>clean<ul>
<li>clean</li>
</ul>
</li>
<li>default<ul>
<li>compile</li>
<li>test</li>
<li>packet</li>
<li>install</li>
</ul>
</li>
<li>site</li>
</ul>
<blockquote>
<p>在<strong>同一套</strong>项目中，运行后面的项目的时候，前面的项目都会运行(注意同一套哈)</p>
</blockquote>
<h3 id="7-Maven常用命令"><a href="#7-Maven常用命令" class="headerlink" title="7. Maven常用命令"></a>7. <strong>Maven常用命令</strong></h3><ul>
<li><strong><code>mvn clean</code></strong>: 清理项目，删除<code>target</code>目录。</li>
<li><strong><code>mvn compile</code></strong>: 编译项目。</li>
<li><strong><code>mvn test</code></strong>: 运行单元测试。</li>
<li><strong><code>mvn package</code></strong>: 打包项目，生成可执行的JAR或WAR文件。</li>
<li><strong><code>mvn install</code></strong>: 将项目安装到本地仓库。</li>
<li><strong><code>mvn deploy</code></strong>: 将项目部署到远程仓库。</li>
</ul>
<p>可以使用命令行，也可以直接点击Maven栏目内对应按钮（lifecycle， 底层调用Plugen中的插件）</p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>后端</tag>
      </tags>
  </entry>
  <entry>
    <title>Tarjan</title>
    <url>/2024/10/03/Tarjan/</url>
    <content><![CDATA[<ul>
<li><h3 id="强连通分量"><a href="#强连通分量" class="headerlink" title="强连通分量"></a>强连通分量</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dfn</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">low</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">f</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="type">int</span> dfncnt = <span class="number">0</span>, flag = <span class="number">0</span>;</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; st;</span><br><span class="line"><span class="keyword">auto</span> tarjan = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">    dfn[u] = low[u] = ++dfncnt;</span><br><span class="line">    st.<span class="built_in">push</span>(u);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">self</span>(self, v);</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (f[v] == <span class="number">0</span>) &#123;</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dfn[u] == low[u]) &#123;</span><br><span class="line">        ++flag;</span><br><span class="line">        <span class="keyword">while</span> (st.<span class="built_in">top</span>() != u) &#123;</span><br><span class="line">            f[st.<span class="built_in">top</span>()] = flag;</span><br><span class="line">            st.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        st.<span class="built_in">pop</span>();</span><br><span class="line">        f[u] = flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dfn[i] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">tarjan</span>(tarjan, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><h3 id="求割点"><a href="#求割点" class="headerlink" title="求割点"></a>求割点</h3></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dfn</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">low</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">cut</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="type">int</span> dfncnt = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> tarjan = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">    dfn[u] = low[u] = ++dfncnt;</span><br><span class="line">    <span class="type">int</span> child = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">            child++;</span><br><span class="line">            <span class="built_in">self</span>(self, v);</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (low[v] &gt;= dfn[u] &amp;&amp; !cut[u]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (u != start || child &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                    cut[u] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> low[u] = <span class="built_in">min</span>(low[u], dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!dfn[i]) start = i, <span class="built_in">tarjan</span>(tarjan, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只要有一个孩子回不到原来的点（也就是low[v] 》 dfn[u] ， 那么这个点就是割点，注意如果是起点要额外加上有两个儿子这个条件</p>
<h2 id="割边"><a href="#割边" class="headerlink" title="割边"></a>割边</h2><h2 id="点双连通分量"><a href="#点双连通分量" class="headerlink" title="点双连通分量"></a>点双连通分量</h2><ul>
<li>在一张连通的无向图中，对于两个点 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="u"> 和 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="v">，如果无论删去哪个点（只能删去一个）都不能使它们不连通，我们就说 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="u"> 和 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="v"> <strong>点双连通</strong></li>
</ul>
<h2 id="边双连通分量"><a href="#边双连通分量" class="headerlink" title="边双连通分量"></a>边双连通分量</h2><ul>
<li>在一张连通的无向图中，对于两个点 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="u"> 和 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="v">，如果无论删去哪条边（只能删去一个，且不能删 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="u"> 和 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="v"> 自己）都不能使它们不连通，我们就说 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="u"> 和 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="v"> <strong>边双连通</strong></li>
</ul>
<blockquote>
<p>性质：</p>
</blockquote>
<ul>
<li>边双连通具有传递性，即，若x , y <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="x,y"> 边双连通，y, z<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="y,z"> 边双连通，则 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="" title="x,z">x , z 边双连通。</li>
<li>点双连通不具有传递性。</li>
</ul>
<h3 id="边双缩点：边双树"><a href="#边双缩点：边双树" class="headerlink" title="边双缩点：边双树"></a>边双缩点：边双树</h3><p>就像强联通分量缩点一样，我们可以把每一个边双缩成一个点来处理一些问题，然后这些点之间由原来的割边相连形成了一棵树。</p>
<p>最后得出一定是一棵树（森林），如果不是树，那就有环，环就是个边双。</p>
<p>就像强连通分量分解把一般有向图变成了有向无环图一样，我们把无向图的问题转到了树上，更好处理了，同时也保存了原来无向图的信息。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dfn</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">low</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">f</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="type">int</span> dfncnt = <span class="number">0</span>, flag = <span class="number">0</span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">bridge</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; stk;</span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> tarjan = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u, <span class="type">int</span> fa) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">    dfn[u] = low[u] = ++dfncnt;</span><br><span class="line">    stk.<span class="built_in">push</span>(u);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> lin = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == fa) &#123;</span><br><span class="line">            lin++; <span class="keyword">if</span> (lin == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">            <span class="built_in">self</span>(self, v, u);</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            low[u] = <span class="built_in">min</span>(low[u], dfn[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (low[u] == dfn[u]) &#123;</span><br><span class="line">        ++flag;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; g;</span><br><span class="line">        <span class="keyword">while</span> (stk.<span class="built_in">top</span>() != u) &#123;</span><br><span class="line">            f[stk.<span class="built_in">top</span>()] = flag;</span><br><span class="line">            g.<span class="built_in">push_back</span>(stk.<span class="built_in">top</span>());</span><br><span class="line">            stk.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        g.<span class="built_in">push_back</span>(stk.<span class="built_in">top</span>());</span><br><span class="line">        stk.<span class="built_in">pop</span>();</span><br><span class="line">        f[u] = flag;</span><br><span class="line">        ans.<span class="built_in">push_back</span>(g);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!dfn[i]) <span class="built_in">tarjan</span>(tarjan, i, <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把边缩掉之后图会变成一颗树，那么在这之上的操作性质会更好</p>
]]></content>
      <categories>
        <category>算法</category>
        <category>图论</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>git简单使用</title>
    <url>/2025/03/01/git%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<ul>
<li><h3 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h3><ul>
<li>直接 <code>git init</code>将对应目录下一个文件夹变成git仓库</li>
<li>使用<code>git clone</code>从github上克隆一个已经有的项目到指定文件夹<blockquote>
<p>检查.git文件创建成功，不能直接ls，因为ls不会显示》.git 得使用ls -a显示</p>
</blockquote>
</li>
</ul>
</li>
<li><h3 id="git仓库包括两种"><a href="#git仓库包括两种" class="headerlink" title="git仓库包括两种:"></a>git仓库包括两种:</h3><ul>
<li>本地仓库</li>
<li>远程仓库</li>
</ul>
</li>
<li><p>commit : 提交，将本地文件和版本信息保存到本地仓库</p>
</li>
<li>push: 推送，将本地仓库和版本信息提交到远程仓库</li>
<li>pull : 拉取，将远程仓库文件和版本信息下载到本地文件</li>
</ul>
<hr>
<ul>
<li>git GUI : 图形界面</li>
</ul>
<hr>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><blockquote>
<p>使用git</p>
</blockquote>
<h4 id="1-全局设置"><a href="#1-全局设置" class="headerlink" title="1. 全局设置"></a>1. 全局设置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name 你的名字</span><br><span class="line">git confih --global user.email 你的邮箱</span><br></pre></td></tr></table></figure>
<p>查看配置信息:<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure></p>
<ul>
<li>上面设置的是git的初始化仓库，和github和gitee等的账号不一样</li>
</ul>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li>版本库：前面看到的.git隐藏文件夹就是版本库，版本库中储存了配置信息，日志文件，版本信息等</li>
<li>工作区： 包含.git文件夹目录的工作区，也称为工作目录，主要用于存放代码</li>
<li>暂存区： .git文件夹有很多文件，其中一个index文件就是暂存区，也可以叫做stage，是一个临时保存文件的地方</li>
</ul>
<p>工作区 ——&gt; (git add) 暂存区 ——-&gt;(git commit)版本库</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git add 文件 //支持多个文件同时加入</span><br></pre></td></tr></table></figure></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git commit -m &#x27;输入提示语&#x27; 文件名字</span><br></pre></td></tr></table></figure>
<h3 id="工作区文件状态"><a href="#工作区文件状态" class="headerlink" title="工作区文件状态"></a>工作区文件状态</h3><blockquote>
<p>git文件工作区分两个状态</p>
</blockquote>
<ul>
<li>untracked 未跟踪(未被纳入版本库)</li>
<li>tracked     已被跟踪(纳入版本控制)<br>  1)Unmodified 未被修改状态<br>  2）Modified   已被修改状态<br>  3）Staged      已暂存状态<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git status // 查看当前工作区的状态</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<ul>
<li>git reset<br>1.把暂存区的东西放回工作区<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset + 文件//取消对文件的跟踪（从暂存区取消暂存，返回工作区）</span><br></pre></td></tr></table></figure>
2.回退版本(通过git log 查看版本号)<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset --hard 版本号</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>git commit将暂存区的内容提交到版本库<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git commit -m &#x27;你这一次提交的修改内容&#x27; 你要提交或者修改了的文件</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="远程仓库操作"><a href="#远程仓库操作" class="headerlink" title="远程仓库操作"></a>远程仓库操作</h3><p><code>git remote//查看远程仓库</code><br><code>git remote -v//查看详细信息</code></p>
<ul>
<li><p>添加远程仓库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git remote add &lt;short name&gt; &lt;url&gt; //short_name一般是origin</span><br></pre></td></tr></table></figure>
</li>
<li><p>推送：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git push [remote_name] [branch_name] // 一般remote用origin代替</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="分支操作"><a href="#分支操作" class="headerlink" title="分支操作"></a>分支操作</h3><ul>
<li>git branch 查看分支</li>
<li>git branch [ name ] 创建分支</li>
<li>git checkout [name] 切换分支</li>
<li>git push [short_name】[name]  推送到远程仓库</li>
<li>git merge [name] 合并分支(把指定代码合并到当前分支)</li>
<li>git branch -d [name] 删除分支</li>
</ul>
<h4 id="分支查看："><a href="#分支查看：" class="headerlink" title="分支查看："></a>分支查看：</h4><ul>
<li>git branch 列出所有本地分支</li>
<li>git branch -r 列出所有远程分支</li>
<li>git branch -a 列出所有本地分支和远程分支</li>
</ul>
<hr>
<blockquote>
<p>标签</p>
</blockquote>
<ul>
<li>git tag 列出已有的标签</li>
<li>git tag [name] 创建标签</li>
<li>git push [short_name] 【name] 将标签推送到远程仓库</li>
<li>git checkout -b [branch] 【name] 检出标签</li>
</ul>
<h3 id="查看最后一次使用某个文件的某人"><a href="#查看最后一次使用某个文件的某人" class="headerlink" title="查看最后一次使用某个文件的某人"></a>查看最后一次使用某个文件的某人</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git log -x 文件名</span><br></pre></td></tr></table></figure>
<ul>
<li>-x是第几次</li>
</ul>
<h3 id="查看修改摩尔个文件中的collections时的提交信息"><a href="#查看修改摩尔个文件中的collections时的提交信息" class="headerlink" title="查看修改摩尔个文件中的collections时的提交信息"></a>查看修改摩尔个文件中的collections时的提交信息</h3><p>git blame , git show<br>或者使用git log</p>
<ul>
<li><code>git config</code>: Git 是一个 <a href="https://git-scm.com/docs/git-config">高度可定制的</a> 工具</li>
<li><code>git clone --depth=1</code>: 浅克隆（shallow clone），不包括完整的版本历史信息</li>
<li><code>git add -p</code>: 交互式暂存</li>
<li><code>git rebase -i</code>: 交互式变基</li>
<li><code>git blame</code>: 查看最后修改某行的人</li>
<li><code>git stash</code>: 暂时移除工作目录下的修改内容</li>
<li><code>git bisect</code>: 通过二分查找搜索历史记录</li>
<li><code>.gitignore</code>: <a href="https://git-scm.com/docs/gitignore">指定</a> 故意不追踪的文件</li>
</ul>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP / UDP</title>
    <url>/2024/12/26/hehehe/</url>
    <content><![CDATA[<ul>
<li>OSI七层网络模型</li>
</ul>
<p>从下往上 ： 物理层， 数据链路层，网络层，运输层， 会话层，表示层，应用层</p>
<ul>
<li>TCP/ IP</li>
</ul>
<h3 id="网络协议是什么"><a href="#网络协议是什么" class="headerlink" title="网络协议是什么"></a><a href="https://so.csdn.net/so/search?q=%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE&amp;spm=1001.2101.3001.7020">网络协议</a>是什么</h3><ul>
<li>在计算机网络要做到井井有条的交换数据，就必须遵守一些事先约定好的规则，比如交换数据的格式、是否需要发送一个应答信息。这些规则被称为网络协议。</li>
</ul>
<h3 id="为什么要对网络协议分层"><a href="#为什么要对网络协议分层" class="headerlink" title="为什么要对网络协议分层"></a>为什么要对网络协议分层</h3><ul>
<li>简化问题难度和复杂度。由于各层之间独立，我们可以分割大问题为小问题。</li>
<li>灵活性好。当其中一层的技术变化时，只要层间接口关系保持不变，其他层不受影响。</li>
<li>易于实现和维护。</li>
<li>促进标准化工作。分开后，每层功能可以相对简单地被描述![[OSI.png]]</li>
</ul>
<p><strong>1、UDP 和 TCP 的特点与区别</strong></p>
<p><strong>用户数据报协议 UDP（User Datagram Protocol）</strong></p>
<p>是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部），支持一对一、一对多、多对一和多对多的交互通信。</p>
<p><strong>传输控制协议 TCP（Transmission Control Protocol）</strong></p>
<p>是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），每一条 TCP 连接只能是点对点的（一对一）。</p>
<p><strong>TCP拥塞控制</strong>是<a href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE" title="传输控制协议">传输控制协议</a>（英语：Transmission Control Protocol，缩写TCP）避免网络拥塞的算法，是<a href="https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91" title="互联网">互联网</a>上主要的一个<a href="https://zh.wikipedia.org/wiki/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6" title="拥塞控制">拥塞控制</a>措施。它使用一套基于<a href="https://zh.wikipedia.org/wiki/%E5%92%8C%E6%80%A7%E5%A2%9E%E9%95%BF/%E4%B9%98%E6%80%A7%E9%99%8D%E4%BD%8E" title="和性增长/乘性降低">线增积减模式</a>的多样化网络拥塞控制方法（包括慢启动和拥塞窗口等模式）来控制拥塞。<a href="https://zh.wikipedia.org/zh-cn/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6#cite_note-1">[1]</a><a href="https://zh.wikipedia.org/zh-cn/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6#cite_note-2">[2]</a><a href="https://zh.wikipedia.org/zh-cn/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6#cite_note-3">[3]</a><a href="https://zh.wikipedia.org/zh-cn/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6#cite_note-4">[4]</a><a href="https://zh.wikipedia.org/zh-cn/TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6#cite_note-5">[5]</a>在互联网上应用中有相当多的具体实现算法。</p>
<p>![[{3B980C8E-4290-4775-9A0E-701F2F915A2F}.png]]![[{C2356D64-8E5C-4E3A-A3A8-E8D6517C3212}.png]]</p>
<p>TCP结构：<br>序号 :</p>
<p>确认号： </p>
<p>数据偏移：</p>
<p><strong>控制位：</strong>八位从左到右分别是 CWR，ECE，URG，ACK，PSH，RST，SYN，FIN。</p>
<p><strong>CWR：</strong>CWR 标志与后面的 ECE 标志都用于 IP 首部的 ECN 字段，ECE 标志为 1 时，则通知对方已将拥塞窗口缩小；</p>
<p><strong>ECE：</strong>若其值为 1 则会通知对方，从对方到这边的网络有阻塞。在收到数据包的 IP 首部中 ECN 为 1 时将 TCP 首部中的 ECE 设为 1；</p>
<p><strong>URG：</strong>该位设为 1，表示包中有需要紧急处理的数据，对于需要紧急处理的数据，与后面的紧急指针有关；</p>
<p><strong>ACK：</strong>该位设为 1，确认应答的字段有效，TCP规定除了最初建立连接时的 SYN 包之外该位必须设为 1；</p>
<p><strong>PSH：</strong>该位设为 1，表示需要将收到的数据立刻传给上层应用协议，若设为 0，则先将数据进行缓存；</p>
<p><strong>RST：</strong>该位设为 1，表示 TCP 连接出现异常必须强制断开连接；</p>
<p><strong>SYN：</strong>用于建立连接，该位设为 1，表示希望建立连接，并在其序列号的字段进行序列号初值设定；</p>
<p><strong>FIN：</strong>该位设为 1，表示今后不再有数据发送，希望断开连接。当通信结束希望断开连接时，通信双方的主机之间就可以相互交换 FIN 位置为 1 的 TCP 段。</p>
<p>每个主机又对对方的 FIN 包进行确认应答之后可以断开连接。不过，主机收到 FIN 设置为 1 的 TCP 段之后不必马上回复一个 FIN 包，而是可以等到缓冲区中的所有数据都因为已成功发送而被自动删除之后再发 FIN 包；</p>
<p><strong>窗口：</strong>窗口值作为接收方让发送方设置其发送窗口的依据。之所以要有这个限制，是因为接收方的数据缓存空间是有限的。</p>
<h2 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a>TCP三次握手</h2><ul>
<li><p>第一次 从发送方主机  -&gt; 接收方主机<br>ACK = 0, SYN = 1; 选择一个序列号 Seq = x</p>
</li>
<li><p>第二次 从接收方主机 -&gt; 发送方主机<br>ACK = 1, SYN = 1; 返回Seq = x + 1同时选择一个序列号 ACKnum = y</p>
</li>
<li><p>第三次， 从发送方主机 -&gt; 接受方主机<br>ACK = 1; ACKnum = y + 1</p>
</li>
</ul>
<p>建立连接</p>
<blockquote>
<p>使用TCP三次握手的原因</p>
<ul>
<li>确认双方的发送和接收消息的能力是正常的</li>
</ul>
</blockquote>
<p>注意到建立连接一般是 三次握手 </p>
<h2 id="TCP的四次挥手"><a href="#TCP的四次挥手" class="headerlink" title="TCP的四次挥手"></a>TCP的四次挥手</h2><ul>
<li><p>第一次 从发送方 -&gt; 接送方主机<br>FIN = 1， Seq = x</p>
</li>
<li><p>第二次 从接收方 -&gt; 发送方<br>ACK = 1， ACKnum = x + 1;</p>
</li>
</ul>
<hr>
<pre><code>中间有一段服务端确认（CLOSEWAIT）， 等待 服务端 所有 传输剩下的报文段发送完毕 
</code></pre><ul>
<li><p>第三次 从接收方 -&gt; 发送方<br>FIN = 1， Seq = y</p>
</li>
<li><p>第四次 从发送方 -&gt; 接收方</p>
</li>
</ul>
<hr>
<pre><code>之后是客户端的TIME_WAIT， 等待 2 MSL （报文段最大存活时间）后关闭连接
</code></pre><h2 id="TCP-短连接和长连接的区别"><a href="#TCP-短连接和长连接的区别" class="headerlink" title="TCP 短连接和长连接的区别"></a><strong>TCP 短连接和长连接的区别</strong></h2><p><strong>短连接：</strong>Client 向 Server 发送消息，Server 回应 Client，然后一次读写就完成了，这时候双方任何一个都可以发起 close 操作，不过一般都是 Client 先发起 close 操作。短连接一般只会在 Client/Server 间传递一次读写操作。</p>
<p>短连接的优点：管理起来比较简单，建立存在的连接都是有用的连接，不需要额外的控制手段。</p>
<p><strong>长连接：</strong>Client 与 Server 完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。</p>
<p>在长连接的应用场景下，Client 端一般不会主动关闭它们之间的连接，Client 与 Server 之间的连接如果一直不关闭的话，随着客户端连接越来越多，Server 压力也越来越大，这时候 Server 端需要采取一些策略，如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致 Server 端服务受损；如果条件再允许可以以客户端为颗粒度，限制每个客户端的最大长连接数，从而避免某个客户端连累后端的服务。</p>
<h3 id="粘包和拆包"><a href="#粘包和拆包" class="headerlink" title="粘包和拆包"></a>粘包和拆包</h3><ul>
<li>粘包 ： 在从 客户端 到 服务端过程中两个包连在一起 叫做粘包</li>
<li>拆包 ： ————————————————————————-之后还拆分成两个与原来不同的数据段叫做拆包</li>
</ul>
<blockquote>
<p>什么时候发生粘包和拆包？<br>    答案 : </p>
<pre><code>1. 在发送的数据超过TCP缓冲区最大空间时候可能发生拆包
2. 发送的数据大于MSS（最大报文长度）， 发生拆包
3. 发送的数据小于TCP缓冲区最小空间可能发生粘包
4. 接受数据端应用层没有及时读取缓冲区的数据
</code></pre></blockquote>
<p>粘包拆包解决办法 : </p>
<ul>
<li><strong>消息定长</strong> ： 每个数据包固定长度（不够的拿0去填补），这样接收端每次接受的都是固定长度的数据，就可以分开</li>
<li><strong>设置消息边界</strong> ： 服务端在接受时候， 按照分割边界把消息分割， 如 FTP协议（通过设置一个换行符）</li>
</ul>
<h3 id="TCP的可靠传输"><a href="#TCP的可靠传输" class="headerlink" title="TCP的可靠传输"></a>TCP的可靠传输</h3><blockquote>
<p>TCP采用超时重传实现可靠传输 ： 当某一个信息发送后在超时时间内没有收到确认就重传这个报文段（从发送到接受的时间是RTT， 可以自己计算）</p>
</blockquote>
<h3 id="TCP滑动窗口"><a href="#TCP滑动窗口" class="headerlink" title="TCP滑动窗口"></a>TCP滑动窗口</h3><blockquote>
<p>TCP发送窗口， 和接受窗口内的数据段都是可接受或者可以发送的，当发送方的某个报文段已经被确认后， 窗口会向右移动一段距离， 更新可以接受和被接受的报文段</p>
</blockquote>
<h3 id="TCP的流量控制"><a href="#TCP的流量控制" class="headerlink" title="TCP的流量控制"></a>TCP的流量控制</h3><blockquote>
<p>TCP通过控制窗口大小实现流量的控制<br>为了避免发送不出数据， 接收方会时不时发送一个 <strong>窗口探测</strong> 的数据段（只包含一个字节）来确定最新的窗口大小</p>
</blockquote>
<h2 id="TCP的拥塞控制"><a href="#TCP的拥塞控制" class="headerlink" title="TCP的拥塞控制"></a>TCP的拥塞控制</h2><blockquote>
<p><strong>主要通过四个算法</strong>：慢开始，拥塞避免，快重传，快恢复</p>
</blockquote>
<p>维护一个拥塞窗口（cwnd），注意道拥塞窗口只是一个状态变量</p>
<p>假设接收方有足够大的接收窗口，窗口的大小为报文段</p>
<ul>
<li><p>慢开始和拥塞避免</p>
<pre><code> 最开始执行满开始，让cwnd = 1，之后每当接受确认，就倍增 2 4 8 ....再设置一个慢开始门限ssthresh，当慢开始大于这个门限的时候进入拥塞避免，每个轮次让cwnd + 1
 1   
 如果出现了超时，就另慢开始门限 = cwnd / 2，重新开始慢开始
</code></pre></li>
<li><p>快重传和快恢复</p>
<pre><code>  接收方每次接收报文都应该对最后一次收到的报文进行确认，例如收到了B1， B2， B4
  则在收到B2时候要对B1确认，B4时候要对B2确认
  当发送方重复收到3次接收方发来的某个相同的报文的确认时，立即执行快重传（因为这时候知道有报文丢失），在这种情况下是报文段的丢失，不是网络拥塞，所以直接执行快恢复，让慢开始上限（ssthresh）= 拥塞窗口（cwnd） / 2；注意此时直接进入拥塞避免
</code></pre></li>
</ul>
<blockquote>
<p>注意 慢开始和快恢复的慢和快指的是cwnd的设定值，慢开始cwnd设置成1，快开始cwnd设置成ssthresh</p>
</blockquote>
]]></content>
      <categories>
        <category>计算机网络</category>
      </categories>
  </entry>
  <entry>
    <title>lombok</title>
    <url>/2025/03/10/lombok/</url>
    <content><![CDATA[<h2 id="1-Lombok简介"><a href="#1-Lombok简介" class="headerlink" title="1.Lombok简介"></a>1.Lombok简介</h2><p>官方介绍<br>Project Lombok is a java library that automatically plugs into your editor and build tools, spicing up your java.Never write another getter or equals method again, with one annotation your class has a fully featured builder, Automate your logging variables, and much more.</p>
<p>大概的意思：Lombok是一个Java库，能自动插入编辑器并构建工具，简化Java开发。通过添加注解的方式，不需要为类编写getter或eques方法，同时可以自动化日志变量。官网链接</p>
<p>简而言之：Lombok能以简单的注解形式来简化java代码，提高开发人员的开发效率。<br>博客及源码GitHub链接</p>
<h2 id="Lombok使用"><a href="#Lombok使用" class="headerlink" title=".Lombok使用"></a>.Lombok使用</h2><p>使用Lombok需要的开发环境Java+Maven+IntelliJ IDEA或者Eclipse(安装Lombok Plugin)</p>
<h3 id="2-1添加maven依赖"><a href="#2-1添加maven依赖" class="headerlink" title="2.1添加maven依赖"></a>2.1添加maven依赖</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-2安装插件"><a href="#2-2安装插件" class="headerlink" title="2.2安装插件"></a>2.2安装插件</h3><p>使用Lombok还需要插件的配合，我使用开发工具为idea，这里只讲解idea中安装lombok插件，使用eclipse和myeclipse的小伙伴和自行google安装方法。<br>打开idea的设置，点击Plugins，点击Browse repositories，在弹出的窗口中搜索lombok，然后安装即可。</p>
<h3 id="2-3解决编译时出错问题"><a href="#2-3解决编译时出错问题" class="headerlink" title="2.3解决编译时出错问题"></a>2.3解决编译时出错问题</h3><p>编译时出错，可能是没有enable注解处理器。Annotation Processors &gt; Enable annotation processing。设置完成之后程序正常运行。</p>
<h3 id="2-4示例"><a href="#2-4示例" class="headerlink" title="2.4示例"></a>2.4示例</h3><p>下面举两个栗子，看看使用lombok和不使用的区别。</p>
<p>创建一个用户类</p>
<p>不使用Lombok<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">8054600833969507380L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(id, user.id) &amp;&amp;</span><br><span class="line">                Objects.equals(username, user.username) &amp;&amp;</span><br><span class="line">                Objects.equals(age, user.age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(id, username, age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>使用Lombok</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">8054600833969507380L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>编译源文件，然后反编译class文件，反编译结果如下图。说明@Data注解在类上，会为类的所有属性自动生成setter/getter、equals、canEqual、hashCode、toString方法，如为final属性，则不会为该属性生成setter方法。</p>
<p>自动化日志变量<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping((&quot;/user&quot;))</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getUserById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;风清扬&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">21</span>);</span><br><span class="line">        user.setId(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (log.isInfoEnabled()) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;用户 &#123;&#125;&quot;</span>, user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>通过反编译可以看到@Slf4j注解生成了log日志变量（严格意义来说是常量），无需去声明一个log就可以在类中使用log记录日志。</p>
<h3 id="2-5常用注解"><a href="#2-5常用注解" class="headerlink" title="2.5常用注解"></a>2.5常用注解</h3><p>下面介绍一下常用的几个注解：</p>
<ul>
<li>@Setter 注解在类或字段，注解在类时为所有字段生成setter方法，注解在字段上时只为该字段生成setter方法。<ul>
<li>@Getter 使用方法同上，区别在于生成的是getter方法。</li>
<li>@ToString 注解在类，添加toString方法。</li>
<li>@EqualsAndHashCode 注解在类，生成hashCode和equals方法。</li>
<li>@NoArgsConstructor 注解在类，生成无参的构造方法。</li>
<li>@RequiredArgsConstructor 注解在类，为类中需要特殊处理的字段生成构造方法，比如final和被@NonNull注解的字段。</li>
<li>@AllArgsConstructor 注解在类，生成包含类中所有字段的构造方法。</li>
<li>@Data 注解在类，生成setter/getter、equals、canEqual、hashCode、toString方法，如为final属性，则不会为该属性生成setter方法。</li>
<li>@Slf4j 注解在类，生成log变量，严格意义来说是常量。private static final Logger log = LoggerFactory.getLogger(UserController.class);</li>
</ul>
</li>
</ul>
<h2 id="3-Lombok工作原理"><a href="#3-Lombok工作原理" class="headerlink" title="3.Lombok工作原理"></a>3.Lombok工作原理</h2><p>在Lombok使用的过程中，只需要添加相应的注解，无需再为此写任何代码。自动生成的代码到底是如何产生的呢？</p>
<p>核心之处就是对于注解的解析上。JDK5引入了注解的同时，也提供了两种解析方式。</p>
<p>运行时解析<br>运行时能够解析的注解，必须将@Retention设置为RUNTIME，这样就可以通过反射拿到该注解。java.lang.reflect反射包中提供了一个接口AnnotatedElement，该接口定义了获取注解信息的几个方法，Class、Constructor、Field、Method、Package等都实现了该接口，对反射熟悉的朋友应该都会很熟悉这种解析方式。</p>
<p>编译时解析<br>编译时解析有两种机制，分别简单描述下：</p>
<h3 id="1）Annotation-Processing-Tool"><a href="#1）Annotation-Processing-Tool" class="headerlink" title="1）Annotation Processing Tool"></a>1）Annotation Processing Tool</h3><p>apt自JDK5产生，JDK7已标记为过期，不推荐使用，JDK8中已彻底删除，自JDK6开始，可以使用Pluggable Annotation Processing API来替换它，apt被替换主要有2点原因：</p>
<p>api都在com.sun.mirror非标准包下<br>没有集成到javac中，需要额外运行</p>
<h3 id="2）Pluggable-Annotation-Processing-API"><a href="#2）Pluggable-Annotation-Processing-API" class="headerlink" title="2）Pluggable Annotation Processing API"></a>2）Pluggable Annotation Processing API</h3><p>JSR 269自JDK6加入，作为apt的替代方案，它解决了apt的两个问题，javac在执行的时候会调用实现了该API的程序，这样我们就可以对编译器做一些增强，javac执行的过程如下：</p>
<p>Lombok本质上就是一个实现了“JSR 269 API”的程序。在使用javac的过程中，它产生作用的具体流程如下：</p>
<p>javac对源代码进行分析，生成了一棵抽象语法树（AST）<br>运行过程中调用实现了“JSR 269 API”的Lombok程序<br>此时Lombok就对第一步骤得到的AST进行处理，找到@Data注解所在类对应的语法树（AST），然后修改该语法树（AST），增加getter和setter方法定义的相应树节点<br>javac使用修改后的抽象语法树（AST）生成字节码文件，即给class增加新的节点（代码块）<br>通过读Lombok源码，发现对应注解的实现都在HandleXXX中，比如@Getter注解的实现在HandleGetter.handle()。还有一些其它类库使用这种方式实现，比如Google Auto、Dagger等等。</p>
<h3 id="4-Lombok的优缺点"><a href="#4-Lombok的优缺点" class="headerlink" title="4.Lombok的优缺点"></a>4.Lombok的优缺点</h3><p>优点：</p>
<p>能通过注解的形式自动生成构造器、getter/setter、equals、hashcode、toString等方法，提高了一定的开发效率<br>让代码变得简洁，不用过多的去关注相应的方法<br>属性做修改时，也简化了维护为这些属性所生成的getter/setter方法等<br>缺点：</p>
<p>不支持多种参数构造器的重载<br>虽然省去了手动创建getter/setter方法的麻烦，但大大降低了源代码的可读性和完整性，降低了阅读源代码的舒适度</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>分块</title>
    <url>/2025/03/04/%E5%88%86%E5%9D%97/</url>
    <content><![CDATA[<p>分块就是将一段数据分成一些小块， 对每个块单独处理使其不超过时间限制, 分块更多是一种思想，他介于线段树和树状数组之间。</p>
<hr>
<h2 id="一-给出一个长为-n-的数列，以及-n-个操作，操作涉及区间加法，区间求和。"><a href="#一-给出一个长为-n-的数列，以及-n-个操作，操作涉及区间加法，区间求和。" class="headerlink" title="一.给出一个长为 n 的数列，以及 n 个操作，操作涉及区间加法，区间求和。"></a>一.给出一个长为 n 的数列，以及 n 个操作，操作涉及区间加法，区间求和。</h2><p>输入格式</p>
<p>第一行输入一个数字 n。</p>
<p>第二行输入 n 个数字，第 i 个数字为 a_i，以空格隔开。</p>
<p>接下来输入 n 行询问，每行输入四个数字 \mathrm{opt}、l、r、c，以空格隔开。</p>
<p>若 \mathrm{opt} = 0，表示将位于 [l, r] 的之间的数字都加 c。</p>
<p>若 \mathrm{opt} = 1，表示询问位于 [l, r] 的所有数字的和 \bmod (c+1)。</p>
<p><strong>思路</strong> : </p>
<ul>
<li><p>将数组分块每次加的时候，如果L与R在同一块里面，直接遍历该数组，最差时间复杂度O(nsqrt(n))，如果不是<br> 则将与左右两个块相同的数组内数字直接操作，将两个之间的用一个类似Lazytag的数组保存修改两量，</p>
</li>
<li><p>同理对于查询时候，如果L与R属于同一个块，则直接遍历，最差时间复杂度是O(nsqrt(n))</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    i64 n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    i64 len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">b</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">f</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">p</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        f[i] = (i - <span class="number">1</span>) / len + <span class="number">1</span>;</span><br><span class="line">        b[f[i]] += a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> add = [&amp;](i64 l, i64 r, i64 c) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        i64 g = f[l], h = f[r];</span><br><span class="line">        <span class="keyword">if</span> (g == h) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">                b[f[i]] += c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; f[i] == f[l]; i++) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">                b[f[i]] += c;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = r; f[i] == f[r]; i--) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">                b[f[i]] += c;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = f[l] + <span class="number">1</span>; i &lt; f[r]; i++) &#123;</span><br><span class="line">                p[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> query = [&amp;](i64 l, i64 r, i64 c) -&gt; i64 &#123;</span><br><span class="line">        <span class="keyword">if</span> (f[l] == f[r]) &#123;</span><br><span class="line">            i64 sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                sum = (sum + a[i] + p[f[i]]) % (c + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i64 sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; f[i] == f[l]; i++) &#123;</span><br><span class="line">                sum = (sum + a[i] + p[f[i]]) % (c + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 j = r; f[j] == f[r]; j--) &#123;</span><br><span class="line">                sum = (sum + a[j] + p[f[j]]) % (c + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = f[l] + <span class="number">1</span>; i &lt; f[r]; i++) &#123;</span><br><span class="line">                sum = (sum + b[i] + p[i] * len) % (c + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        i64 opt, l, r, c;</span><br><span class="line">        cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">add</span>(l, r, c);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">query</span>(l, r, c) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二-给出一个长为-n-的数列，以及-n-个操作，操作涉及区间加法，询问区间内小于某个值-x-的元素个数。"><a href="#二-给出一个长为-n-的数列，以及-n-个操作，操作涉及区间加法，询问区间内小于某个值-x-的元素个数。" class="headerlink" title="二. 给出一个长为 n 的数列，以及 n 个操作，操作涉及区间加法，询问区间内小于某个值 x 的元素个数。"></a>二. 给出一个长为 n 的数列，以及 n 个操作，操作涉及区间加法，询问区间内小于某个值 x 的元素个数。</h2><p>输入格式</p>
<p>第一行输入一个数字 n。</p>
<p>第二行输入 n 个数字，第 i 个数字为 a_i，以空格隔开。</p>
<p>接下来输入 n 行询问，每行输入四个数字 \mathrm{opt}、l、r、c，以空格隔开。</p>
<p>若 \mathrm{opt} = 0，表示将位于 [l, r] 的之间的数字都加 c。</p>
<p>若 \mathrm{opt} = 1，表示询问 [l, r] 中，小于 c^2 的数字的个数。</p>
<p>输出格式</p>
<p>对于每次询问，输出一行一个数字表示答案。</p>
<p>样例</p>
<p><strong>输入复制</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">4</span><br><span class="line">1 2 2 3</span><br><span class="line">0 1 3 1</span><br><span class="line">1 1 3 2</span><br><span class="line">1 1 4 1</span><br><span class="line">1 2 3 2</span><br></pre></td></tr></table></figure>
<p><strong>输出复制</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3</span><br><span class="line">0</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>数据范围与提示</p>
<p>对于 100\% 的数据，1 \leq n \leq 50000, -2^{31} \leq \mathrm{others}、\mathrm{ans} \leq 2^{31}-1。</p>
<p><strong>思路</strong><br>    一样分块后：<br>        加法时：</p>
<pre><code>         - 当$id[l] == id[r]$ 时候直接暴力遍历，最坏复杂度O\(nsqrt\(n\)\)
         - 当$id[l] != id[r]$ 时候： 先处理两个裂块， 暴力维护。对于完整的块，每个块设置一个复制数组，操作后对这个块内进行sort， 时间复杂度$O(log(sqrt(n))$ 套个n后也可以过。
    询问时：
          - 当$id[l] == id[r]$ 时候直接暴力遍历，最坏复杂度O\(nsqrt\(n\)\)
          - 当$id[l] != id[r]$ 时候： 先处理两个裂块， 暴力维护。对于完整的块，块内二分单调复制数组b，找到块内比$c*c$ 小的数字个数。 
</code></pre><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">b</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">id</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">g</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">cnt</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        id[i] = (i - <span class="number">1</span>) / len + <span class="number">1</span>;</span><br><span class="line">        b[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> work = [&amp;](<span class="type">int</span> id) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="type">int</span> st = <span class="number">1</span> + (id - <span class="number">1</span>) * len;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = st; i &lt; <span class="built_in">min</span>(n + <span class="number">1</span>, st + len); i++) &#123;</span><br><span class="line">            b[i] = a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(b.<span class="built_in">begin</span>() + st, <span class="built_in">min</span>(b.<span class="built_in">end</span>(), b.<span class="built_in">begin</span>() + st + len));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i += len) &#123;</span><br><span class="line">        <span class="built_in">work</span>(id[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> add = [&amp;](<span class="type">int</span> l, <span class="type">int</span> r, i64 c) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[l] == id[r]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">work</span>(id[l]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; id[l] == id[i]; i++) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">work</span>(id[l]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = r; id[r] == id[i]; i--) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">work</span>(id[r]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = id[l] + <span class="number">1</span>; i &lt; id[r]; i++) &#123;</span><br><span class="line">                g[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> query = [&amp;](<span class="type">int</span> l, <span class="type">int</span> r, i64 c) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[l] == id[r]) &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] + g[id[i]] &lt; c) &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; id[i] == id[l]; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] + g[id[i]] &lt; c) &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = r; id[i] == id[r]; i--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] + g[id[i]] &lt; c) &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = id[l] + <span class="number">1</span>; i &lt; id[r]; i++) &#123;</span><br><span class="line">                <span class="type">int</span> l = <span class="number">1</span> + (i - <span class="number">1</span>) * len, r = i * len;</span><br><span class="line">                <span class="type">int</span> ls = l;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">                    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (g[id[mid]] + b[mid] &lt; c) &#123;</span><br><span class="line">                        l = mid + <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        r = mid - <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> res = <span class="built_in">max</span>(<span class="number">0</span>, r - ls + <span class="number">1</span>);</span><br><span class="line">                sum += res;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        i64 opt, l, r, c;</span><br><span class="line">        cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">add</span>(l, r, c);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">query</span>(l, r, c * c) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三-区间加法，询问区间内小于某个值-x-的前驱（比其小的最大元素）。"><a href="#三-区间加法，询问区间内小于某个值-x-的前驱（比其小的最大元素）。" class="headerlink" title="三. 区间加法，询问区间内小于某个值 x 的前驱（比其小的最大元素）。"></a>三. 区间加法，询问区间内小于某个值 x 的前驱（比其小的最大元素）。</h2><p><strong>题目描述</strong></p>
<p>给出一个长为 n 的数列，以及 n 个操作，操作涉及区间加法，询问区间内小于某个值 x 的前驱（比其小的最大元素）。</p>
<p><strong>输入格式</strong></p>
<p>第一行输入一个数字 n。</p>
<p>第二行输入 n 个数字，第 i 个数字为 a_i，以空格隔开。</p>
<p>接下来输入 n 行询问，每行输入四个数字 \mathrm{opt}、l、r、c，以空格隔开。</p>
<p>若 \mathrm{opt} = 0，表示将位于 [l, r] 的之间的数字都加 c。</p>
<p>若 \mathrm{opt} = 1，表示询问 [l, r] 中 c 的前驱的值（不存在则输出 -1）。</p>
<p><strong>输出格式</strong></p>
<p>对于每次询问，输出一行一个数字表示答案。</p>
<p><strong>样例</strong></p>
<p>输入复制</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">4</span><br><span class="line">1 2 2 3</span><br><span class="line">0 1 3 1</span><br><span class="line">1 1 4 4</span><br><span class="line">0 1 2 2</span><br><span class="line">1 1 2 4</span><br></pre></td></tr></table></figure>
<p>输出复制</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3</span><br><span class="line">-1</span><br></pre></td></tr></table></figure>
<p>数据范围与提示</p>
<p>对于 100\% 的数据，1 \leq n \leq 100000, -2^{31} \leq \mathrm{others}、\mathrm{ans} \leq 2^{31}-1。</p>
<p>思路：同题目二，将每个块排序</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    i64 n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    i64 len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">b</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">g</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">id</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">        id[i] = (i - <span class="number">1</span>) / len + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> work = [&amp;](i64 id) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        i64 st = <span class="number">1</span> + (id - <span class="number">1</span>) * len;</span><br><span class="line">        <span class="keyword">for</span> (i64 i = st; i &lt; <span class="built_in">min</span>(n + <span class="number">1</span>, st + len); i++) &#123;</span><br><span class="line">            b[i] = a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(b.<span class="built_in">begin</span>() + st, <span class="built_in">min</span>(b.<span class="built_in">end</span>(), b.<span class="built_in">begin</span>() + st + len));</span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i += len) &#123;</span><br><span class="line">        <span class="built_in">work</span>(id[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> add = [&amp;](i64 l, i64 r, i64 c) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[l] == id[r]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">work</span>(id[l]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; id[i] == id[l]; i++) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">work</span>(id[l]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = r; id[i] == id[r]; i--) &#123;</span><br><span class="line">                a[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">work</span>(id[r]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = id[l] + <span class="number">1</span>; i &lt; id[r]; i++) &#123;</span><br><span class="line">                g[i] += c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> query = [&amp;](i64 l, i64 r, i64 c) -&gt; i64 &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[l] == id[r]) &#123;</span><br><span class="line">            i64 ans = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] + g[id[i]] &lt; c) &#123;</span><br><span class="line">                    ans = <span class="built_in">max</span>(ans, a[i] + g[id[i]]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i64 ans = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span> (i64 i = l; id[l] == id[i]; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] + g[id[i]] &lt; c) &#123;</span><br><span class="line">                    ans = <span class="built_in">max</span>(ans, a[i] + g[id[i]]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = r; id[i] == id[r]; i--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] + g[id[i]] &lt; c) &#123;</span><br><span class="line">                    ans = <span class="built_in">max</span>(ans, a[i] + g[id[i]]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (i64 i = id[l] + <span class="number">1</span>; i &lt; id[r]; i++) &#123;</span><br><span class="line">                i64 l = <span class="number">1</span> + (i - <span class="number">1</span>) * len, r = i * len;</span><br><span class="line">                i64 mid;</span><br><span class="line">                <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">                    mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (b[mid] + g[id[mid]] &lt; c) &#123;</span><br><span class="line">                        ans = <span class="built_in">max</span>(ans, b[mid] + g[id[mid]]);</span><br><span class="line">                        l = mid + <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        r = mid - <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i64 i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        i64 opt, l, r, c;</span><br><span class="line">        cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">query</span>(l, r, c) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">add</span>(l, r, c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数列4：开方，区间求和"><a href="#数列4：开方，区间求和" class="headerlink" title="数列4：开方，区间求和"></a>数列4：开方，区间求和</h2><p>给出一个长为 n 的数列 a_1 \ldots a_n，以及 n 个操作，操作涉及区间开方，区间求和。</p>
<p>输入格式</p>
<p>第一行输入一个数字 n。</p>
<p>第二行输入 n 个数字，第 i 个数字为 a_i，以空格隔开。</p>
<p>接下来输入 n 行询问，每行输入四个数字 \mathrm{opt}, l, r, c，以空格隔开。</p>
<p>若 \mathrm{opt} = 0，表示将位于 [l, r] 的之间的数字都开方。对于区间中每个 a_i(l\le i\le r),\: a_i \leftarrow \left\lfloor \sqrt{a_i}\right\rfloor</p>
<p>若 \mathrm{opt} = 1，表示询问位于 [l, r] 的所有数字的和。</p>
<blockquote>
<p>思路：</p>
</blockquote>
<p>对于1e9范围内的整数，开方最多7次就会变成1， 和线段树一样，如果区间内所有都是1就跳过，否则遍历开方，更新现在状态</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">a</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        cin &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="type">int</span> siz = n / len + ((n % len) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//cerr &lt;&lt; siz &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">b</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">id</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">c</span><span class="params">(siz + <span class="number">1</span>)</span>, <span class="title">ov</span><span class="params">(siz + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        id[i] = (i - <span class="number">1</span>) / len + <span class="number">1</span>;</span><br><span class="line">        c[id[i]]++;</span><br><span class="line">        b[id[i]] += a[i];</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] == <span class="number">1</span>) &#123;</span><br><span class="line">            ov[id[i]]++; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> f = [&amp;](<span class="type">int</span> l, <span class="type">int</span> r) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[l] == id[r]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i] != <span class="number">1</span>) &#123;</span><br><span class="line">                    b[id[i]] -= a[i];</span><br><span class="line">                    a[i] = (i64)<span class="built_in">sqrt</span>(a[i]);</span><br><span class="line">                    b[id[i]] += a[i];</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (a[i] == <span class="number">1</span>) &#123;</span><br><span class="line">                        ov[id[i]]++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = l; id[i] == id[l]; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i] != <span class="number">1</span>) &#123;</span><br><span class="line">                b[id[i]] -= a[i];</span><br><span class="line">                a[i] = (i64)<span class="built_in">sqrt</span>(a[i]);</span><br><span class="line">                b[id[i]] += a[i];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (a[i] == <span class="number">1</span>) &#123;</span><br><span class="line">                    ov[id[i]]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r; id[i] == id[r]; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i] != <span class="number">1</span>) &#123;</span><br><span class="line">                b[id[i]] -= a[i];</span><br><span class="line">                a[i] = (i64)<span class="built_in">sqrt</span>(a[i]);</span><br><span class="line">                b[id[i]] += a[i];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (a[i] == <span class="number">1</span>) &#123;</span><br><span class="line">                    ov[id[i]]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = id[l] + <span class="number">1</span>; i &lt; id[r]; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ov[i] != c[i]) &#123;</span><br><span class="line">                <span class="comment">//cerr &lt;&lt; &quot;F:&quot; &lt;&lt; i &lt;&lt; &#x27; &#x27;;</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span> + (i - <span class="number">1</span>) * len; j &lt;= i * len; j++) &#123;</span><br><span class="line">                    <span class="comment">//cout &lt;&lt; id[j] &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">                    <span class="keyword">if</span> (a[j] != <span class="number">1</span>) &#123;</span><br><span class="line">                        b[id[j]] -= a[j];</span><br><span class="line">                        a[j] = (<span class="type">int</span>)<span class="built_in">sqrt</span>(a[j]);</span><br><span class="line">                        b[id[j]] += a[j];</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (a[j] == <span class="number">1</span>) &#123;</span><br><span class="line">                            ov[id[j]]++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> query = [&amp;](<span class="type">int</span> l, <span class="type">int</span> r) -&gt; i64 &#123;</span><br><span class="line">        <span class="keyword">if</span> (id[l] == id[r]) &#123;</span><br><span class="line">            i64 ans = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; i++) &#123;</span><br><span class="line">                ans += a[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        &#125;</span><br><span class="line">        i64 res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = l; id[i] == id[l]; i++) &#123;</span><br><span class="line">            res += a[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = id[l] + <span class="number">1</span>; i &lt; id[r]; i++) &#123;</span><br><span class="line">            res += b[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r; id[i] == id[r]; i--) &#123;</span><br><span class="line">            res += a[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> opt, l, r, c;</span><br><span class="line">        cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">f</span>(l, r);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">query</span>(l, r) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
        <category>数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>反射</title>
    <url>/2025/03/08/%E5%8F%8D%E5%B0%84/</url>
    <content><![CDATA[<h2 id="1-反射机制概述"><a href="#1-反射机制概述" class="headerlink" title="1. 反射机制概述"></a>1. 反射机制概述</h2><p>Java 的反射机制允许程序在运行时获取类的信息，并对其进行操作，而无需在编译时知道具体的类结构。简单来说，反射使得程序可以动态加载类、检查类的成员（字段、方法、构造函数等）、调用方法和创建对象。正因为这种动态性，反射在很多框架（如 Spring、Hibernate）、依赖注入、动态代理等领域中被广泛使用。</p>
<hr>
<h2 id="2-基本使用"><a href="#2-基本使用" class="headerlink" title="2. 基本使用"></a>2. 基本使用</h2><h3 id="2-1-获取-Class-对象"><a href="#2-1-获取-Class-对象" class="headerlink" title="2.1 获取 Class 对象"></a>2.1 获取 Class 对象</h3><p>反射的入口是 <code>java.lang.Class</code> 对象，获取方式主要有三种：</p>
<ol>
<li><p><strong>使用 <code>.class</code> 语法：</strong></p>
<p> java</p>
<p> 复制编辑</p>
<p> <code>Class&lt;String&gt; clazz1 = String.class;</code></p>
</li>
<li><p><strong>通过对象的 <code>getClass()</code> 方法：</strong></p>
<p> java</p>
<p> 复制编辑</p>
<p> <code>String str = &quot;Hello&quot;; Class&lt;?&gt; clazz2 = str.getClass();</code></p>
</li>
<li><p><strong>使用 <code>Class.forName()</code> 方法：</strong><br> 适合动态加载类，传入类的全限定名。</p>
<p> java</p>
<p> 复制编辑</p>
<p> <code>Class&lt;?&gt; clazz3 = Class.forName(&quot;java.lang.String&quot;);</code></p>
</li>
</ol>
<h3 id="2-2-访问字段（Field）"><a href="#2-2-访问字段（Field）" class="headerlink" title="2.2 访问字段（Field）"></a>2.2 访问字段（Field）</h3><p>可以通过 <code>getField()</code>（仅限 public 字段）或 <code>getDeclaredField()</code>（包括 private 字段）来获取字段对象，并通过 <code>Field.set()</code> 或 <code>Field.get()</code> 进行读写操作。</p>
<ul>
<li><p><strong>示例：访问 public 字段</strong></p>
<p>  java</p>
<p>  复制编辑</p>
<p>  <code>class Person &#123;     public String name; &#125;  Person p = new Person(); Field nameField = p.getClass().getField(&quot;name&quot;); nameField.set(p, &quot;Alice&quot;); System.out.println(p.name); // 输出：Alice</code></p>
</li>
<li><p><strong>示例：访问 private 字段</strong></p>
<p>  java</p>
<p>  复制编辑</p>
<p>  <code>class Person &#123;     private int age; &#125;  Person p = new Person(); Field ageField = p.getClass().getDeclaredField(&quot;age&quot;); ageField.setAccessible(true);  // 关闭访问控制检查 ageField.set(p, 30); System.out.println(ageField.get(p)); // 输出：30</code></p>
</li>
</ul>
<h3 id="2-3-调用方法（Method）"><a href="#2-3-调用方法（Method）" class="headerlink" title="2.3 调用方法（Method）"></a>2.3 调用方法（Method）</h3><p>同样地，利用 <code>getMethod()</code> 和 <code>getDeclaredMethod()</code> 分别获取 public 和所有方法（包括 private），通过 <code>Method.invoke()</code> 来调用方法。</p>
<ul>
<li><p><strong>示例：调用 public 方法</strong></p>
<p>  java</p>
<p>  复制编辑</p>
<p>  <code>class Dog &#123;     public void bark() &#123;         System.out.println(&quot;Woof!&quot;);     &#125; &#125;  Dog dog = new Dog(); Method barkMethod = dog.getClass().getMethod(&quot;bark&quot;); barkMethod.invoke(dog);  // 输出：Woof!</code></p>
</li>
<li><p><strong>示例：调用 private 方法</strong></p>
<p>  java</p>
<p>  复制编辑</p>
<p>  <code>class Dog &#123;     private void secret() &#123;         System.out.println(&quot;Secret method invoked!&quot;);     &#125; &#125;  Dog dog = new Dog(); Method secretMethod = dog.getClass().getDeclaredMethod(&quot;secret&quot;); secretMethod.setAccessible(true); secretMethod.invoke(dog);  // 输出：Secret method invoked!</code></p>
</li>
</ul>
<h3 id="2-4-构造函数和对象创建（Constructor）"><a href="#2-4-构造函数和对象创建（Constructor）" class="headerlink" title="2.4 构造函数和对象创建（Constructor）"></a>2.4 构造函数和对象创建（Constructor）</h3><p>通过反射也可以调用构造函数来创建对象，即使构造函数是 private 的</p>
<ul>
<li>isVarArgs : 是否泛型</li>
<li>getParamaterTypes:  以Class数组形式按照声明顺序获得构造方法的各个参数类型</li>
<li>getExceptionTypes: 以Class数组形式获得该构造方法可能抛出的异常</li>
<li>newInstance() : 通过对应参数的构造方法调用 <strong>public</strong> 或者 <strong>protected</strong> 构造函数</li>
<li>setAccessible() : 设置权限（true， false）</li>
<li>getModifiers() : 获得可以解析出该构造方法所修饰的整数</li>
</ul>
<blockquote>
<p>Modifiers类：</p>
</blockquote>
<ul>
<li>isPublic</li>
<li>isProtected</li>
<li>isPrivate</li>
<li>isStatic</li>
<li>isFinal</li>
<li>toString</li>
</ul>
<ul>
<li><strong>示例：通过构造函数创建对象</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;  </span><br><span class="line"><span class="keyword">import</span> java.util.*;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ex1</span> &#123;  </span><br><span class="line">    String s;  </span><br><span class="line">    <span class="type">int</span> i, i2, i3;  </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ex1</span><span class="params">()</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">ex1</span><span class="params">(String s, <span class="type">int</span> i)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.s = s;  </span><br><span class="line">        <span class="built_in">this</span>.i = i;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ex1</span><span class="params">(String... strings)</span> <span class="keyword">throws</span> NumberFormatException &#123;  </span><br><span class="line">        <span class="keyword">if</span> (strings.length &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">            i = Integer.valueOf(strings[<span class="number">0</span>]);  </span><br><span class="line">        &#125;        <span class="keyword">if</span> (strings.length &gt; <span class="number">1</span>) &#123;  </span><br><span class="line">            i = Integer.valueOf(strings[<span class="number">1</span>]);  </span><br><span class="line">        &#125;        <span class="keyword">if</span> (strings.length &gt; <span class="number">2</span>) &#123;  </span><br><span class="line">            i = Integer.valueOf(strings[<span class="number">2</span>]);  </span><br><span class="line">        &#125;    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;s = &quot;</span> + s);  </span><br><span class="line">        System.out.println(<span class="string">&quot;i = &quot;</span> + i);  </span><br><span class="line">        System.out.println(<span class="string">&quot;i2 = &quot;</span> + i2);  </span><br><span class="line">        System.out.println(<span class="string">&quot;i3 = &quot;</span> + i3);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">ex1</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ex1</span>(<span class="string">&quot;10&quot;</span>, <span class="string">&quot;20&quot;</span>, <span class="string">&quot;30&quot;</span>);  </span><br><span class="line">        Class&lt;? <span class="keyword">extends</span> <span class="title class_">ex1</span>&gt; exc = e.getClass();  </span><br><span class="line">        Constructor[] declareConstructors = e.getClass().getDeclaredConstructors();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; declareConstructors.length; i++) &#123;  </span><br><span class="line">            Constructor&lt;?&gt; constructor = declareConstructors[i];  </span><br><span class="line">            System.out.println(<span class="string">&quot;查看是否可变化参数变量:&quot;</span> + constructor.isVarArgs());  </span><br><span class="line">  </span><br><span class="line">            System.out.println(<span class="string">&quot;构造方法的参数依次是:&quot;</span>);  </span><br><span class="line">            Class[] parameterTypes = constructor.getParameterTypes();  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> x : parameterTypes) &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot; &quot;</span> + x);  </span><br><span class="line">            &#125;  </span><br><span class="line">            System.out.println(<span class="string">&quot;可能抛出的异常&quot;</span>);  </span><br><span class="line">            Class[] exceptionTypes = constructor.getExceptionTypes();  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> x : exceptionTypes) &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot; &quot;</span> + x);  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="type">ex1</span> <span class="variable">ex2</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">            <span class="keyword">while</span> (ex2 == <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;  </span><br><span class="line">                        ex2 = (ex1)constructor.newInstance();  </span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;  </span><br><span class="line">                        ex2 = (ex1)constructor.newInstance(<span class="string">&quot;7&quot;</span>, <span class="number">5</span>);  </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                        Object[] tp = <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;100&quot;</span>, <span class="string">&quot;200&quot;</span>, <span class="string">&quot;300&quot;</span> &#125;&#125;;  </span><br><span class="line">                        ex2 = (ex1)constructor.newInstance(tp);  </span><br><span class="line">                    &#125;                </span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception err) &#123;  </span><br><span class="line">                    System.out.println(<span class="string">&quot;访问量私有构造方法，下面执行setAccessible方法&quot;</span>);  </span><br><span class="line">                    constructor.setAccessible(<span class="literal">true</span>);  </span><br><span class="line">                &#125;            </span><br><span class="line">            &#125;            </span><br><span class="line">            <span class="keyword">if</span> (ex2 != <span class="literal">null</span>) &#123;  </span><br><span class="line">                ex2.print();  </span><br><span class="line">                System.out.println();  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-实现原理"><a href="#3-实现原理" class="headerlink" title="3. 实现原理"></a>3. 实现原理</h2><p>Java 反射机制依赖于 JVM 在加载类时将类的元数据信息（如类名、字段、方法、构造函数、注解等）存储在内存中的 <code>Class</code> 对象中。反射 API 就是通过读取这些元数据实现动态操作的：</p>
<ul>
<li><p><strong>类元数据：</strong><br>  每个被加载的类都有一个对应的 <code>Class</code> 对象，它包含了所有类的结构信息。这个信息主要来源于编译后的 <code>.class</code> 文件。</p>
</li>
<li><p><strong>安全检查：</strong><br>  通过反射操作时（例如访问 private 字段），JVM 会进行安全检查。如果存在安全管理器（SecurityManager），在调用 <code>setAccessible(true)</code> 时会验证权限，防止随意突破封装。</p>
</li>
<li><p><strong>动态调用：</strong><br>  当你调用 <code>Method.invoke()</code> 时，JVM 内部会动态查找对应的方法并执行。由于这种动态查找机制，相比于直接调用方法，反射通常要慢一些。</p>
</li>
<li><p><strong>优化手段：</strong><br>  为了减少性能损失，常见的做法是<strong>缓存</strong>反射得到的 <code>Method</code>、<code>Field</code> 或 <code>Constructor</code> 对象。此外，Java 7 引入了 <code>MethodHandle</code>，通过这种方式可以获得比传统反射更高效的调用。</p>
</li>
</ul>
<h2 id="Java-注解（Annotation）详解"><a href="#Java-注解（Annotation）详解" class="headerlink" title="Java 注解（Annotation）详解"></a>Java 注解（Annotation）详解</h2><h3 id="1-什么是-Annotation（注解）？"><a href="#1-什么是-Annotation（注解）？" class="headerlink" title="1. 什么是 Annotation（注解）？"></a>1. 什么是 Annotation（注解）？</h3><p><strong>注解（Annotation）</strong> 是 Java 语言提供的一种<strong>元数据（Metadata）机制</strong>，可以用来<strong>标注代码</strong>，为编译器、运行时环境或其他工具提供额外的信息。</p>
<p>注解本身不会影响代码的逻辑运行，它们通常用于：</p>
<ul>
<li><strong>编译时检查</strong>（如 <code>@Override</code>）</li>
<li><strong>代码生成</strong>（如 Lombok 的 <code>@Getter</code>、<code>@Setter</code>）</li>
<li><strong>运行时处理</strong>（如 Spring 框架的 <code>@Autowired</code>）</li>
</ul>
<hr>
<h3 id="2-注解的常见作用"><a href="#2-注解的常见作用" class="headerlink" title="2. 注解的常见作用"></a>2. 注解的常见作用</h3><ol>
<li><strong>提供信息给编译器</strong><ul>
<li>帮助编译器检查错误，例如 <code>@Override</code></li>
</ul>
</li>
<li><strong>在运行时进行反射操作</strong><ul>
<li>通过反射获取注解信息，实现<strong>配置驱动</strong>开发，如 Spring 的 <code>@Component</code></li>
</ul>
</li>
<li><strong>生成代码</strong><ul>
<li>例如 Lombok 自动生成 <code>getter/setter</code> 方法</li>
</ul>
</li>
<li><strong>替代 XML 配置</strong><ul>
<li>例如 Spring Boot 用 <code>@Configuration</code> 代替 XML 进行 Bean 配置</li>
</ul>
</li>
</ol>
<hr>
<h3 id="3-常见的-Java-内置注解（标准注解）"><a href="#3-常见的-Java-内置注解（标准注解）" class="headerlink" title="3. 常见的 Java 内置注解（标准注解）"></a>3. 常见的 Java 内置注解（标准注解）</h3><h4 id="（1）编译时注解"><a href="#（1）编译时注解" class="headerlink" title="（1）编译时注解"></a>（1）编译时注解</h4><div class="table-container">
<table>
<thead>
<tr>
<th>注解名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Override</code></td>
<td>标记一个方法重写了父类方法，避免拼写错误</td>
</tr>
<tr>
<td><code>@Deprecated</code></td>
<td>标记方法已过时，调用时会有警告</td>
</tr>
<tr>
<td><code>@SuppressWarnings</code></td>
<td>关闭编译器警告，如 <code>@SuppressWarnings(&quot;unchecked&quot;)</code></td>
</tr>
<tr>
<td><code>@SafeVarargs</code></td>
<td>让编译器忽略泛型参数的类型安全警告</td>
</tr>
</tbody>
</table>
</div>
<h4 id="（2）元注解（用于定义自定义注解）"><a href="#（2）元注解（用于定义自定义注解）" class="headerlink" title="（2）元注解（用于定义自定义注解）"></a>（2）元注解（用于定义自定义注解）</h4><div class="table-container">
<table>
<thead>
<tr>
<th>注解名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Retention</code></td>
<td>指定注解的生命周期（SOURCE / CLASS / RUNTIME）</td>
</tr>
<tr>
<td><code>@Target</code></td>
<td>指定注解可用于哪些元素（类、方法、字段等）</td>
</tr>
<tr>
<td><code>@Documented</code></td>
<td>使注解出现在 JavaDoc 文档中</td>
</tr>
<tr>
<td><code>@Inherited</code></td>
<td>让注解可被子类继承</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="4-自定义注解"><a href="#4-自定义注解" class="headerlink" title="4. 自定义注解"></a>4. 自定义注解</h3><h4 id="（1）定义一个简单的注解"><a href="#（1）定义一个简单的注解" class="headerlink" title="（1）定义一个简单的注解"></a><strong>（1）定义一个简单的注解</strong></h4><p>java</p>
<p>复制编辑</p>
<p><code>import java.lang.annotation.*;  @Retention(RetentionPolicy.RUNTIME) // 运行时可用 @Target(ElementType.METHOD) // 只能用于方法 public @interface MyAnnotation &#123;     String value() default &quot;默认值&quot;; // 注解的参数 &#125;</code></p>
<h4 id="（2）在方法上使用该注解"><a href="#（2）在方法上使用该注解" class="headerlink" title="（2）在方法上使用该注解"></a><strong>（2）在方法上使用该注解</strong></h4><p>java</p>
<p>复制编辑</p>
<p><code>class Test &#123;     @MyAnnotation(value = &quot;Hello&quot;)     public void sayHello() &#123;         System.out.println(&quot;Hello, Annotation!&quot;);     &#125; &#125;</code></p>
<h4 id="（3）通过反射读取注解"><a href="#（3）通过反射读取注解" class="headerlink" title="（3）通过反射读取注解"></a><strong>（3）通过反射读取注解</strong></h4><p>java</p>
<p>复制编辑</p>
<p><code>import java.lang.reflect.Method;  public class Main &#123;     public static void main(String[] args) throws Exception &#123;         Method method = Test.class.getMethod(&quot;sayHello&quot;);         if (method.isAnnotationPresent(MyAnnotation.class)) &#123;             MyAnnotation annotation = method.getAnnotation(MyAnnotation.class);             System.out.println(&quot;注解值：&quot; + annotation.value());         &#125;     &#125; &#125;</code></p>
<p><strong>输出：</strong></p>
<p>复制编辑</p>
<p><code>注解值：Hello</code></p>
<hr>
<h3 id="5-注解的生命周期（RetentionPolicy）"><a href="#5-注解的生命周期（RetentionPolicy）" class="headerlink" title="5. 注解的生命周期（RetentionPolicy）"></a>5. 注解的生命周期（RetentionPolicy）</h3><p>注解的生命周期由 <code>@Retention</code> 指定，有三种：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>值</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SOURCE</code></td>
<td>仅存在于<strong>源码</strong>中，编译后会被丢弃（如 <code>@Override</code>）</td>
</tr>
<tr>
<td><code>CLASS</code></td>
<td>存在于<strong>class 文件</strong>中，但不会进入 JVM 运行时</td>
</tr>
<tr>
<td><code>RUNTIME</code></td>
<td>存在于<strong>运行时</strong>，可以通过<strong>反射</strong>获取（如 Spring 的 <code>@Autowired</code>）</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="6-Target-注解的作用"><a href="#6-Target-注解的作用" class="headerlink" title="6. @Target 注解的作用"></a>6. <code>@Target</code> 注解的作用</h3><p><code>@Target</code> 指定注解可以作用的代码元素：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>值</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ElementType.TYPE</code></td>
<td>只能作用于<strong>类</strong></td>
</tr>
<tr>
<td><code>ElementType.FIELD</code></td>
<td>只能作用于<strong>字段</strong></td>
</tr>
<tr>
<td><code>ElementType.METHOD</code></td>
<td>只能作用于<strong>方法</strong></td>
</tr>
<tr>
<td><code>ElementType.PARAMETER</code></td>
<td>只能作用于<strong>参数</strong></td>
</tr>
<tr>
<td><code>ElementType.CONSTRUCTOR</code></td>
<td>只能作用于<strong>构造方法</strong></td>
</tr>
<tr>
<td><code>ElementType.LOCAL_VARIABLE</code></td>
<td>只能作用于<strong>局部变量</strong></td>
</tr>
<tr>
<td><code>ElementType.ANNOTATION_TYPE</code></td>
<td>只能作用于<strong>注解</strong></td>
</tr>
<tr>
<td><code>ElementType.PACKAGE</code></td>
<td>只能作用于<strong>包</strong></td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="7-Java-框架中常见的注解"><a href="#7-Java-框架中常见的注解" class="headerlink" title="7. Java 框架中常见的注解"></a>7. Java 框架中常见的注解</h3><h4 id="（1）Spring-相关"><a href="#（1）Spring-相关" class="headerlink" title="（1）Spring 相关"></a><strong>（1）Spring 相关</strong></h4><div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Component</code></td>
<td>标记为 Spring 组件（Bean）</td>
</tr>
<tr>
<td><code>@Service</code></td>
<td>标记为业务层组件</td>
</tr>
<tr>
<td><code>@Repository</code></td>
<td>标记为数据访问层组件</td>
</tr>
<tr>
<td><code>@Autowired</code></td>
<td>自动注入依赖</td>
</tr>
<tr>
<td><code>@Transactional</code></td>
<td>事务管理</td>
</tr>
<tr>
<td><code>@RestController</code></td>
<td>组合了 <code>@Controller + @ResponseBody</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="（2）Junit-相关"><a href="#（2）Junit-相关" class="headerlink" title="（2）Junit 相关"></a><strong>（2）Junit 相关</strong></h4><div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Test</code></td>
<td>标记测试方法</td>
</tr>
<tr>
<td><code>@BeforeEach</code></td>
<td>在每个测试方法前执行</td>
</tr>
<tr>
<td><code>@AfterEach</code></td>
<td>在每个测试方法后执行</td>
</tr>
</tbody>
</table>
</div>
<h4 id="（3）Lombok"><a href="#（3）Lombok" class="headerlink" title="（3）Lombok"></a><strong>（3）Lombok</strong></h4><div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Getter</code></td>
<td>自动生成 getter 方法</td>
</tr>
<tr>
<td><code>@Setter</code></td>
<td>自动生成 setter 方法</td>
</tr>
<tr>
<td><code>@Data</code></td>
<td>组合 <code>@Getter</code>、<code>@Setter</code>、<code>@ToString</code></td>
</tr>
<tr>
<td><code>@Builder</code></td>
<td>生成建造者模式代码</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="8-什么时候使用注解？"><a href="#8-什么时候使用注解？" class="headerlink" title="8. 什么时候使用注解？"></a>8. 什么时候使用注解？</h3><ul>
<li><strong>简化代码</strong>：例如 Lombok 自动生成 <code>getter/setter</code></li>
<li><strong>配置驱动</strong>：Spring 依赖注入（<code>@Autowired</code>）</li>
<li><strong>运行时处理</strong>：Spring AOP（<code>@Transactional</code>）</li>
<li><strong>编译时检查</strong>：<code>@Override</code> 避免拼写错误</li>
<li><strong>替代 XML</strong>：Spring <code>@Configuration</code> 代替 XML 配置</li>
</ul>
<hr>
<h3 id="9-总结"><a href="#9-总结" class="headerlink" title="9. 总结"></a>9. 总结</h3><ul>
<li><strong>注解是 Java 的元数据机制</strong>，可以标记类、方法、字段等</li>
<li><strong>注解不会影响程序逻辑</strong>，但可以提供额外信息给编译器、工具或框架</li>
<li><strong>常见内置注解</strong>：<code>@Override</code>、<code>@Deprecated</code>、<code>@SuppressWarnings</code></li>
<li><strong>注解有生命周期（SOURCE、CLASS、RUNTIME）</strong>，影响其能否被反射获取</li>
<li><strong>可以自定义注解</strong>，并通过<strong>反射</strong>获取注解信息</li>
<li><strong>注解在 Java 框架（如 Spring、Junit、Lombok）中广泛使用</strong></li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>扫描线</title>
    <url>/2025/02/04/%E6%89%AB%E6%8F%8F%E7%BA%BF/</url>
    <content><![CDATA[<ul>
<li>矩形面积并</li>
</ul>
<p>将矩形划分为每个 行块 ， 一一统计出边和入边， 计算每条边的贡献， 以每条边计算 S<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Scanline</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, num;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; tag;</span><br><span class="line">    vector&lt;i64&gt; len, xx;</span><br><span class="line">    i64 S;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">        i64 y, lx, rx;</span><br><span class="line">        <span class="type">int</span> flag; <span class="comment">// 1是入边，-1是出边</span></span><br><span class="line">        <span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Line</span>(i64 y, i64 lx, i64 rx, <span class="type">int</span> flag) </span><br><span class="line">            : <span class="built_in">y</span>(y), <span class="built_in">lx</span>(lx), <span class="built_in">rx</span>(rx), <span class="built_in">flag</span>(flag) &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Line&amp; other) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;y &lt; other.y; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    vector&lt;Line&gt; line;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Scanline</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">num</span>(<span class="number">0</span>), <span class="built_in">S</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        tag.<span class="built_in">assign</span>(n * <span class="number">16</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        len.<span class="built_in">assign</span>(n * <span class="number">16</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(i64 x1, i64 x2, i64 y1, i64 y2)</span> </span>&#123;</span><br><span class="line">        line.<span class="built_in">emplace_back</span>(y1, x1, x2, <span class="number">1</span>);</span><br><span class="line">        xx.<span class="built_in">push_back</span>(x1);</span><br><span class="line">        line.<span class="built_in">emplace_back</span>(y2, x1, x2, <span class="number">-1</span>);</span><br><span class="line">        xx.<span class="built_in">push_back</span>(x2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[p]) &#123;</span><br><span class="line">            len[p] = xx[t] - xx[s]; </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s + <span class="number">1</span> == t) &#123;</span><br><span class="line">            len[p] = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            len[p] = len[p * <span class="number">2</span>] + len[p * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> flag, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= s &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">            tag[p] += flag;</span><br><span class="line">            <span class="built_in">pushup</span>(s, t, p);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> m = (s + t) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (l &lt; m) <span class="built_in">update</span>(l, r, flag, s, m, p * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (r &gt; m) <span class="built_in">update</span>(l, r, flag, m, t, p * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(s, t, p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">sort</span>(line.<span class="built_in">begin</span>(), line.<span class="built_in">end</span>());</span><br><span class="line">        num = <span class="built_in">unique</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">end</span>()) - xx.<span class="built_in">begin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; line.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                S += len[<span class="number">1</span>] * (line[i].y - line[i - <span class="number">1</span>].y);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> l = <span class="built_in">lower_bound</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">begin</span>() + num, line[i].lx) - xx.<span class="built_in">begin</span>();</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">lower_bound</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">begin</span>() + num, line[i].rx) - xx.<span class="built_in">begin</span>();</span><br><span class="line">            <span class="built_in">update</span>(l, r, line[i].flag, <span class="number">0</span>, num - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">i64 <span class="title">get_area</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> S;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>： 该线段树使用的是左闭右开区间。</p>
<ul>
<li>矩形周长并：<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Scanline</span> &#123; <span class="comment">//周长并</span></span><br><span class="line">    <span class="type">int</span> n, num;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; tag;</span><br><span class="line">    vector&lt;i64&gt; len, xx;</span><br><span class="line">    i64 C;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">        i64 y, lx, rx;</span><br><span class="line">        <span class="type">int</span> flag; <span class="comment">// 1是入边，-1是出边</span></span><br><span class="line">        <span class="built_in">Line</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Line</span>(i64 y, i64 lx, i64 rx, <span class="type">int</span> flag) </span><br><span class="line">            : <span class="built_in">y</span>(y), <span class="built_in">lx</span>(lx), <span class="built_in">rx</span>(rx), <span class="built_in">flag</span>(flag) &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Line&amp; other) <span class="type">const</span> &#123; </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;y != other.y) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;y &lt; other.y;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>-&gt;flag &gt; other.flag; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    vector&lt;Line&gt; line;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Scanline</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">num</span>(<span class="number">0</span>), <span class="built_in">C</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        tag.<span class="built_in">assign</span>(n * <span class="number">16</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        len.<span class="built_in">assign</span>(n * <span class="number">16</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(i64 x1, i64 x2, i64 y1, i64 y2)</span> </span>&#123;</span><br><span class="line">        line.<span class="built_in">emplace_back</span>(y1, x1, x2, <span class="number">1</span>);</span><br><span class="line">        xx.<span class="built_in">push_back</span>(x1);</span><br><span class="line">        line.<span class="built_in">emplace_back</span>(y2, x1, x2, <span class="number">-1</span>);</span><br><span class="line">        xx.<span class="built_in">push_back</span>(x2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tag[p]) &#123;</span><br><span class="line">            len[p] = xx[t] - xx[s] ;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s == t) &#123;</span><br><span class="line">            len[p] = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            len[p] = len[p * <span class="number">2</span>] + len[p * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> flag, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= s &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">            tag[p] += flag;</span><br><span class="line">            <span class="built_in">pushup</span>(s, t, p);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> m = (s + t) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (l &lt; m) <span class="built_in">update</span>(l, r, flag, s, m, p * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (r &gt; m) <span class="built_in">update</span>(l, r, flag, m, t, p * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(s, t, p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">sort</span>(line.<span class="built_in">begin</span>(), line.<span class="built_in">end</span>());</span><br><span class="line">        num = <span class="built_in">unique</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">end</span>()) - xx.<span class="built_in">begin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="type">int</span> pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; line.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            pre = len[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> l = <span class="built_in">lower_bound</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">begin</span>() + num, line[i].lx) - xx.<span class="built_in">begin</span>();</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">lower_bound</span>(xx.<span class="built_in">begin</span>(), xx.<span class="built_in">begin</span>() + num, line[i].rx) - xx.<span class="built_in">begin</span>();</span><br><span class="line">            <span class="built_in">update</span>(l, r, line[i].flag, <span class="number">0</span>, num - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            C += <span class="built_in">abs</span>(len[<span class="number">1</span>] - pre);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">i64 <span class="title">getlen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>算法</category>
        <category>数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>异常处理</title>
    <url>/2025/02/02/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<p>在 Java 的异常处理中，<code>throw</code> 关键字用于手动抛出一个异常对象，而 <code>throws</code> 关键字用于声明方法可能抛出的异常。下面详细介绍 Java 的最新异常处理机制及 <code>try-catch-throw</code> 的用法。</p>
<hr>
<h2 id="1-throw-关键字"><a href="#1-throw-关键字" class="headerlink" title="1. throw 关键字"></a>1. <code>throw</code> 关键字</h2><p><code>throw</code> 用于在代码中手动抛出一个异常，通常用于异常检测、错误处理或自定义异常。</p>
<h3 id="throw-的作用"><a href="#throw-的作用" class="headerlink" title="throw 的作用"></a><code>throw</code> 的作用</h3><p><code>throw</code> 关键字的主要作用是<strong>手动抛出异常</strong>，让程序在遇到错误时主动终止当前代码逻辑，并将异常交给上层代码处理。</p>
<p>在 Java 中，默认情况下，只有系统遇到错误时才会自动抛出异常，比如 <code>NullPointerException</code>、<code>ArithmeticException</code> 等。但有时候，我们需要<strong>自己定义错误情况</strong>，并主动抛出异常，让调用者知道发生了问题，这时候就用 <code>throw</code>。</p>
<h3 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> 异常类对象;`</span><br></pre></td></tr></table></figure>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThrowExample</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (age &lt; <span class="number">18</span>) &#123;             </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;未成年人不能注册！&quot;</span>);         </span><br><span class="line">        &#125;         </span><br><span class="line">        System.out.println(<span class="string">&quot;注册成功！&quot;</span>);     </span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;         </span><br><span class="line">        checkAge(<span class="number">15</span>); <span class="comment">// 这里会抛出异常     </span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="throw-的使用场景"><a href="#throw-的使用场景" class="headerlink" title="throw 的使用场景"></a><code>throw</code> 的使用场景</h3><h4 id="1-校验输入参数"><a href="#1-校验输入参数" class="headerlink" title="1. 校验输入参数"></a>1. <strong>校验输入参数</strong></h4><p>比如，我们要实现一个方法，它只能处理年龄 <code>&gt;= 18</code> 的情况，如果年龄小于 18，就应该报错：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThrowExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (age &lt; <span class="number">18</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;未成年人不能注册！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;注册成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        checkAge(<span class="number">15</span>); <span class="comment">// 这里会抛出异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>执行结果：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.IllegalArgumentException: 未成年人不能注册！</span><br></pre></td></tr></table></figure>
<p>👉 <strong>作用：</strong> 当 <code>age &lt; 18</code> 时，我们主动抛出 <code>IllegalArgumentException</code>，让程序停止执行，并告诉调用者<strong>年龄不符合要求</strong>。</p>
<hr>
<h4 id="2-避免错误值继续传播"><a href="#2-避免错误值继续传播" class="headerlink" title="2. 避免错误值继续传播"></a>2. <strong>避免错误值继续传播</strong></h4><p>假设我们有一个计算方法，但输入不能是负数，否则计算就没有意义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sqrt</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ArithmeticException</span>(<span class="string">&quot;负数不能开平方！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) Math.sqrt(num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(sqrt(-<span class="number">9</span>)); <span class="comment">// 抛出异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>执行结果：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.ArithmeticException: 负数不能开平方！</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>👉 <strong>作用：</strong> 这里如果不加 <code>throw</code>，<code>Math.sqrt(-9)</code> 可能会返回 <code>NaN</code>，影响计算结果。主动抛异常可以<strong>阻止错误继续传播</strong>，让调用者知道数据不合法。</p>
<hr>
<h4 id="3-在-catch-里重新抛出异常"><a href="#3-在-catch-里重新抛出异常" class="headerlink" title="3. 在 catch 里重新抛出异常"></a>3. <strong>在 catch 里重新抛出异常</strong></h4><p>有时候，程序捕获异常后，<strong>仍然希望把异常抛出去</strong>，让上层代码处理。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReThrowExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a / b;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;捕获异常，但继续抛出&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> e; <span class="comment">// 重新抛出异常</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        divide(<span class="number">10</span>, <span class="number">0</span>); <span class="comment">// 这里最终仍然会抛出异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>执行结果：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">捕获异常，但继续抛出</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.ArithmeticException: / by zero</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>👉 <strong>作用：</strong> 在 <code>catch</code> 里先记录日志，然后再用 <code>throw</code> 重新抛出异常，让外部调用者知道出错了。</p>
<hr>
<h3 id="4-抛出自定义异常"><a href="#4-抛出自定义异常" class="headerlink" title="4. 抛出自定义异常"></a>4. <strong>抛出自定义异常</strong></h3><p>如果 Java 自带的异常不够用，我们可以自己定义异常，并在 <code>throw</code> 里使用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomThrowExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkValue</span><span class="params">(<span class="type">int</span> value)</span> <span class="keyword">throws</span> MyException &#123;</span><br><span class="line">        <span class="keyword">if</span> (value &gt; <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyException</span>(<span class="string">&quot;数值不能大于 100！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            checkValue(<span class="number">150</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MyException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;自定义异常捕获：&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>执行结果：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">自定义异常捕获：数值不能大于 <span class="number">100</span>！</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2-throws-关键字"><a href="#2-throws-关键字" class="headerlink" title="2. throws 关键字"></a>2. <code>throws</code> 关键字</h2><p><code>throws</code> 用于声明方法可能抛出的异常，让调用者知道这个方法可能会抛出异常。</p>
<h3 id="语法：-1"><a href="#语法：-1" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">返回类型 方法名(...) <span class="keyword">throws</span> 异常类型<span class="number">1</span>, 异常类型<span class="number">2</span> &#123;     <span class="comment">// 可能会抛出异常的代码 &#125;`</span></span><br></pre></td></tr></table></figure>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThrowsExample</span> &#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> FileNotFoundException &#123;         </span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);         </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(file); <span class="comment">// 可能抛出 FileNotFoundException     </span></span><br><span class="line">    &#125;      </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;         </span><br><span class="line">        <span class="keyword">try</span> &#123;             </span><br><span class="line">            readFile(<span class="string">&quot;test.txt&quot;</span>);         </span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;             </span><br><span class="line">            System.out.println(<span class="string">&quot;文件未找到: &quot;</span> + e.getMessage());         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-try-catch-捕获异常"><a href="#3-try-catch-捕获异常" class="headerlink" title="3. try-catch 捕获异常"></a>3. <code>try-catch</code> 捕获异常</h2><p><code>try-catch</code> 语句用于捕获异常，并在 <code>catch</code> 块中处理异常，而不会导致程序终止。</p>
<h3 id="语法：-2"><a href="#语法：-2" class="headerlink" title="语法："></a>语法：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;     </span><br><span class="line">    <span class="comment">// 可能发生异常的代码 </span></span><br><span class="line">&#125; <span class="keyword">catch</span> (异常类型 变量) &#123;     </span><br><span class="line">    <span class="comment">// 处理异常 </span></span><br><span class="line">&#125;</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">**示例：**</span><br><span class="line"></span><br><span class="line">java</span><br><span class="line"></span><br><span class="line">复制编辑</span><br><span class="line"></span><br><span class="line">`<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TryCatchExample</span> &#123;     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;         <span class="keyword">try</span> &#123;             <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>; <span class="comment">// 可能抛出 ArithmeticException         &#125; catch (ArithmeticException e) &#123;             System.out.println(&quot;发生异常: &quot; + e.getMessage());         &#125;     &#125; &#125;`</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## <span class="number">4.</span> `<span class="keyword">try</span>-with-resources`（最新 Java 处理方式）</span><br><span class="line"></span><br><span class="line">Java <span class="number">7</span> 引入了 **<span class="keyword">try</span>-with-resources**，用于自动关闭实现 `AutoCloseable` 接口的资源（如文件、网络连接）。</span><br><span class="line"></span><br><span class="line">### 语法：</span><br><span class="line"></span><br><span class="line">```Java</span><br><span class="line"><span class="title function_">try</span> <span class="params">(资源声明)</span> &#123;</span><br><span class="line">    <span class="comment">// 使用资源的代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (异常类型 变量) &#123;</span><br><span class="line">    <span class="comment">// 处理异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>示例（自动关闭文件流）：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TryWithResourcesExample</span> &#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;         </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;test.txt&quot;</span>))) &#123;</span><br><span class="line">            System.out.println(reader.readLine());         </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;             </span><br><span class="line">            System.out.println(<span class="string">&quot;读取文件时发生错误: &quot;</span> + e.getMessage());         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在 <code>try</code> 块结束后，<code>BufferedReader</code> 会自动关闭，无需手动调用 <code>close()</code>。</p>
<hr>
<h2 id="5-finally-语句"><a href="#5-finally-语句" class="headerlink" title="5. finally 语句"></a>5. <code>finally</code> 语句</h2><p><code>finally</code> 块用于确保无论是否发生异常，都要执行的代码（例如资源释放）。</p>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FinallyExample</span> &#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;         </span><br><span class="line">        <span class="keyword">try</span> &#123;             </span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">10</span> / <span class="number">0</span>;         </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ArithmeticException e) &#123;             </span><br><span class="line">            System.out.println(<span class="string">&quot;发生异常: &quot;</span> + e.getMessage());         </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;             </span><br><span class="line">            System.out.println(<span class="string">&quot;程序执行结束！&quot;</span>);         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即使发生异常，<code>finally</code> 依然会执行 <code>&quot;程序执行结束！&quot;</code>。</p>
<hr>
<h2 id="6-自定义异常"><a href="#6-自定义异常" class="headerlink" title="6. 自定义异常"></a>6. 自定义异常</h2><p>如果 Java 现有异常类不能满足需求，可以自定义异常类（继承 <code>Exception</code> 或 <code>RuntimeException</code>）。</p>
<h3 id="受检异常（必须-throws-处理）"><a href="#受检异常（必须-throws-处理）" class="headerlink" title="受检异常（必须 throws 处理）"></a>受检异常（必须 <code>throws</code> 处理）</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCheckedException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyCheckedException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomExceptionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(<span class="type">int</span> num)</span> <span class="keyword">throws</span> MyCheckedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyCheckedException</span>(<span class="string">&quot;数字不能为负数！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            validate(-<span class="number">5</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MyCheckedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;捕获异常: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="运行时异常（可选-throws-处理）"><a href="#运行时异常（可选-throws-处理）" class="headerlink" title="运行时异常（可选 throws 处理）"></a>运行时异常（可选 <code>throws</code> 处理）</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyRuntimeException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyRuntimeException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomRuntimeExceptionExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyRuntimeException</span>(<span class="string">&quot;数字不能为负数！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        validate(-<span class="number">5</span>); <span class="comment">// 直接抛出异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行时异常不强制 <code>throws</code> 处理。</p>
<hr>
<h2 id="7-最新-Java-异常处理改进（Java-9-）"><a href="#7-最新-Java-异常处理改进（Java-9-）" class="headerlink" title="7. 最新 Java 异常处理改进（Java 9+）"></a>7. 最新 Java 异常处理改进（Java 9+）</h2><h3 id="1-try-with-resources-资源管理改进"><a href="#1-try-with-resources-资源管理改进" class="headerlink" title="1. try-with-resources 资源管理改进"></a>1. <strong>try-with-resources 资源管理改进</strong></h3><p>在 Java 9 之前，<code>try-with-resources</code> 只能在 <code>try(资源)</code> 中声明新资源；从 Java 9 开始，可以在 <code>try</code> 之外声明资源，然后在 <code>try</code> 语句中使用。</p>
<p><strong>Java 9+ 示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;test.txt&quot;</span>));</span><br><span class="line"><span class="keyword">try</span> (reader) &#123; <span class="comment">// 这里 reader 仍然会自动关闭</span></span><br><span class="line">    System.out.println(reader.readLine());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;读取文件时发生错误: &quot;</span> + e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-多异常捕获（Java-7-）"><a href="#2-多异常捕获（Java-7-）" class="headerlink" title="2. 多异常捕获（Java 7+）"></a>2. <strong>多异常捕获（Java 7+）</strong></h3><p>可以在一个 <code>catch</code> 块中捕获多个异常类型，提高代码简洁性。</p>
<p><strong>示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> Integer.parseInt(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NumberFormatException | NullPointerException e) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;发生异常: &quot;</span> + e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><div class="table-container">
<table>
<thead>
<tr>
<th>关键字</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>throw</code></td>
<td>手动抛出异常</td>
</tr>
<tr>
<td><code>throws</code></td>
<td>声明方法可能抛出的异常</td>
</tr>
<tr>
<td><code>try-catch</code></td>
<td>捕获并处理异常</td>
</tr>
<tr>
<td><code>finally</code></td>
<td>无论异常是否发生，都会执行</td>
</tr>
<tr>
<td><code>try-with-resources</code></td>
<td>自动关闭资源（Java 7+）</td>
</tr>
<tr>
<td>多异常捕获</td>
<td>一个 <code>catch</code> 处理多个异常（Java 7+）</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h2 id="异常类"><a href="#异常类" class="headerlink" title="异常类"></a>异常类</h2><p>Java里面每个类都定义了异常类<br>所有的类都是Throwable的子类</p>
<p>Throwable派生了两个类</p>
<ul>
<li>Error (IOError, LinkageError)</li>
<li>Exception (RuntimeError, 其他子类)</li>
</ul>
<hr>
<h2 id="使用原则"><a href="#使用原则" class="headerlink" title="使用原则"></a>使用原则</h2><ul>
<li>在当前方法声明使用try-catch语句捕获异常</li>
<li>一个方法被覆盖时候，覆盖他的方法必须抛出相同的异常或者异常的子类</li>
<li>如果父类抛出多个异常，则覆盖他的方法必须抛出那些异常的一个子集，不能抛出新的异常。</li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java数字处理类</title>
    <url>/2025/01/27/%E6%95%B0%E5%AD%97%E5%A4%84%E7%90%86%E7%B1%BB/</url>
    <content><![CDATA[<blockquote>
<p>此处主要记录使用DecimalFormat格式化浮点数的方法</p>
</blockquote>
<p>在Java中，默认格式化形式是:</p>
<ul>
<li>如果数字大于0.001同时小于10000000，则使用常规小数表示</li>
<li>如果不在这个范围内是用科学计数法</li>
</ul>
<p>使用DecimalFormat可以格式化浮点数</p>
<h2 id="1-常见用法"><a href="#1-常见用法" class="headerlink" title="1. 常见用法"></a><strong>1. 常见用法</strong></h2><h3 id="1-1-控制小数位数"><a href="#1-1-控制小数位数" class="headerlink" title="1.1 控制小数位数"></a><strong>1.1 控制小数位数</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            <span class="type">DecimalFormat</span> <span class="variable">df1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;#.00&quot;</span>); <span class="comment">// 保留2位小数（不足补0）</span></span><br><span class="line">            <span class="type">DecimalFormat</span> <span class="variable">df2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;#.##&quot;</span>); <span class="comment">// 保留最多2位小数（不足不补0）</span></span><br><span class="line">            System.out.println(df1.format(<span class="number">3.1</span>));  <span class="comment">// 输出: 3.10   </span></span><br><span class="line">            System.out.println(df2.format(<span class="number">3.1</span>));  <span class="comment">// 输出: 3.1</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;`</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="1-2-千位分隔符"><a href="#1-2-千位分隔符" class="headerlink" title="1.2 千位分隔符"></a><strong>1.2 千位分隔符</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DecimalFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;#,###.00&quot;</span>); </span><br><span class="line">System.out.println(df.format(<span class="number">1234567.89</span>));  <span class="comment">// 输出: 1,234,567.89 </span></span><br><span class="line">System.out.println(df.format(<span class="number">5.2</span>));         <span class="comment">// 输出: 5.20`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>#,###.00</code>：<strong><code>#</code> 表示可选位，<code>,</code> 表示千位分隔符</strong></li>
<li><strong>若不足两位小数，自动补 0</strong></li>
</ul>
<hr>
<h3 id="1-3-前导零"><a href="#1-3-前导零" class="headerlink" title="1.3 前导零"></a><strong>1.3 前导零</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DecimalFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;00000.00&quot;</span>); </span><br><span class="line">System.out.println(df.format(<span class="number">7.2</span>));  <span class="comment">// 输出: 00007.20`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>00000.00</code>：<strong>整数部分至少 5 位，不足补 0，小数部分固定 2 位</strong></li>
</ul>
<hr>
<h3 id="1-4-百分比"><a href="#1-4-百分比" class="headerlink" title="1.4 百分比"></a><strong>1.4 百分比</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DecimalFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;#.##%&quot;</span>);</span><br><span class="line">System.out.println(df.format(<span class="number">0.2567</span>));  <span class="comment">// 输出: 25.67%`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>#%</code>：<strong>自动 ×100，并加 <code>%</code></strong></li>
</ul>
<hr>
<h3 id="1-5-自定义前后缀"><a href="#1-5-自定义前后缀" class="headerlink" title="1.5 自定义前后缀"></a><strong>1.5 自定义前后缀</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DecimalFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;￥#,###.00元&quot;</span>);</span><br><span class="line">System.out.println(df.format(<span class="number">12345.6</span>));  <span class="comment">// 输出: ￥12,345.60元`</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>前后缀</strong>（如 <code>￥</code>、<code>元</code>）会直接加在格式化结果中</li>
</ul>
<hr>
<h3 id="1-6-解析字符串为数字"><a href="#1-6-解析字符串为数字" class="headerlink" title="1.6 解析字符串为数字"></a><strong>1.6 解析字符串为数字</strong></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.DecimalFormat; </span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ParseException &#123; </span><br><span class="line">        <span class="type">DecimalFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>(<span class="string">&quot;#,###.00&quot;</span>);</span><br><span class="line">    <span class="type">Number</span> <span class="variable">num</span> <span class="operator">=</span> df.parse(<span class="string">&quot;1,234,567.89&quot;</span>);         </span><br><span class="line">        System.out.println(num.doubleValue()); <span class="comment">// 输出: 1234567.89     </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;`</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>parse()</code> 方法能将格式化字符串转换回 <code>Number</code></strong></li>
</ul>
<hr>
<h2 id="2-DecimalFormat-vs-String-format-vs-BigDecimal"><a href="#2-DecimalFormat-vs-String-format-vs-BigDecimal" class="headerlink" title="2. DecimalFormat vs String.format() vs BigDecimal"></a><strong>2. <code>DecimalFormat</code> vs <code>String.format()</code> vs <code>BigDecimal</code></strong></h2><div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>适用场景</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DecimalFormat</code></td>
<td><strong>复杂格式</strong>（前导零、千分位、前后缀）</td>
<td><code>new DecimalFormat(&quot;#,###.00&quot;).format(1234567.89)</code></td>
</tr>
<tr>
<td><code>String.format()</code></td>
<td><strong>简单格式</strong>（小数点、千分位）</td>
<td><code>String.format(&quot;%,.2f&quot;, 1234567.89)</code></td>
</tr>
<tr>
<td><code>BigDecimal</code></td>
<td><strong>高精度计算</strong>（金融/科学计算）</td>
<td><code>new BigDecimal(&quot;1234.56789&quot;).setScale(2, RoundingMode.HALF_UP)</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="通过特殊方法"><a href="#通过特殊方法" class="headerlink" title="通过特殊方法"></a>通过特殊方法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DecimalFormat</span> <span class="variable">ft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecimalFormat</span>();  </span><br><span class="line">ft.setGroupingSize(<span class="number">2</span>); <span class="comment">//将数字分组为二  </span></span><br><span class="line"><span class="type">String</span> <span class="variable">out</span> <span class="operator">=</span> ft.format(<span class="number">12335.889</span>);  </span><br><span class="line">System.out.println(out);  </span><br><span class="line">ft.setGroupingUsed(<span class="literal">false</span>);  <span class="comment">//设置不可以分组</span></span><br><span class="line">out = ft.format(<span class="number">12335.889</span>);  </span><br><span class="line">System.out.println(out);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="数学运算Math类"><a href="#数学运算Math类" class="headerlink" title="数学运算Math类"></a>数学运算Math类</h2><p>Math类可以实现很多数学运算</p>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><ul>
<li>Math.PI \（pai\）</li>
<li>Math.E</li>
</ul>
<h2 id="常用数学方法"><a href="#常用数学方法" class="headerlink" title="常用数学方法:"></a>常用数学方法:</h2><ul>
<li>double sin(double a)</li>
<li>var cos</li>
<li>tan</li>
<li>asin</li>
<li>acos</li>
<li>atan</li>
<li>toRadians() //将角度转换为弧度</li>
<li>toDegrees() // 将弧度转化为角度</li>
<li>exp() //e的几次方</li>
<li>pow(double a, double b): 取a的b次方</li>
<li>sqrt</li>
<li>cbrt //立方根</li>
<li>log(double a) // lna</li>
<li>log10(double a)</li>
</ul>
<p>都是传入double返回double，所以精度不准确</p>
<h3 id="取整函数用法"><a href="#取整函数用法" class="headerlink" title="取整函数用法:"></a>取整函数用法:</h3><ul>
<li>ceil(double a) : 向上取整</li>
<li>floor</li>
<li>rint(double): 返回和参数最近的整数，如果距离一样则取得偶数</li>
</ul>
<h3 id="最大值最小值绝对值"><a href="#最大值最小值绝对值" class="headerlink" title="最大值最小值绝对值"></a>最大值最小值绝对值</h3><blockquote>
<p>和cpp一样也重载了</p>
</blockquote>
<ul>
<li>max</li>
<li>min</li>
<li>abs</li>
</ul>
<h3 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Math.Random()</span><br></pre></td></tr></table></figure>
<ul>
<li>默认生产的是 0  - 1 之间的任何double数字，但是稍加处理就可以变成产生任意范围的数字:<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">m + (<span class="type">int</span>)(Math.Random() * n) <span class="comment">// 返回[m, m + n)之间的数字</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>除了Math的Random类，Java有一个Random专门来返回随机数字:</p>
</blockquote>
<p>Random类有以下常见用法：</p>
<ul>
<li>nextInt() 返回随机整数</li>
<li>nextInt(int n) 返回[0, n)的数字</li>
<li>nextLong</li>
<li>nextdouble</li>
</ul>
<h2 id="大数字运算BigInteger"><a href="#大数字运算BigInteger" class="headerlink" title="大数字运算BigInteger"></a>大数字运算BigInteger</h2><p>构造函数：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">BigInteger</span><span class="params">(String val)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用构造函数:</span></span><br><span class="line"><span class="type">BigInteger</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;123&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>注意\” \” 不可以省略</p>
<blockquote>
<p>封装的方法：</p>
</blockquote>
</li>
<li><p>public BigInteger add(BigInteger val) // +，下列省略所有参数</p>
</li>
<li>subtract(BI val) // -</li>
<li>multiply(Bi val) // *</li>
<li>divide(Bi val) // 除法</li>
<li>remainder(Bi val) // 取余</li>
<li>pow(int exponent) // 对它取exponent次方</li>
<li>negate() : 取相反数</li>
<li>shiftLeft(int n): 将数字左移n位，如果n是负数做右移操作</li>
<li>shiftRight(int n)</li>
<li>and()</li>
<li>or()</li>
<li>compareTo() // 大于返回1， 小于返回-1</li>
<li>equals() 比较</li>
<li>min() 最小值</li>
<li>max()取最大值<br>j 7</li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>基环树</title>
    <url>/2024/09/01/%E5%9F%BA%E7%8E%AF%E6%A0%91/</url>
    <content><![CDATA[<p>图中只存在一个环的图就是基环树，<br>分为有向图和无向图</p>
<p>无向图求基环树可以使用bfs ： 先统计入度，然后每次对队列中元素删边，把删后度数为1的点入队，bfs结束后，所有度数 &gt; 1的点就是环上的点，如果只需要求一个点，可以使用dfs，出现了两次的点说明必然有环。</p>
<blockquote>
<p>想法1 ： 可以通过先找出基环树的环， 之后分别对除了环以外的每个点的子树进行操作，把信息合并到环上，之后问题就集中为处理一个环上问题， </p>
<p>想法2 ： 可以先找出基环树的环， 之后删掉基环树上某一条边， 将基环树变成一个树，处理树上问题</p>
</blockquote>
<h3 id="寻找环的办法"><a href="#寻找环的办法" class="headerlink" title="寻找环的办法"></a>寻找环的办法</h3><h4 id="1-：-对于无向图，-使用拓补排序，最后剩下的度数-gt-1-的点就是环上的点"><a href="#1-：-对于无向图，-使用拓补排序，最后剩下的度数-gt-1-的点就是环上的点" class="headerlink" title="1 ： 对于无向图， 使用拓补排序，最后剩下的度数 &gt; 1 的点就是环上的点"></a>1 ： 对于无向图， 使用拓补排序，最后剩下的度数 &gt; 1 的点就是环上的点</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-对于有向图，-使用dfs-寻找，出现了vis两次的点就是环上一个点"><a href="#2-对于有向图，-使用dfs-寻找，出现了vis两次的点就是环上一个点" class="headerlink" title="2 : 对于有向图， 使用dfs 寻找，出现了vis两次的点就是环上一个点"></a>2 : 对于有向图， 使用dfs 寻找，出现了vis两次的点就是环上一个点</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> check_c = [&amp;](<span class="keyword">auto</span> self, i64 u) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> now = fa[u];</span><br><span class="line">        <span class="keyword">if</span> (vis[now]) <span class="keyword">return</span> now;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">self</span>(self, now);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>记录深度并返回环内元素个数的板子 : </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vis</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">h</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="type">int</span> flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">auto</span> check_c = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u, <span class="type">int</span> cnt) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">    h[u] = cnt;</span><br><span class="line">    vis[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">            <span class="built_in">self</span>(self, v, cnt + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (vis[v] == <span class="number">1</span>) &#123;</span><br><span class="line">            ++flag, siz.<span class="built_in">push_back</span>(h[u] - h[v] + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vis[u] = <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用并查集寻找环上两个断点 : （适用于无向图断环）</p>
<blockquote>
<p>每次输入点的时候将点并入一个并查集，如果输入的点已经在一个集合里面，说明这两个点连接后会形成环，直接记录下两个断点的位置</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>点击跳转 : 例题1 : </p>
</blockquote>
</li>
<li><a href="https://www.luogu.com.cn/problem/P2607">骑士</a><br>前置知识 ： 树形dp， P1352没有上司的舞会， 对于颗树，从根开始跑一遍dp， 使用dp【x】【1 / 0 】， x表示当前的节点，1或者0表示当前节点取或者不取，使用回溯转移，从叶子到节点更新答案， 其中，对于每一个节点u， 用v表示他的子节点， 有： <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">dp[u][<span class="number">1</span>] = ∑dp[v][<span class="number">0</span>] </span><br><span class="line">dp[u][<span class="number">0</span>] = ∑<span class="built_in">max</span>(dp[v][<span class="number">1</span>], dp[v][<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
将所有节点更新完得到答案， 对于这道骑士， 就是在原题的基础上增加了一条边，使得原来的树里面出现了环， 变成一个基环森林， solution : </li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">e</span>(n + <span class="number">1</span>);</span><br><span class="line">    vector&lt;vector&lt;i64&gt;&gt; <span class="built_in">dp</span>(n + <span class="number">1</span>, <span class="built_in">vector</span>&lt;i64&gt; (<span class="number">3</span>));</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">fa</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;i64&gt; <span class="title">val</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> mark;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">vis</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u;</span><br><span class="line">        cin &gt;&gt; val[i] &gt;&gt; u;</span><br><span class="line">        e[u].<span class="built_in">push_back</span>(i); </span><br><span class="line">        fa[i] = u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> dfs = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        dp[u][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        dp[u][<span class="number">1</span>] = val[u];</span><br><span class="line">        vis[u] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v == mark) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">self</span>(self, v);</span><br><span class="line">            dp[u][<span class="number">1</span>] += dp[v][<span class="number">0</span>];</span><br><span class="line">            dp[u][<span class="number">0</span>] += <span class="built_in">max</span>(dp[v][<span class="number">1</span>], dp[v][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> find = [&amp;](<span class="keyword">auto</span> self, i64 u) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">        vis[u] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> now = fa[u];</span><br><span class="line">        <span class="keyword">if</span> (vis[now]) <span class="keyword">return</span> now;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">self</span>(self, now);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    i64 ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="keyword">if</span> (!vis[i]) &#123;</span><br><span class="line">        i64 res = <span class="number">0</span>;</span><br><span class="line">        mark = <span class="built_in">find</span>(find, i);</span><br><span class="line">        <span class="built_in">dfs</span>(dfs, mark);</span><br><span class="line">        res = <span class="built_in">max</span>(res, dp[mark][<span class="number">0</span>]);</span><br><span class="line">        mark = fa[mark];</span><br><span class="line">        <span class="built_in">dfs</span>(dfs, mark);</span><br><span class="line">        res = <span class="built_in">max</span>(res, dp[mark][<span class="number">0</span>]);</span><br><span class="line">        ans += res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例题2 ： </p>
<ul>
<li><a href="https://www.luogu.com.cn/problem/P8943">追逐游戏</a><br>本题如果使用上面的思路，很难实现，不如采用先找出环，之后对于环上每一个点处理，使其满足条件 : <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n, q;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; q;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">e</span>(n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        e[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        e[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">f</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">dfn</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> dfncnt = <span class="number">0</span>, siz = <span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; cycle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> dfs1 = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u, <span class="type">int</span> Fa) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        dfn[u] = ++dfncnt;</span><br><span class="line">        f[u] = Fa;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v == Fa) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">                <span class="built_in">self</span>(self, v, u);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (dfn[v] &gt; dfn[u]) &#123;</span><br><span class="line">                <span class="keyword">while</span> (v != u) &#123;</span><br><span class="line">                    cycle.<span class="built_in">push_back</span>(v);</span><br><span class="line">                    siz++;</span><br><span class="line">                    v = f[v];</span><br><span class="line">                &#125;</span><br><span class="line">                cycle.<span class="built_in">push_back</span>(v);</span><br><span class="line">                siz++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dep</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">root</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> dfs2 = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u, <span class="type">int</span> fa, <span class="type">int</span> Root) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        dep[u] = dep[fa] + <span class="number">1</span>;</span><br><span class="line">        root[u] = Root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : e[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v == fa || dfn[v]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">self</span>(self, v, u, Root);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dfs1</span>(dfs1, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) dfn[i] = <span class="number">0</span>; <span class="comment">// 转vis</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : cycle) &#123;</span><br><span class="line">        <span class="comment">//cerr &lt;&lt; x &lt;&lt; &#x27; &#x27;;</span></span><br><span class="line">        dfn[x] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; siz; i++) &#123;</span><br><span class="line">        <span class="built_in">dfs2</span>(dfs2, cycle[i], <span class="number">0</span>, cycle[i]);</span><br><span class="line">        dep[cycle[i]] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q--) &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (siz == <span class="number">0</span>) cout &lt;&lt; <span class="string">&quot;Deception\n&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (dfn[a]) cout &lt;&lt; <span class="string">&quot;Survive\n&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> ned1 = dep[a] - <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> ned2 = <span class="built_in">min</span>(<span class="built_in">abs</span>(dep[root[b]] - dep[root[a]]);</span><br><span class="line">            <span class="type">int</span> siz - <span class="built_in">abs</span>(dep[root[b]] - dep[root[a]]));</span><br><span class="line">            <span class="keyword">if</span> (!dfn[b]) ned2 += dep[b] - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (ned1 &lt; ned2) &#123;</span><br><span class="line">                <span class="comment">//cerr &lt;&lt; ned1 &lt;&lt; ned2 &lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;Survive\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;Deception\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>算法</category>
        <category>图论</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>最大流</title>
    <url>/2025/03/09/%E6%9C%80%E5%A4%A7%E6%B5%81/</url>
    <content><![CDATA[<blockquote>
<p>求解从源点s到汇点t的最大流量问题</p>
<h3 id="Fold-fulkerson"><a href="#Fold-fulkerson" class="headerlink" title="Fold - fulkerson"></a>Fold - fulkerson</h3><p>  依赖一个残留网络，每次更新一条从源点到汇点的路径的流量，在更新的时候同时在残留网络建立对应边的反边，直到残留网络没有从s - t的边，</p>
<p>最大流最小割定理<br>    一个流是最大流，当且仅当他的残留网络不包含增广路径</p>
</blockquote>
<h3 id="Edmonds-Karps"><a href="#Edmonds-Karps" class="headerlink" title="Edmonds-Karps"></a>Edmonds-Karps</h3><p>  对于Fold - fulkerson算法，虽然可以正确的找到他的最大流，但是他的时间复杂度依赖于边的权， 比如《算法竞赛》 P666， </p>
<p>  对于Fold - fulkerson改进，使用bfs， 每次找到最短的增广路径，对该路径进行计算，可以大大优化时间复杂度, 一次bfs的时间复杂度是 o ( m ) , 对于bfs， 增广要处理n个点， m条边， 故时间复杂度为 o ( nm ), 综合起来时间复杂度是o ($n ^ 2 * m$)</p>
<p>代码 :<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></p>
<ul>
<li>先放一个jiangly代码 ： <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> inf = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MaxFlow</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">_Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> to;</span><br><span class="line">        T cap;</span><br><span class="line">        _Edge(<span class="type">int</span> to, T cap) : <span class="built_in">to</span>(to), <span class="built_in">cap</span>(cap) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    std::vector&lt;_Edge&gt; e;</span><br><span class="line">    std::vector&lt;std::vector&lt;<span class="type">int</span>&gt;&gt; g;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; cur, h;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MaxFlow</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">MaxFlow</span>(<span class="type">int</span> n) &#123;</span><br><span class="line">        <span class="built_in">init</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;n = n;</span><br><span class="line">        e.<span class="built_in">clear</span>();</span><br><span class="line">        g.<span class="built_in">assign</span>(n, &#123;&#125;);</span><br><span class="line">        cur.<span class="built_in">resize</span>(n);</span><br><span class="line">        h.<span class="built_in">resize</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        h.<span class="built_in">assign</span>(n, <span class="number">-1</span>);</span><br><span class="line">        std::queue&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">        h[s] = <span class="number">0</span>;</span><br><span class="line">        que.<span class="built_in">push</span>(s);</span><br><span class="line">        <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">const</span> <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">            que.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i : g[u]) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [v, c] = e[i];</span><br><span class="line">                <span class="keyword">if</span> (c &gt; <span class="number">0</span> &amp;&amp; h[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    h[v] = h[u] + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (v == t) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    que.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, T f)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t) &#123;</span><br><span class="line">            <span class="keyword">return</span> f;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> r = f;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>&amp; i = cur[u]; i &lt; <span class="built_in">int</span>(g[u].<span class="built_in">size</span>()); ++i) &#123;</span><br><span class="line">            <span class="type">const</span> <span class="type">int</span> j = g[u][i];</span><br><span class="line">            <span class="keyword">auto</span> [v, c] = e[j];</span><br><span class="line">            <span class="keyword">if</span> (c &gt; <span class="number">0</span> &amp;&amp; h[v] == h[u] + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">auto</span> a = <span class="built_in">dfs</span>(v, t, std::<span class="built_in">min</span>(r, c));</span><br><span class="line">                e[j].cap -= a;</span><br><span class="line">                e[j ^ <span class="number">1</span>].cap += a;</span><br><span class="line">                r -= a;</span><br><span class="line">                <span class="keyword">if</span> (r == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> f;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> f - r;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, T c)</span> </span>&#123;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(e.<span class="built_in">size</span>());</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(v, c);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(e.<span class="built_in">size</span>());</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(u, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">T <span class="title">flow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        T ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            cur.<span class="built_in">assign</span>(n, <span class="number">0</span>);</span><br><span class="line">            ans += <span class="built_in">dfs</span>(s, t, std::numeric_limits&lt;T&gt;::<span class="built_in">max</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">bool</span>&gt; <span class="title">minCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function">std::vector&lt;<span class="type">bool</span>&gt; <span class="title">c</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            c[i] = (h[i] != <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> from;</span><br><span class="line">        <span class="type">int</span> to;</span><br><span class="line">        T cap;</span><br><span class="line">        T flow;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function">std::vector&lt;Edge&gt; <span class="title">edges</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::vector&lt;Edge&gt; a;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; e.<span class="built_in">size</span>(); i += <span class="number">2</span>) &#123;</span><br><span class="line">            Edge x;</span><br><span class="line">            x.from = e[i + <span class="number">1</span>].to;</span><br><span class="line">            x.to = e[i].to;</span><br><span class="line">            x.cap = e[i].cap + e[i + <span class="number">1</span>].cap;</span><br><span class="line">            x.flow = e[i + <span class="number">1</span>].cap;</span><br><span class="line">            a.<span class="built_in">push_back</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>待会自己写一个，用临界矩阵先写一个EK的</p>
<h4 id="Dinic"><a href="#Dinic" class="headerlink" title="Dinic"></a>Dinic</h4><p>对于FF的优化，由于FF每次都需要随机找到一条增广路径，而Dinic将图分层次之后，每次找增广路径只能找到这条路和下一条路的路径，这样极大优化了时间</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> inf = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MaxFlow</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        T cap;</span><br><span class="line">        <span class="built_in">Edge</span>(<span class="type">int</span> v, T cap) : <span class="built_in">v</span>(v), <span class="built_in">cap</span>(cap) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    vector&lt;Edge&gt; e;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; g;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; dep, cur;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MaxFlow</span>(<span class="type">int</span> n) :<span class="built_in">n</span>(n), <span class="built_in">g</span>(n) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        dep.<span class="built_in">assign</span>(n, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(s);</span><br><span class="line">        dep[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i : g[u]) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [v, c] = e[i];</span><br><span class="line">                <span class="keyword">if</span> (c &gt; <span class="number">0</span> &amp;&amp; dep[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                    <span class="keyword">if</span> (v == t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, T flow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">        T sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = cur[u]; i &lt; g[u].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            cur[u] = i;</span><br><span class="line">            <span class="type">int</span> j = g[u][i];</span><br><span class="line">            <span class="keyword">auto</span>&amp; [v, c] = e[j];</span><br><span class="line">            <span class="keyword">if</span> (dep[v] == dep[u] + <span class="number">1</span> &amp;&amp; c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                T f = <span class="built_in">dfs</span>(v, t, <span class="built_in">min</span>(c, flow));</span><br><span class="line">                e[j].cap -= f;</span><br><span class="line">                e[j ^ <span class="number">1</span>].cap += f;</span><br><span class="line">                sum += f;</span><br><span class="line">                flow -= f;</span><br><span class="line">                <span class="keyword">if</span> (flow == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sum == <span class="number">0</span>) dep[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dinic</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        T F = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            cur.<span class="built_in">assign</span>(n, <span class="number">0</span>);</span><br><span class="line">            F += <span class="built_in">dfs</span>(s, t, inf);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> F;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, T c)</span> </span>&#123;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(<span class="built_in">int</span>(e.<span class="built_in">size</span>()));</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(v, c);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(<span class="built_in">int</span>(e.<span class="built_in">size</span>()));</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(u, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>加入了当前弧优化， 使得效率更高</p>
]]></content>
      <categories>
        <category>算法</category>
        <category>图论</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>欧拉回路</title>
    <url>/2024/07/22/%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF/</url>
    <content><![CDATA[<p>欧拉回路是这样一个东西（个人理解） ： 从图上某个点出发，每条边不能重复经过，然后从这个点开始把所有的点和边走一遍（同时满足每条边不能重复）后回到这个点。</p>
<p>怎么求？ 一种办法是Fluery , 即每次只找不是桥的边bfs， 当每个点和边都进队后再处理桥， 如果图不连通或者经过桥之后无法遍历整个图，则没有欧拉回路，否则就找到了欧拉回路， 由于这样实现需要先tarjan缩强连通分量后记录桥的位置，之后再每个点遍历，需要时间复杂度大约是O(n ^ 2), 太不牛，我们换下一个算法</p>
<blockquote>
<p><strong>Hierholzer</strong>算法</p>
</blockquote>
<p>（不是这什么鬼名字也太长……）<br>我直接把函数名字写成dfs了，板子如下（自己实现的用起来自己舒服）<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">now</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line"><span class="keyword">auto</span> dfs = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = now[u]; i &lt; e[u].<span class="built_in">size</span>(); i = now[u]) &#123;</span><br><span class="line">        now[u]++;</span><br><span class="line">        <span class="built_in">self</span>(self, e[u][i]);</span><br><span class="line">    &#125;</span><br><span class="line">    s.<span class="built_in">push</span>(u);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>首先说一下有向图欧拉通路的判定 ： （需要满足以下2 之一）</p>
<ul>
<li>所有顶点出度等于入度</li>
<li>有且只有一个顶点出度等于入度加一，同时有另外一个顶点入度等于出度加一（可以想象成每个顶点2个2个删边之后会剩下一条，而这条路如果一开始就走也可以形成欧拉回路）</li>
</ul>
<p>接下来解释一下上面实现 ：<br>    now数组记录经过当前顶点次数（每次走过后让路径穿过这个点， 之后继续dfs下一个点），回来的时候记录，由于是逆序的，所以开了个stack</p>
<p>next is the code of P7771 [洛谷P7771] : <a href="https://www.luogu.com.cn/problem/P7771">https://www.luogu.com.cn/problem/P7771</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">e</span>(n + <span class="number">1</span>);</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">in</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">out</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line"></span><br><span class="line">        e[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">        in[v]++;</span><br><span class="line">        out[u]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> vis1 = <span class="number">0</span>, vis2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (in[i] == out[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (in[i] == out[i] + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis1) vis1 = i;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (in[i] == out[i] - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!vis2) vis2 = i;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;No\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">now</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    <span class="keyword">auto</span> dfs = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = now[u]; i &lt; e[u].<span class="built_in">size</span>(); i = now[u]) &#123;</span><br><span class="line">            now[u]++;</span><br><span class="line">            <span class="built_in">self</span>(self, e[u][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        s.<span class="built_in">push</span>(u);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">sort</span>(e[i].<span class="built_in">begin</span>(), e[i].<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vis2) <span class="built_in">dfs</span>(dfs, vis2);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(dfs, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!s.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; s.<span class="built_in">top</span>() &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>应用例子:<br>洛谷P1341 字符串匹配，以前cf有一道传送门的题，好像是某场div3 E题也是一模一样：<br>思路，想要拿到一个首尾相链接的串， 则直接跑一边欧拉回路（就好像每个字符串就是一个节点，每个相同的字符就是一个传送门，那么对于相同的字符就建边链接，同时统计每个点的度数，由于欧拉通路判定需要满足以下两个条件之一 : </p>
<ul>
<li>所有点都是偶数度</li>
<li>有奇数度顶点且奇数度顶点有且只有2个<br>在接下来判定时就可以直接使用记录的度数。<br>之后就跑一遍欧拉回路，记录路径， 输出路径， 一遍AC!!!<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> inf = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> start = inf;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">e</span>(<span class="number">59</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">59</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">du</span><span class="params">(<span class="number">59</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        string s;</span><br><span class="line">        cin &gt;&gt; s;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> u = s[<span class="number">0</span>] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        <span class="type">int</span> v = s[<span class="number">1</span>] - <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        start = <span class="built_in">min</span>(&#123;start, u, v&#125;);</span><br><span class="line">        e[u][v] = e[v][u] = <span class="number">1</span>;</span><br><span class="line">        du[u]++;</span><br><span class="line">        du[v]++; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> pos = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">58</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (du[i] &amp; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pos == <span class="number">-1</span>) pos = i;</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">now</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> dfs = [&amp;](<span class="keyword">auto</span> self, <span class="type">int</span> u) -&gt; <span class="type">void</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">58</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e[u][i]) &#123;</span><br><span class="line">                e[u][i] = e[i][u] = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">self</span>(self, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        s.<span class="built_in">push</span>(u);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//cerr &lt;&lt; (char)(start + &#x27;A&#x27;)&lt;&lt; &#x27;\n&#x27;;</span></span><br><span class="line">    <span class="keyword">if</span> (cnt == <span class="number">0</span>) <span class="built_in">dfs</span>(dfs, start);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (cnt == <span class="number">2</span>) <span class="built_in">dfs</span>(dfs, pos);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;No Solution\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!s.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">char</span> c = (<span class="type">char</span>)(s.<span class="built_in">top</span>() + <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">        cout &lt;&lt; c;</span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>算法</category>
        <category>图论</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>最小割</title>
    <url>/2025/03/09/%E6%9C%80%E5%B0%8F%E5%89%B2/</url>
    <content><![CDATA[<p>最小割就是最大流，（求完了之后的残留网络就是最小割）</p>
<h3 id="最小割的求解方法"><a href="#最小割的求解方法" class="headerlink" title="最小割的求解方法"></a>最小割的求解方法</h3><p>在 Dinic 算法中，求完最大流后，残留网络中不再存在从源点到汇点的增广路径。此时，我们可以通过一次 BFS，从源点出发遍历残留网络，标记所有仍可到达的顶点。代码中的 <code>minCut()</code> 函数正是利用最后一次 BFS 计算的结果：</p>
<p>cpp</p>
<p>复制编辑</p>
<p><code>std::vector&lt;bool&gt; minCut() &#123;     std::vector&lt;bool&gt; c(n);     for (int i = 0; i &lt; n; i++) &#123;         c[i] = (h[i] != -1);     &#125;     return c; &#125;</code></p>
<p>这里返回的布尔数组 <code>c</code> 表示每个顶点是否在源点 s 的可达集合 S 中。根据最大流最小割定理，从 S 到 T（不可达部分）的边就是最小割边。虽然函数本身只返回了 S 集合的信息，但你可以通过扫描所有边，找出那些一端在 S（<code>c[u] == true</code>）而另一端在 T（<code>c[v] == false</code>）的边，从而得到具体的割边。</p>
<h3 id="dep-数组的作用"><a href="#dep-数组的作用" class="headerlink" title="dep 数组的作用"></a>dep 数组的作用</h3><ul>
<li><p><strong>层次标号</strong>：在 Dinic 算法中，<code>h</code> 数组用于存储每个顶点在残留网络中距离源点 s 的层次（或者称“高度”）。在 BFS 过程中，所有顶点初始值都设为 -1，只有从源点可以到达的顶点会被赋予非负值，其中源点 <code>h[s]</code> 被设为 0，之后每经过一条残留边，层次增加 1。</p>
</li>
<li><p><strong>构造层次图</strong>：在 BFS 遍历中，只有那些具有正残量的边会被考虑，因此 <code>h</code> 数组实际构造了一个“层次图”，使得 DFS 只沿着满足 <code>h[v] == h[u] + 1</code> 的边进行，从而提高搜索效率。</p>
</li>
<li><p><strong>确定最小割的 S 集合</strong>：当最大流求解完成后，最后一次 BFS 过程中仍然能到达的顶点，其 <code>h</code> 值不为 -1。这些顶点构成了 S 集合（即从源点 s 在残留网络中可以达到的所有顶点），而无法到达的顶点构成 T 集合。正是这种划分决定了最小割的边：所有从 S 到 T 的边，其总容量即为最小割的容量。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MaxFlow</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        T cap;</span><br><span class="line">        <span class="built_in">Edge</span>(<span class="type">int</span> v, T cap) : <span class="built_in">v</span>(v), <span class="built_in">cap</span>(cap) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    vector&lt;Edge&gt; e;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; g;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; dep, cur;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MaxFlow</span>(<span class="type">int</span> n) :<span class="built_in">n</span>(n), <span class="built_in">g</span>(n) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        dep.<span class="built_in">assign</span>(n, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(s);</span><br><span class="line">        dep[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i : g[u]) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [v, c] = e[i];</span><br><span class="line">                <span class="keyword">if</span> (c &gt; <span class="number">0</span> &amp;&amp; dep[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                    <span class="keyword">if</span> (v == t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, T flow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">        T sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = cur[u]; i &lt; g[u].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            cur[u] = i;</span><br><span class="line">            <span class="type">int</span> j = g[u][i];</span><br><span class="line">            <span class="keyword">auto</span>&amp; [v, c] = e[j];</span><br><span class="line">            <span class="keyword">if</span> (dep[v] == dep[u] + <span class="number">1</span> &amp;&amp; c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                T f = <span class="built_in">dfs</span>(v, t, <span class="built_in">min</span>(c, flow));</span><br><span class="line">                e[j].cap -= f;</span><br><span class="line">                e[j ^ <span class="number">1</span>].cap += f;</span><br><span class="line">                sum += f;</span><br><span class="line">                flow -= f;</span><br><span class="line">                <span class="keyword">if</span> (flow == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sum == <span class="number">0</span>) dep[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dinic</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        T F = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            cur.<span class="built_in">assign</span>(n, <span class="number">0</span>);</span><br><span class="line">            F += <span class="built_in">dfs</span>(s, t, std::numeric_limits&lt;T&gt;::<span class="built_in">max</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> F;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">minCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">c</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            c[i] = (dep[i] == <span class="number">-1</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, T c)</span> </span>&#123;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(<span class="built_in">int</span>(e.<span class="built_in">size</span>()));</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(v, c);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(<span class="built_in">int</span>(e.<span class="built_in">size</span>()));</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(u, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>举一个应用（求最小割边集合）</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MaxFlow</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        T cap;</span><br><span class="line">        <span class="built_in">Edge</span>(<span class="type">int</span> v, T cap) : <span class="built_in">v</span>(v), <span class="built_in">cap</span>(cap) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    vector&lt;Edge&gt; e;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; g;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; dep, cur;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MaxFlow</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">g</span>(n) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        dep.<span class="built_in">assign</span>(n, <span class="number">-1</span>);</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(s);</span><br><span class="line">        dep[s] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">            q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> i : g[u]) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [v, c] = e[i];</span><br><span class="line">                <span class="keyword">if</span> (c &gt; <span class="number">0</span> &amp;&amp; dep[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">                    dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                    <span class="keyword">if</span> (v == t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dfs</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t, T flow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (u == t) <span class="keyword">return</span> flow;</span><br><span class="line">        T sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = cur[u]; i &lt; g[u].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            cur[u] = i;</span><br><span class="line">            <span class="type">int</span> j = g[u][i];</span><br><span class="line">            <span class="keyword">auto</span>&amp; [v, c] = e[j];</span><br><span class="line">            <span class="keyword">if</span> (dep[v] == dep[u] + <span class="number">1</span> &amp;&amp; c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                T f = <span class="built_in">dfs</span>(v, t, <span class="built_in">min</span>(c, flow));</span><br><span class="line">                e[j].cap -= f;</span><br><span class="line">                e[j ^ <span class="number">1</span>].cap += f;</span><br><span class="line">                sum += f;</span><br><span class="line">                flow -= f;</span><br><span class="line">                <span class="keyword">if</span> (flow == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sum == <span class="number">0</span>) dep[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dinic</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        T F = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">            cur.<span class="built_in">assign</span>(n, <span class="number">0</span>);</span><br><span class="line">            F += <span class="built_in">dfs</span>(s, t, std::numeric_limits&lt;T&gt;::<span class="built_in">max</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> F;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">minCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">c</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            c[i] = (dep[i] == <span class="number">-1</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, T c)</span> </span>&#123;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(<span class="built_in">int</span>(e.<span class="built_in">size</span>()));</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(v, c);</span><br><span class="line">        g[v].<span class="built_in">push_back</span>(<span class="built_in">int</span>(e.<span class="built_in">size</span>()));</span><br><span class="line">        e.<span class="built_in">emplace_back</span>(u, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n, m, s, t;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line"></span><br><span class="line">    <span class="function">MaxFlow&lt;i64&gt; <span class="title">mf</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> u, v;</span><br><span class="line">        i64 w;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">        mf.<span class="built_in">add</span>(u, v, w);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i64 k = mf.<span class="built_in">dinic</span>(s, t);</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; p = mf.<span class="built_in">minCut</span>();</span><br><span class="line">    cerr &lt;&lt; k &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    i64 cut = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p[i]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> j : mf.g[p[i]]) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [v, w] = mf.e[j];</span><br><span class="line">                <span class="keyword">if</span> (!p[v]) &#123;</span><br><span class="line">                    cut += w;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; k &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; cut &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
        <category>图论</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>泛型</title>
    <url>/2025/02/02/%E6%B3%9B%E5%9E%8B/</url>
    <content><![CDATA[<p>和cpp模板元编程一样，Java也提供了泛型，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">类名&lt;T&gt;</span><br></pre></td></tr></table></figure>
<h2 id="高级用法："><a href="#高级用法：" class="headerlink" title="高级用法："></a>高级用法：</h2><h3 id="1-限制泛型可使用类型"><a href="#1-限制泛型可使用类型" class="headerlink" title="1. 限制泛型可使用类型"></a>1. 限制泛型可使用类型</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">class 类名&lt;T <span class="keyword">extends</span> <span class="title class_">anyclass</span>&gt;</span><br></pre></td></tr></table></figure>
<p>其中，anyclass是指某个接口或者类<br>使用泛型限制后，泛型类型必须继承或者实现了anyclass这个接口或者类</p>
<h2 id="2-类型通配符"><a href="#2-类型通配符" class="headerlink" title="2. 类型通配符"></a>2. 类型通配符</h2><p>在泛型机制中，提供了类型通配符，其主要作用是在创建一个泛型类对象的时候</p>
<ul>
<li><p><strong>泛型中的通配符</strong>：<br>  <code>Constructor&lt;T&gt;</code> 是一个泛型类，代表某个类 <code>T</code> 的构造方法。<br>  使用 <code>Constructor&lt;?&gt;</code> 表示你关心的是“某个类的构造方法”，但具体的类型参数你并不关心或不需要指定。</p>
</li>
<li><p><strong>目的</strong>：  </p>
</li>
</ul>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>线段树</title>
    <url>/2024/12/26/%E7%BA%BF%E6%AE%B5%E6%A0%91/</url>
    <content><![CDATA[<ul>
<li>对于一个数组，如果想要动态的管理它，就使用线段树把</li>
</ul>
<h2 id="区间加-amp-Sum"><a href="#区间加-amp-Sum" class="headerlink" title="区间加 &amp; Sum"></a>区间加 &amp; Sum</h2><blockquote>
<p>区间修改， 区间加和求和</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Segment</span> &#123;</span><br><span class="line">    vector&lt;T&gt; f;</span><br><span class="line">    vector&lt;T&gt; tag;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Segment</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Segment</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n) &#123; </span><br><span class="line">        f.<span class="built_in">assign</span>(n &lt;&lt; <span class="number">2</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        tag.<span class="built_in">assign</span>(n &lt;&lt; <span class="number">2</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, T c, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= s &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">            f[p] += c * (t - s + <span class="number">1</span>);</span><br><span class="line">            tag[p] += c;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> m = s + ((t - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (tag[p]) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(s, t, p);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (l &lt;= m) &#123;</span><br><span class="line">            <span class="built_in">update</span>(l, r, c, s, m, p * <span class="number">2</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (r &gt; m) &#123;</span><br><span class="line">            <span class="built_in">update</span>(l, r, c, m + <span class="number">1</span>, t, p * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        f[p] = f[p * <span class="number">2</span>] + f[p * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> m = s + ((t - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        f[p * <span class="number">2</span>] += <span class="number">1LL</span> * (m - s + <span class="number">1</span>) * tag[p];</span><br><span class="line">        f[p * <span class="number">2</span> + <span class="number">1</span>] += <span class="number">1LL</span> * (t - m) * tag[p];</span><br><span class="line">        tag[p * <span class="number">2</span>] += tag[p];</span><br><span class="line">        tag[p * <span class="number">2</span> + <span class="number">1</span>] += tag[p];</span><br><span class="line">        tag[p] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= s &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">            <span class="keyword">return</span> f[p];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> m = s + ((t - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (tag[p]) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(s, t, p);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        T sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= m) &#123;</span><br><span class="line">            sum += <span class="built_in">query</span>(l, r, s, m, p * <span class="number">2</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (r &gt; m) &#123;</span><br><span class="line">            sum += <span class="built_in">query</span>(l, r, m + <span class="number">1</span>, t, p * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">query</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(s, t, <span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, T c)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">update</span>(s, t, c, <span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>我赶时间版本：<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Segment</span> &#123;</span><br><span class="line">    vector&lt;T&gt; f;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Segment</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Segment</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n) &#123; </span><br><span class="line">        f.<span class="built_in">assign</span>(n &lt;&lt; <span class="number">2</span> + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, T c, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s == t &amp;&amp; l == s) &#123;</span><br><span class="line">            f[p] = c;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> m = s + ((t - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (l &lt;= m) &#123;</span><br><span class="line">            <span class="built_in">update</span>(l, r, c, s, m, p * <span class="number">2</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (r &gt; m) &#123;</span><br><span class="line">            <span class="built_in">update</span>(l, r, c, m + <span class="number">1</span>, t, p * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushup</span>(s, t, p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> s, <span class="type">int</span> t, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= s &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">            <span class="keyword">return</span> f[p];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> m = s + ((t - s) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        T sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (l &lt;= m) &#123;</span><br><span class="line">            sum += <span class="built_in">query</span>(l, r, s, m, p * <span class="number">2</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span> (r &gt; m) &#123;</span><br><span class="line">            sum += <span class="built_in">query</span>(l, r, m + <span class="number">1</span>, t, p * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">query</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(s, t, <span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t, T c)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">update</span>(s, t, c, <span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>算法</category>
        <category>数据结构</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>类字节码</title>
    <url>/2025/03/08/%E7%B1%BB%E5%AD%97%E8%8A%82%E7%A0%81/</url>
    <content><![CDATA[<h1 id="JVM-基础-类字节码详解"><a href="#JVM-基础-类字节码详解" class="headerlink" title="JVM 基础 - 类字节码详解"></a>JVM 基础 - 类字节码详解</h1><blockquote>
<p>源代码通过编译器编译为字节码，再通过类加载子系统进行加载到JVM中运行。@pdai</p>
</blockquote>
<h2 id="多语言编译为字节码在JVM运行"><a href="#多语言编译为字节码在JVM运行" class="headerlink" title="# 多语言编译为字节码在JVM运行"></a><a href="#多语言编译为字节码在jvm运行">#</a> 多语言编译为字节码在JVM运行</h2><p>计算机是不能直接运行java代码的，必须要先运行java虚拟机，再由java虚拟机运行编译后的java代码。这个编译后的java代码，就是本文要介绍的java字节码。</p>
<p>为什么jvm不能直接运行java代码呢，这是因为在cpu层面看来计算机中所有的操作都是一个个指令的运行汇集而成的，java是高级语言，只有人类才能理解其逻辑，计算机是无法识别的，所以java代码必须要先编译成字节码文件，jvm才能正确识别代码转换后的指令并将其运行。</p>
<ul>
<li>Java代码间接翻译成字节码，储存字节码的文件再交由运行于不同平台上的JVM虚拟机去读取执行，从而实现一次编写，到处运行的目的。</li>
<li>JVM也不再只支持Java，由此衍生出了许多基于JVM的编程语言，如Groovy, Scala, Koltin等等。</li>
</ul>
<h2 id="Java字节码文件"><a href="#Java字节码文件" class="headerlink" title="# Java字节码文件"></a><a href="#java字节码文件">#</a> Java字节码文件</h2><p>class文件本质上是一个以8位字节为基础单位的二进制流，各个数据项目严格按照顺序紧凑的排列在class文件中。jvm根据其特定的规则解析该二进制数据，从而得到相关信息。</p>
<p>Class文件采用一种伪结构来存储数据，它有两种类型：无符号数和表。这里暂不详细的讲。</p>
<p>本文将通过简单的java例子编译后的文件来理解。</p>
<h3 id="Class文件的结构属性"><a href="#Class文件的结构属性" class="headerlink" title="# Class文件的结构属性"></a><a href="#class文件的结构属性">#</a> Class文件的结构属性</h3><p>在理解之前先从整体看下java字节码文件包含了哪些类型的数据：</p>
<h3 id="从一个例子开始"><a href="#从一个例子开始" class="headerlink" title="# 从一个例子开始"></a><a href="#从一个例子开始">#</a> 从一个例子开始</h3><p>下面以一个简单的例子来逐步讲解字节码。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Main.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> m;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">inc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> m + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以下命令, 可以在当前所在路径下生成一个Main.class文件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">javac Main.java</span><br></pre></td></tr></table></figure>
<p>以文本的形式打开生成的class文件，内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cafe babe 0000 0034 0013 0a00 0400 0f09</span><br><span class="line">0003 0010 0700 1107 0012 0100 016d 0100</span><br><span class="line">0149 0100 063c 696e 6974 3e01 0003 2829</span><br><span class="line">5601 0004 436f 6465 0100 0f4c 696e 654e</span><br><span class="line">756d 6265 7254 6162 6c65 0100 0369 6e63</span><br><span class="line">0100 0328 2949 0100 0a53 6f75 7263 6546</span><br><span class="line">696c 6501 0009 4d61 696e 2e6a 6176 610c</span><br><span class="line">0007 0008 0c00 0500 0601 0010 636f 6d2f</span><br><span class="line">7268 7974 686d 372f 4d61 696e 0100 106a</span><br><span class="line">6176 612f 6c61 6e67 2f4f 626a 6563 7400</span><br><span class="line">2100 0300 0400 0000 0100 0200 0500 0600</span><br><span class="line">0000 0200 0100 0700 0800 0100 0900 0000</span><br><span class="line">1d00 0100 0100 0000 052a b700 01b1 0000</span><br><span class="line">0001 000a 0000 0006 0001 0000 0003 0001</span><br><span class="line">000b 000c 0001 0009 0000 001f 0002 0001</span><br><span class="line">0000 0007 2ab4 0002 0460 ac00 0000 0100</span><br><span class="line">0a00 0000 0600 0100 0000 0800 0100 0d00</span><br><span class="line">0000 0200 0e</span><br></pre></td></tr></table></figure>
<ul>
<li>文件开头的4个字节(“cafe babe”)称之为 <code>魔数</code>，唯有以”cafe babe”开头的class文件方可被虚拟机所接受，这4个字节就是字节码文件的身份识别。</li>
<li>0000是编译器jdk版本的次版本号0，0034转化为十进制是52,是主版本号，java的版本号从45开始，除1.0和1.1都是使用45.x外,以后每升一个大版本，版本号加一。也就是说，编译生成该class文件的jdk版本为1.8.0。</li>
</ul>
<p>通过java -version命令稍加验证, 可得结果。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_131-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)</span><br></pre></td></tr></table></figure>
<p>继续往下是常量池… 知道是这么分析的就可以了，然后我们通过工具反编译字节码文件继续去看。</p>
<h3 id="反编译字节码文件"><a href="#反编译字节码文件" class="headerlink" title="# 反编译字节码文件"></a><a href="#反编译字节码文件">#</a> 反编译字节码文件</h3><blockquote>
<p>使用到java内置的一个反编译工具javap可以反编译字节码文件, 用法: <code>javap &lt;options&gt; &lt;classes&gt;</code></p>
</blockquote>
<p>其中<code>&lt;options&gt;</code>选项包括:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-<span class="built_in">help</span>  --<span class="built_in">help</span>  -?        输出此用法消息</span><br><span class="line">-version                 版本信息</span><br><span class="line">-v  -verbose             输出附加信息</span><br><span class="line">-l                       输出行号和本地变量表</span><br><span class="line">-public                  仅显示公共类和成员</span><br><span class="line">-protected               显示受保护的/公共类和成员</span><br><span class="line">-package                 显示程序包/受保护的/公共类</span><br><span class="line">                         和成员 (默认)</span><br><span class="line">-p  -private             显示所有类和成员</span><br><span class="line">-c                       对代码进行反汇编</span><br><span class="line">-s                       输出内部类型签名</span><br><span class="line">-sysinfo                 显示正在处理的类的</span><br><span class="line">                         系统信息 (路径, 大小, 日期, MD5 散列)</span><br><span class="line">-constants               显示最终常量</span><br><span class="line">-classpath &lt;path&gt;        指定查找用户类文件的位置</span><br><span class="line">-<span class="built_in">cp</span> &lt;path&gt;               指定查找用户类文件的位置</span><br><span class="line">-bootclasspath &lt;path&gt;    覆盖引导类文件的位置</span><br></pre></td></tr></table></figure>
<p>输入命令<code>javap -verbose -p Main.class</code>查看输出内容:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Classfile /E:/JavaCode/TestProj/out/production/TestProj/com/rhythm7/Main.<span class="keyword">class</span></span><br><span class="line">  <span class="title class_">Last</span> modified <span class="number">2018</span>-<span class="number">4</span>-<span class="number">7</span>; size <span class="number">362</span> bytes</span><br><span class="line">  MD5 checksum 4aed8540b098992663b7ba08c65312de</span><br><span class="line">  Compiled from <span class="string">&quot;Main.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.rhythm7.Main</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">4.</span>#<span class="number">18</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">3.</span>#<span class="number">19</span>         <span class="comment">// com/rhythm7/Main.m:I</span></span><br><span class="line">   #<span class="number">3</span> = Class              #<span class="number">20</span>            <span class="comment">// com/rhythm7/Main</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">21</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">5</span> = Utf8               m</span><br><span class="line">   #<span class="number">6</span> = Utf8               I</span><br><span class="line">   #<span class="number">7</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">8</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">9</span> = Utf8               Code</span><br><span class="line">  #<span class="number">10</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">12</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">13</span> = Utf8               Lcom/rhythm7/Main;</span><br><span class="line">  #<span class="number">14</span> = Utf8               inc</span><br><span class="line">  #<span class="number">15</span> = Utf8               ()I</span><br><span class="line">  #<span class="number">16</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">17</span> = Utf8               Main.java</span><br><span class="line">  #<span class="number">18</span> = NameAndType        #<span class="number">7</span>:#<span class="number">8</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">19</span> = NameAndType        #<span class="number">5</span>:#<span class="number">6</span>          <span class="comment">// m:I</span></span><br><span class="line">  #<span class="number">20</span> = Utf8               com/rhythm7/Main</span><br><span class="line">  #<span class="number">21</span> = Utf8               java/lang/Object</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> m;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PRIVATE</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> com.rhythm7.Main();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/rhythm7/Main;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">inc</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: getfield      #<span class="number">2</span>                  <span class="comment">// Field m:I</span></span><br><span class="line">         <span class="number">4</span>: iconst_1</span><br><span class="line">         <span class="number">5</span>: iadd</span><br><span class="line">         <span class="number">6</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">8</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">7</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/rhythm7/Main;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;Main.java&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="字节码文件信息"><a href="#字节码文件信息" class="headerlink" title="# 字节码文件信息"></a><a href="#字节码文件信息">#</a> 字节码文件信息</h3><p>开头的7行信息包括:Class文件当前所在位置，最后修改时间，文件大小，MD5值，编译自哪个文件，类的全限定名，jdk次版本号，主版本号。</p>
<p>然后紧接着的是该类的访问标志：ACC_PUBLIC, ACC_SUPER，访问标志的含义如下:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>标志名称</th>
<th>标志值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>是否为Public类型</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>是否被声明为final，只有类可以设置</td>
</tr>
<tr>
<td>ACC_SUPER</td>
<td>0x0020</td>
<td>是否允许使用invokespecial字节码指令的新语义．</td>
</tr>
<tr>
<td>ACC_INTERFACE</td>
<td>0x0200</td>
<td>标志这是一个接口</td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x0400</td>
<td>是否为abstract类型，对于接口或者抽象类来说，次标志值为真，其他类型为假</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>标志这个类并非由用户代码产生</td>
</tr>
<tr>
<td>ACC_ANNOTATION</td>
<td>0x2000</td>
<td>标志这是一个注解</td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>标志这是一个枚举</td>
</tr>
</tbody>
</table>
</div>
<h3 id="常量池"><a href="#常量池" class="headerlink" title="# 常量池"></a><a href="#常量池">#</a> 常量池</h3><p><code>Constant pool</code>意为常量池。</p>
<p>常量池可以理解成Class文件中的资源仓库。主要存放的是两大类常量：字面量(Literal)和符号引用(Symbolic References)。字面量类似于java中的常量概念，如文本字符串，final常量等，而符号引用则属于编译原理方面的概念，包括以下三种:</p>
<ul>
<li>类和接口的全限定名(Fully Qualified Name)</li>
<li>字段的名称和描述符号(Descriptor)</li>
<li>方法的名称和描述符</li>
</ul>
<p>不同于C/C++, JVM是在加载Class文件的时候才进行的动态链接，也就是说这些字段和方法符号引用只有在运行期转换后才能获得真正的内存入口地址。当虚拟机运行时，需要从常量池获得对应的符号引用，再在类创建或运行时解析并翻译到具体的内存地址中。 直接通过反编译文件来查看字节码内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#1 = Methodref          #4.#18         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">#4 = Class              #21            // java/lang/Object</span><br><span class="line">#7 = Utf8               &lt;init&gt;</span><br><span class="line">#8 = Utf8               ()V</span><br><span class="line">#18 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">#21 = Utf8               java/lang/Object</span><br></pre></td></tr></table></figure>
<p><strong>第一个常量</strong>是一个方法定义，指向了第4和第18个常量。以此类推查看第4和第18个常量。最后可以拼接成第一个常量右侧的注释内容:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br></pre></td></tr></table></figure>
<p>这段可以理解为该类的实例构造器的声明，由于Main类没有重写构造方法，所以调用的是父类的构造方法。此处也说明了Main类的直接父类是Object。 该方法默认返回值是V, 也就是void，无返回值。</p>
<p><strong>第二个常量</strong>同理可得:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#2 = Fieldref           #3.#19         // com/rhythm7/Main.m:I</span><br><span class="line">#3 = Class              #20            // com/rhythm7/Main</span><br><span class="line">#5 = Utf8               m</span><br><span class="line">#6 = Utf8               I</span><br><span class="line">#19 = NameAndType        #5:#6          // m:I</span><br><span class="line">#20 = Utf8               com/rhythm7/Main</span><br></pre></td></tr></table></figure>
<p>复制代码此处声明了一个字段m，类型为I, I即是int类型。关于字节码的类型对应如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>标识字符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>B</td>
<td>基本类型byte</td>
</tr>
<tr>
<td>C</td>
<td>基本类型char</td>
</tr>
<tr>
<td>D</td>
<td>基本类型double</td>
</tr>
<tr>
<td>F</td>
<td>基本类型float</td>
</tr>
<tr>
<td>I</td>
<td>基本类型int</td>
</tr>
<tr>
<td>J</td>
<td>基本类型long</td>
</tr>
<tr>
<td>S</td>
<td>基本类型short</td>
</tr>
<tr>
<td>Z</td>
<td>基本类型boolean</td>
</tr>
<tr>
<td>V</td>
<td>特殊类型void</td>
</tr>
<tr>
<td>L</td>
<td>对象类型，以分号结尾，如Ljava/lang/Object;</td>
</tr>
</tbody>
</table>
</div>
<p>对于数组类型，每一位使用一个前置的<code>[</code>字符来描述，如定义一个<code>java.lang.String[][]</code>类型的维数组，将被记录为<code>[[Ljava/lang/String;</code></p>
<h3 id="方法表集合"><a href="#方法表集合" class="headerlink" title="# 方法表集合"></a><a href="#方法表集合">#</a> 方法表集合</h3><p>在常量池之后的是对类内部的方法描述，在字节码中以表的集合形式表现，暂且不管字节码文件的16进制文件内容如何，我们直接看反编译后的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private int m;</span><br><span class="line">  descriptor: I</span><br><span class="line">  flags: ACC_PRIVATE</span><br></pre></td></tr></table></figure>
<p>此处声明了一个私有变量m，类型为int，返回值为int</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> com.rhythm7.Main();</span><br><span class="line">   descriptor: ()V</span><br><span class="line">   flags: ACC_PUBLIC</span><br><span class="line">   Code:</span><br><span class="line">     stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">        <span class="number">0</span>: aload_0</span><br><span class="line">        <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">        <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">     LocalVariableTable:</span><br><span class="line">       Start  Length  Slot  Name   Signature</span><br><span class="line">           <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/rhythm7/Main;</span><br></pre></td></tr></table></figure>
<p>这里是构造方法：Main()，返回值为void, 公开方法。</p>
<p>code内的主要属性为:</p>
<ul>
<li><p><strong>stack</strong>: 最大操作数栈，JVM运行时会根据这个值来分配栈帧(Frame)中的操作栈深度,此处为1</p>
</li>
<li><p><strong>locals</strong>: 局部变量所需的存储空间，单位为Slot, Slot是虚拟机为局部变量分配内存时所使用的最小单位，为4个字节大小。方法参数(包括实例方法中的隐藏参数this)，显示异常处理器的参数(try catch中的catch块所定义的异常)，方法体中定义的局部变量都需要使用局部变量表来存放。值得一提的是，locals的大小并不一定等于所有局部变量所占的Slot之和，因为局部变量中的Slot是可以重用的。</p>
</li>
<li><p><strong>args_size</strong>: 方法参数的个数，这里是1，因为每个实例方法都会有一个隐藏参数this</p>
</li>
<li><p><strong>attribute_info</strong>: 方法体内容，0,1,4为字节码”行号”，该段代码的意思是将第一个引用类型本地变量推送至栈顶，然后执行该类型的实例方法，也就是常量池存放的第一个变量，也就是注释里的<code>java/lang/Object.&quot;&quot;:()V</code>, 然后执行返回语句，结束方法。</p>
</li>
<li><p><strong>LineNumberTable</strong>: 该属性的作用是描述源码行号与字节码行号(字节码偏移量)之间的对应关系。可以使用 -g:none 或-g:lines选项来取消或要求生成这项信息，如果选择不生成LineNumberTable，当程序运行异常时将无法获取到发生异常的源码行号，也无法按照源码的行数来调试程序。</p>
</li>
<li><p><strong>LocalVariableTable</strong>: 该属性的作用是描述帧栈中局部变量与源码中定义的变量之间的关系。可以使用 -g:none 或 -g:vars来取消或生成这项信息，如果没有生成这项信息，那么当别人引用这个方法时，将无法获取到参数名称，取而代之的是arg0, arg1这样的占位符。 start 表示该局部变量在哪一行开始可见，length表示可见行数，Slot代表所在帧栈位置，Name是变量名称，然后是类型签名。</p>
</li>
</ul>
<p>同理可以分析Main类中的另一个方法”inc()”:</p>
<p>方法体内的内容是：将this入栈，获取字段#2并置于栈顶, 将int类型的1入栈，将栈内顶部的两个数值相加，返回一个int类型的值。</p>
<h3 id="类名"><a href="#类名" class="headerlink" title="# 类名"></a><a href="#类名">#</a> 类名</h3><p>最后很显然是源码文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SourceFile: &quot;Main.java&quot;</span><br></pre></td></tr></table></figure>
<h2 id="再看两个示例"><a href="#再看两个示例" class="headerlink" title="# 再看两个示例"></a><a href="#再看两个示例">#</a> 再看两个示例</h2><h3 id="分析try-catch-finally"><a href="#分析try-catch-finally" class="headerlink" title="# 分析try-catch-finally"></a><a href="#分析try-catch-finally">#</a> 分析try-catch-finally</h3><p>通过以上一个最简单的例子，可以大致了解源码被编译成字节码后是什么样子的。 下面利用所学的知识点来分析一些Java问题:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCode</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            x = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            x = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            x = <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>试问当不发生异常和发生异常的情况下，foo()的返回值分别是多少。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javac TestCode.java</span><br><span class="line">javap -verbose TestCode.class</span><br></pre></td></tr></table></figure>
<p>查看字节码的foo方法内容:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">foo</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">5</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: iconst_1 <span class="comment">//int型1入栈 -&gt;栈顶=1</span></span><br><span class="line">         <span class="number">1</span>: istore_1 <span class="comment">//将栈顶的int型数值存入第二个局部变量 -&gt;局部2=1</span></span><br><span class="line">         <span class="number">2</span>: iload_1 <span class="comment">//将第二个int型局部变量推送至栈顶 -&gt;栈顶=1</span></span><br><span class="line">         <span class="number">3</span>: istore_2 <span class="comment">//!!将栈顶int型数值存入第三个局部变量 -&gt;局部3=1</span></span><br><span class="line">         </span><br><span class="line">         <span class="number">4</span>: iconst_3 <span class="comment">//int型3入栈 -&gt;栈顶=3</span></span><br><span class="line">         <span class="number">5</span>: istore_1 <span class="comment">//将栈顶的int型数值存入第二个局部变量 -&gt;局部2=3</span></span><br><span class="line">         <span class="number">6</span>: iload_2 <span class="comment">//!!将第三个int型局部变量推送至栈顶 -&gt;栈顶=1</span></span><br><span class="line">         <span class="number">7</span>: ireturn <span class="comment">//从当前方法返回栈顶int数值 -&gt;1</span></span><br><span class="line">         </span><br><span class="line">         <span class="number">8</span>: astore_2 <span class="comment">// -&gt;局部3=Exception</span></span><br><span class="line">         <span class="number">9</span>: iconst_2 <span class="comment">// -&gt;栈顶=2</span></span><br><span class="line">        <span class="number">10</span>: istore_1 <span class="comment">// -&gt;局部2=2</span></span><br><span class="line">        <span class="number">11</span>: iload_1 <span class="comment">//-&gt;栈顶=2</span></span><br><span class="line">        <span class="number">12</span>: istore_3 <span class="comment">//!! -&gt;局部4=2</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">13</span>: iconst_3 <span class="comment">// -&gt;栈顶=3</span></span><br><span class="line">        <span class="number">14</span>: istore_1 <span class="comment">// -&gt;局部1=3</span></span><br><span class="line">        <span class="number">15</span>: iload_3 <span class="comment">//!! -&gt;栈顶=2</span></span><br><span class="line">        <span class="number">16</span>: ireturn <span class="comment">// -&gt; 2</span></span><br><span class="line">        </span><br><span class="line">        <span class="number">17</span>: astore        <span class="number">4</span> <span class="comment">//将栈顶引用型数值存入第五个局部变量=any</span></span><br><span class="line">        <span class="number">19</span>: iconst_3 <span class="comment">//将int型数值3入栈 -&gt; 栈顶3</span></span><br><span class="line">        <span class="number">20</span>: istore_1 <span class="comment">//将栈顶第一个int数值存入第二个局部变量 -&gt; 局部2=3</span></span><br><span class="line">        <span class="number">21</span>: aload         <span class="number">4</span> <span class="comment">//将局部第五个局部变量(引用型)推送至栈顶</span></span><br><span class="line">        <span class="number">23</span>: athrow <span class="comment">//将栈顶的异常抛出</span></span><br><span class="line">      Exception table:</span><br><span class="line">         from    to  target type</span><br><span class="line">             <span class="number">0</span>     <span class="number">4</span>     <span class="number">8</span>   Class java/lang/Exception <span class="comment">//0到4行对应的异常，对应#8中储存的异常</span></span><br><span class="line">             <span class="number">0</span>     <span class="number">4</span>    <span class="number">17</span>   any <span class="comment">//Exeption之外的其他异常</span></span><br><span class="line">             <span class="number">8</span>    <span class="number">13</span>    <span class="number">17</span>   any</span><br><span class="line">            <span class="number">17</span>    <span class="number">19</span>    <span class="number">17</span>   any</span><br></pre></td></tr></table></figure>
<p>在字节码的4,5，以及13,14中执行的是同一个操作，就是将int型的3入操作数栈顶，并存入第二个局部变量。这正是我们源码在finally语句块中内容。也就是说，JVM在处理异常时，会在每个可能的分支都将finally语句重复执行一遍。</p>
<p>通过一步步分析字节码，可以得出最后的运行结果是：</p>
<ul>
<li>不发生异常时: return 1</li>
<li>发生异常时: return 2</li>
<li>发生非Exception及其子类的异常，抛出异常，不返回值</li>
</ul>
<blockquote>
<p>以上例子来自于《深入理解Java虚拟机 JVM高级特性与最佳实践》, 关于虚拟机字节码指令表，也可以在《深入理解Java虚拟机 JVM高级特性与最佳实践-附录B》中获取。</p>
</blockquote>
<h3 id="kotlin-函数扩展的实现"><a href="#kotlin-函数扩展的实现" class="headerlink" title="# kotlin 函数扩展的实现"></a><a href="#kotlin-函数扩展的实现">#</a> kotlin 函数扩展的实现</h3><p>kotlin提供了扩展函数的语言特性，借助这个特性，我们可以给任意对象添加自定义方法。</p>
<p>以下示例为Object添加”sayHello”方法</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//SayHello.kt</span></span><br><span class="line"><span class="keyword">package</span> com.rhythm7</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Any.<span class="title">sayHello</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后，使用javap查看生成SayHelloKt.class文件的字节码。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Classfile /E:/JavaCode/TestProj/out/production/TestProj/com/rhythm7/SayHelloKt.class</span><br><span class="line">Last modified 2018-4-8; size 958 bytes</span><br><span class="line"> MD5 checksum 780a04b75a91be7605cac4655b499f19</span><br><span class="line"> Compiled from &quot;SayHello.kt&quot;</span><br><span class="line">public final class com.rhythm7.SayHelloKt</span><br><span class="line"> minor version: 0</span><br><span class="line"> major version: 52</span><br><span class="line"> flags: ACC_PUBLIC, ACC_FINAL, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">    //省略常量池部分字节码</span><br><span class="line">&#123;</span><br><span class="line"> public static final void sayHello(java.lang.Object);</span><br><span class="line">   descriptor: (Ljava/lang/Object;)V</span><br><span class="line">   flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">   Code:</span><br><span class="line">     stack=2, locals=2, args_size=1</span><br><span class="line">        0: aload_0</span><br><span class="line">        1: ldc           #9                  // String $receiver</span><br><span class="line">        3: invokestatic  #15                 // Method kotlin/jvm/internal/Intrinsics.checkParameterIsNotNull:(Ljava/lang/Object;Ljava/lang/String;)V</span><br><span class="line">        6: ldc           #17                 // String Hello</span><br><span class="line">        8: astore_1</span><br><span class="line">        9: getstatic     #23                 // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       12: aload_1</span><br><span class="line">       13: invokevirtual #28                 // Method java/io/PrintStream.println:(Ljava/lang/Object;)V</span><br><span class="line">       16: return</span><br><span class="line">     LocalVariableTable:</span><br><span class="line">       Start  Length  Slot  Name   Signature</span><br><span class="line">           0      17     0 $receiver   Ljava/lang/Object;</span><br><span class="line">     LineNumberTable:</span><br><span class="line">       line 4: 6</span><br><span class="line">       line 5: 16</span><br><span class="line">   RuntimeInvisibleParameterAnnotations:</span><br><span class="line">     0:</span><br><span class="line">       0: #7()</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;SayHello.kt&quot;</span><br></pre></td></tr></table></figure>
<p>观察头部发现,koltin为文件SayHello生成了一个类，类名”com.rhythm7.SayHelloKt”.</p>
<p>由于我们一开始编写SayHello.kt时并不希望SayHello是一个可实例化的对象类，所以，SayHelloKt是无法被实例化的，SayHelloKt并没有任何一个构造器。</p>
<p>再观察唯一的一个方法：发现Any.sayHello()的具体实现是静态不可变方法的形式:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(java.lang.Object)</span>;</span><br></pre></td></tr></table></figure>
<p>所以当我们在其他地方使用Any.sayHello()时，事实上等同于调用java的SayHelloKt.sayHello(Object)方法。</p>
<p>顺便一提的是，当扩展的方法为Any时，意味着Any是non-null的，这时，编译器会在方法体的开头检查参数的非空，即调用 <code>kotlin.jvm.internal.Intrinsics.checkParameterIsNotNull(Object value, String paramName)</code> 方法来检查传入的Any类型对象是否为空。如果我们扩展的函数为<code>Any?.sayHello()</code>，那么在编译后的文件中则不会有这段字节码的出现。</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="# 参考文章"></a><a href="#参考文章">#</a> 参考文章</h2><ul>
<li><a href="https://www.cnblogs.com/paddix/p/5282004.html">https://www.cnblogs.com/paddix/p/5282004.html</a></li>
<li><a href="https://blog.csdn.net/sinat_37191123/article/details/84582438">https://blog.csdn.net/sinat_37191123/article/details/84582438</a></li>
<li><a href="https://blog.csdn.net/tyyj90/article/details/78472986">https://blog.csdn.net/tyyj90/article/details/78472986</a></li>
<li><a href="https://blog.csdn.net/a15089415104/article/details/83215598">https://blog.csdn.net/a15089415104/article/details/83215598</a></li>
<li>咸鱼不思议 <a href="https://juejin.im/post/5aca2c366fb9a028c97a5609">https://juejin.im/post/5aca2c366fb9a028c97a5609</a></li>
<li><a href="https://pdai.tech/md/java/jvm/java-jvm-class.html">https://pdai.tech/md/java/jvm/java-jvm-class.html</a></li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>正则表达式</title>
    <url>/2025/03/03/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    <content><![CDATA[<blockquote>
<p>正则表达式用于对字符串的匹配判断中</p>
</blockquote>
<hr>
<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符:"></a>元字符:</h2><div class="table-container">
<table>
<thead>
<tr>
<th>元字符</th>
<th>正则表达式中的写法</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>.</td>
<td>代表任意一个字符</td>
</tr>
<tr>
<td>\d</td>
<td>\\d</td>
<td>代表0 - 9任意一个数字字符</td>
</tr>
<tr>
<td>\D</td>
<td>\\D</td>
<td>代表任意一个非数字字符</td>
</tr>
<tr>
<td>\s</td>
<td>\\s</td>
<td>代表空白字符， 如’\n’ , ‘\t’</td>
</tr>
<tr>
<td>\S</td>
<td>\S</td>
<td>代表分空白字符</td>
</tr>
<tr>
<td>\w</td>
<td>\w</td>
<td>代表可用作标识符的字符， 但不包括 “$”</td>
</tr>
<tr>
<td>\W</td>
<td>\W</td>
<td>代表不可以用作标识符的字符</td>
</tr>
<tr>
<td>\p{Lower}</td>
<td>\p{Lower}</td>
<td>代表小写字母 a ~ z</td>
</tr>
<tr>
<td>\p{Upper}</td>
<td>\p{Upper}</td>
<td>代表大写字母 A ~ Z</td>
</tr>
<tr>
<td>\p{ASCII}</td>
<td>\p{ASCII}</td>
<td>ASCII 字符</td>
</tr>
<tr>
<td>\p{Alpha}</td>
<td>\p{Alpha}</td>
<td>字母字符</td>
</tr>
<tr>
<td>\p{Digit}</td>
<td>\p{Digit}</td>
<td>十进制数字</td>
</tr>
<tr>
<td>\p{Alnum}</td>
<td>\p{Alnum}</td>
<td>数字或字母字符</td>
</tr>
<tr>
<td>\p{Punct}</td>
<td>\p{Punct}</td>
<td>标点符号 : “!@#$%^&amp;、*()[]“等等</td>
</tr>
<tr>
<td>\p{Graph}</td>
<td>\p{Graph}</td>
<td>可见字符: [\p{Alnum}\p{Punct}]</td>
</tr>
<tr>
<td>\p{Print}</td>
<td>\p{Print}</td>
<td>可打印字符: [\p{Graph}\x20]</td>
</tr>
<tr>
<td>\p{Blank}</td>
<td>\p{Blank}</td>
<td>空格或者制表符: [\t]</td>
</tr>
<tr>
<td>\p{Cntrl}</td>
<td>\p{Cntrl}</td>
<td>控制字符: [\x00-\x1F\x7F]</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>在正则表达式中 “ . “ 代表任意一个字符，所以在使用时候如果要判断有普通意义的”.”需要加斜杆（和Latex特殊字符控制一样）</p>
</blockquote>
<ul>
<li>例子：<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegexExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;\\d+&quot;</span>; <span class="comment">// 匹配一个或多个数字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">&quot;12345&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(regex);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(input);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (matcher.matches()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;完全匹配!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;不匹配!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>事实上，String类里面封装了Pattern类，也可以通过一下方式来调用Pattern里面的匹配：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">input.matches(regex) <span class="comment">//其内部调用了 `Pattern.matches(regex, this)`</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="元字符与基本符号（-important）"><a href="#元字符与基本符号（-important）" class="headerlink" title="元字符与基本符号（!important）"></a>元字符与基本符号（!important）</h3><ul>
<li><strong>.</strong><br>  匹配除换行符外的任意单个字符。例如：<code>a.c</code> 可以匹配 “abc”、”a-c” 等。</li>
</ul>
<hr>
<pre><code>匹配前面的元素 0 次或多次。例如：`ab*c` 可以匹配 &quot;ac&quot;、&quot;abc&quot;、&quot;abbc&quot; 等。
</code></pre><ul>
<li><p><strong>+</strong><br>  匹配前面的元素 1 次或多次。例如：<code>ab+c</code> 不能匹配 “ac”，但可以匹配 “abc”、”abbc” 等。</p>
</li>
<li><p><strong>?</strong><br>  匹配前面的元素 0 次或 1 次。例如：<code>colou?r</code> 可以匹配 “color” 和 “colour”。</p>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;abcdd?e&quot;</span>; <span class="comment">// 匹配一个或零个数字  </span></span><br><span class="line"><span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">&quot;abcde&quot;</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(regex);  </span><br><span class="line"><span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(input);  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (matcher.matches()) &#123;  </span><br><span class="line">    System.out.println(<span class="string">&quot;完全匹配!&quot;</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">    System.out.println(<span class="string">&quot;不匹配!&quot;</span>);  </span><br><span class="line">&#125;    </span><br><span class="line"><span class="comment">// 结果是匹配，因为该位置的d没有出现（0次），其他基本符号用法同理</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>{}</strong><br>  限定匹配次数：</p>
<ul>
<li><code>&#123;n&#125;</code>：匹配恰好 n 次</li>
<li><code>&#123;n,&#125;</code>：至少 n 次</li>
<li><code>&#123;n,m&#125;</code>：至少 n 次，最多 m 次<br>  例如：<code>\\d&#123;3&#125;</code> 匹配连续3个数字。</li>
</ul>
</li>
<li><p><strong>[]</strong><br>  定义字符集合，例如：<code>[abc]</code> 匹配 ‘a’、’b’ 或 ‘c’；<code>[a-z]</code> 匹配所有小写字母。</p>
</li>
<li><p><strong>^</strong> 和 <strong>$</strong><br>  分别表示字符串的开始和结束。例如：<code>^Hello</code> 表示字符串必须以 “Hello” 开始，<code>world$</code> 表示必须以 “world” 结尾。</p>
</li>
<li><p><strong>|</strong><br>  表示“或”的关系。例如：<code>cat|dog</code> 表示匹配 “cat” 或 “dog”</p>
</li>
</ul>
<hr>
<h2 id="多个元字符代表一个字符-字符集合"><a href="#多个元字符代表一个字符-字符集合" class="headerlink" title="多个元字符代表一个字符(字符集合)"></a>多个元字符代表一个字符(字符集合)</h2><p>在正则表达式中可以使用方括号括起若干字符表示一个元字符，该字符可以表示元字符中的任意一个字符。例如: reg = “[abc]4”, 这样a4, b4, c4都是和正则表达式匹配的字符串。方括号还可以为其他格式。如: </p>
<ul>
<li>[^456]除了456之外的任何字符</li>
<li>[a-r]代表a - r中的任何一个字符</li>
<li>[a-zA-Z]: 代表任何一个英文字母</li>
<li>[a-e[g-z]]: 代表a - e <strong>并</strong> g - z 间的字母</li>
<li>[a-o&amp;&amp;[def]]: 代表字母def， 并运算</li>
<li>[a-d&amp;&amp;[^bc]]: 代表a, d(差运算)</li>
</ul>
<hr>
<h2 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h2><h4 id="一-判断字符串是否是邮箱："><a href="#一-判断字符串是否是邮箱：" class="headerlink" title="一. 判断字符串是否是邮箱："></a>一. 判断字符串是否是邮箱：</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;  </span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;  </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Javastudy</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">// 验证字符串是否是一个邮箱地址  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;\\w+@\\w+(\\.\\w&#123;2,3&#125;)*\\.\\w&#123;2,3&#125;&quot;</span>;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">&quot;511017802@qq.com&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(regex);  </span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(input);  </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine(); <span class="comment">// s = input;  </span></span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (s.matches(regex)) &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;完全匹配!&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;不匹配!&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        in.close();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="二-判断字符串是否是电话号码"><a href="#二-判断字符串是否是电话号码" class="headerlink" title="二. 判断字符串是否是电话号码"></a>二. 判断字符串是否是电话号码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;  </span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;  </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Javastudy</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">// 验证字符串是否是一个邮箱地址  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;^(\\+?86)?1[3-9]\\d&#123;9&#125;$&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">int</span> n;  </span><br><span class="line">        n = in.nextInt();  </span><br><span class="line">        in.nextLine();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.nextLine();  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (s.matches(regex)) &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;是中国大陆电话号码&quot;</span>);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;乱搞&quot;</span>);  </span><br><span class="line">            &#125;      </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="三：判断字符串是否是网址"><a href="#三：判断字符串是否是网址" class="headerlink" title="三：判断字符串是否是网址:"></a>三：判断字符串是否是网址:</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;  </span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;  </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Javastudy</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">// 验证字符串是否是一个邮箱地址  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;^(https|http)*w&#123;3&#125;\\.\\w+\\.\\w&#123;2,3&#125;&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;www.dreamstartooo.cn&quot;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (s.matches(regex)) &#123;  </span><br><span class="line">            System.out.println(s + <span class="string">&quot;是一个好网站&quot;</span>);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;乱搞&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;&#125;  </span><br><span class="line"><span class="comment">//输出 www.dreamstartooo.cn 是一个好网站!</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java包装类</title>
    <url>/2025/01/27/%E7%BB%A7%E6%89%BF/</url>
    <content><![CDATA[<p>和cpp一样，不一样的是Java可以使用super.xxx去调用父类的构造函数和成员函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigDecimal;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;  </span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;  </span><br><span class="line"><span class="keyword">import</span> java.util.*;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">solve</span><span class="params">(Scanner sc)</span> &#123;  </span><br><span class="line">        <span class="type">var</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;11234&quot;</span>);  </span><br><span class="line">        <span class="type">var</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="string">&quot;3421&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        System.out.println(a.compareTo(b));  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Move</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> pos)</span> &#123;&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in)) &#123;  </span><br><span class="line">            <span class="comment">//int t = scanner.nextInt();  </span></span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">1</span>;  </span><br><span class="line">            <span class="keyword">while</span> (t-- &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">                solve(scanner);  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Test</span> &#123;             </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Test</span><span class="params">()</span> &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;T1&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;TT1&quot;</span>);  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;  <span class="number">3</span></span><br><span class="line">          </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">T2</span> <span class="keyword">extends</span> <span class="title class_">Test</span> &#123;  </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">T2</span><span class="params">()</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>();  </span><br><span class="line">            System.out.println(<span class="string">&quot;T2&quot;</span>);  </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;  </span><br><span class="line">            <span class="built_in">super</span>.work();  </span><br><span class="line">            System.out.println(<span class="string">&quot;TT2&quot;</span>);  </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和cpp一样，在子类创建时自动调用父类无参构造函数，想调用带参数的必须使用super显示实例化</p>
<h2 id="Object-类"><a href="#Object-类" class="headerlink" title="Object 类"></a>Object 类</h2><blockquote>
<p>Object 类是Java所有类的父类，所有类都由它继承而来，所以可以省略externs Object,它包含了一系列方法</p>
</blockquote>
<ul>
<li>equals</li>
<li>toString</li>
<li>getClass()</li>
</ul>
<p>注意getClass,notify,notifyAll等都是final类型，不能重写</p>
<h2 id="类的类型转换"><a href="#类的类型转换" class="headerlink" title="类的类型转换"></a>类的类型转换</h2><p>和cpp一样，注意类向下要强制显式类型转换</p>
<h2 id="instanceof操作符号判断对象类型"><a href="#instanceof操作符号判断对象类型" class="headerlink" title="instanceof操作符号判断对象类型"></a>instanceof操作符号判断对象类型</h2><p>在程序执行向下转型时，如果父类对象不是子类的实例，就会发生ClassCastException异常， 所以在向下转型的时候要判断转型的是否是当前类的实例,用法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">myObject <span class="keyword">instanceof</span> ExampleClass</span><br></pre></td></tr></table></figure>
<ul>
<li>myObject 某个类的对象引用</li>
<li>ExampleClass， 某个类</li>
<li>返回值是Boolean, true说明myObject 是ec的实例，</li>
</ul>
<h2 id="抽象类和接口"><a href="#抽象类和接口" class="headerlink" title="抽象类和接口"></a>抽象类和接口</h2><h4 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h4><p>语法:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">testAbstract</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>接口是抽象类的延申，他说存粹的抽象类，接口中所有的方法都没有方法体</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">draw</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>interface关键字定义接口</li>
<li>注意所有的方法必须是public或者是abstract类型，即使不声明也是默认public</li>
<li>接口中定义的任何字段都是static和final的</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">VALUE</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// 等同于 public static final int VALUE = 10;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">VALUE</span> <span class="operator">=</span> <span class="number">20</span>; <span class="comment">// 这个并不是重写，而是定义了一个新的变量，隐藏了接口的 VALUE</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">printValues</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;VALUE from MyClass: &quot;</span> + VALUE);</span><br><span class="line">        System.out.println(<span class="string">&quot;VALUE from Interface: &quot;</span> + MyInterface.VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        obj.printValues();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="接口与继承"><a href="#接口与继承" class="headerlink" title="接口与继承"></a>接口与继承</h3><p>使用implements关键字可以调用接口<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> extern B implements 接口一， 二...</span><br></pre></td></tr></table></figure></p>
<p>继承是不允许多重继承的但是调用接口的时候可以调用多个，算是一种多种继承。</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>网络编程</title>
    <url>/2025/03/12/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<hr>
<h2 id="基本的通信架构"><a href="#基本的通信架构" class="headerlink" title="基本的通信架构"></a>基本的通信架构</h2><ul>
<li>基本的通信架构包括两种 : CS架构（Client客户端/Server服务端), ， C需要程序员开发</li>
<li>BS架构（Browser浏览器/Server架构) : B不需要程序员开发</li>
</ul>
<blockquote>
<p>网络通信三要素 : IP,  端口， 协议</p>
<h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3></blockquote>
<ul>
<li>InetAddress</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> demoInetAddress;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">package</span> demoInetAddress;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Net</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">// 1. 获取本机IP对象  </span></span><br><span class="line">            <span class="type">InetAddress</span> <span class="variable">ip1</span> <span class="operator">=</span> InetAddress.getLocalHost();  </span><br><span class="line">            System.out.println(ip1.getHostName());  </span><br><span class="line">            System.out.println(ip1.getHostAddress());  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 获取对象IP  </span></span><br><span class="line">            <span class="type">InetAddress</span> <span class="variable">ip2</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;www.baidu.com&quot;</span>);  </span><br><span class="line">            System.out.println(ip2.getHostName());  </span><br><span class="line">            System.out.println(ip2.getHostAddress());  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 判断是否是通的  </span></span><br><span class="line">            System.out.println(ip2.isReachable(<span class="number">5000</span>));  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><p>用来标记计算机设备上正在运行的设备<br>端口分类</p>
<ul>
<li>周知端口：0 - 1023 被预先定义的端口： （HTTP是80， FTP是21）</li>
<li>注册端口: 1024 - 49151</li>
<li>动态端口 49152 - 65535</li>
</ul>
<p>一般开发使用注册端口，且一个设备不能出现两个程序端口号一样</p>
<h3 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h3><p>事先的一些规则</p>
<hr>
<h2 id="C-S-架构（重实现）"><a href="#C-S-架构（重实现）" class="headerlink" title="C / S 架构（重实现）"></a>C / S 架构（重实现）</h2><h3 id="UDP通信实现"><a href="#UDP通信实现" class="headerlink" title="UDP通信实现"></a>UDP通信实现</h3><ul>
<li>特点： 无连接，不可靠通信</li>
<li>不事先建立链接： 发送端每次把要发送的数据限制在64K内</li>
<li>Java提供类包： <strong>java.net.DatagramSocket</strong> 实现UDP通信</li>
</ul>
<p>使用方法 : </p>
<ul>
<li>创建<ul>
<li>客户端socket = new socket</li>
<li>接收端socket = new socket(int port)<ul>
<li>接受和发送</li>
<li>socket.receive()</li>
<li>socket.send</li>
<li>数据包的新建</li>
<li>DatagramPacket(bytes[], length,  目的地址IP， 目的地址端口) // 发送端</li>
<li>DatagramPacket(bytes[], length)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="1-实现1-一发一收："><a href="#1-实现1-一发一收：" class="headerlink" title="1. 实现1: 一发一收："></a>1. 实现1: 一发一收：</h4><blockquote>
<p>UDPclient:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UDP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;  </span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPclient</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 创建发送端  </span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 创建数据包要发送的对象  </span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="string">&quot;我是客户端,约你今晚打codeforce&quot;</span>.getBytes();  </span><br><span class="line">        <span class="comment">/**  </span></span><br><span class="line"><span class="comment">         * public DatagramPacket(byte[] buf, int len, InetAdress address, int port)         * 发送的数据，字节数组  </span></span><br><span class="line"><span class="comment">         * 发送的字节长度  </span></span><br><span class="line"><span class="comment">         * 目的地址的IP  </span></span><br><span class="line"><span class="comment">         * 目的地端口  </span></span><br><span class="line"><span class="comment">         */</span>  </span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bytes, bytes.length, InetAddress.getLocalHost(), <span class="number">8080</span>);  </span><br><span class="line">        socket.send(packet);  </span><br><span class="line"></span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>UDPserver</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UDP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPserver</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 1. 创建接收端对象，组测端口  </span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">8080</span>);  <span class="comment">// 必须要表明在哪个端口接收</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 创建一个数据包对象负责接收数据  </span></span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">64</span>];  </span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 接受数据  </span></span><br><span class="line">        socket.receive(packet);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 看到数据是否是收到了  </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> packet.getLength();  </span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buf, <span class="number">0</span>, len);  </span><br><span class="line">        System.out.println(data);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 获取对方的IP和端口  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> packet.getAddress().getHostAddress();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> packet.getPort();  </span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">&quot;对方IP : &quot;</span> + ip + <span class="string">&quot; port &quot;</span> + port);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意先启动服务端监听在使用客户端发送信息，即可实现通信</p>
<h4 id="多发多收"><a href="#多发多收" class="headerlink" title="多发多收"></a>多发多收</h4><blockquote>
<p>UDPserver:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UDP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPserver</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 1. 创建接收端对象，组测端口  </span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">8080</span>);  </span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">64</span>];  </span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">            socket.receive(packet);  </span><br><span class="line">  </span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> packet.getLength();  </span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buf, <span class="number">0</span>, len);  </span><br><span class="line">            System.out.println(msg);  </span><br><span class="line">  </span><br><span class="line">            <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> packet.getAddress().getHostAddress();  </span><br><span class="line">            <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> packet.getPort();  </span><br><span class="line">  </span><br><span class="line">            System.out.println(<span class="string">&quot;对方IP : &quot;</span> + ip + <span class="string">&quot; port &quot;</span> + port);  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>UDPclient:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> UDP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;  </span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;  </span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;  </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPclient</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 创建发送端  </span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();  </span><br><span class="line">        <span class="type">var</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> in.nextLine();  </span><br><span class="line">            <span class="type">byte</span>[] bytes = msg.getBytes();  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (msg == <span class="string">&quot;exit&quot;</span>) &#123;  </span><br><span class="line">                socket.close();  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">&quot;发送成功&quot;</span>);  </span><br><span class="line">            <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bytes, bytes.length, InetAddress.getLocalHost(), <span class="number">8080</span>);  </span><br><span class="line">            socket.send(packet);  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h3 id="TCP-通信实现"><a href="#TCP-通信实现" class="headerlink" title="TCP 通信实现"></a>TCP 通信实现</h3><p>发送端：<br>使用Socket创建和发送信息，将管道包装成OutputStream方便传输各种数据<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Socket(<span class="type">int</span> IP, <span class="type">int</span> port) <span class="comment">// 发送地址，当前端口</span></span><br></pre></td></tr></table></figure><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TCP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;  </span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.net.Socket;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 1. 常见的Socket管道对象，请求与服务端Socket链接，可靠链接  </span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 2. 从socket通信管道得到一个字节输出流  </span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 3. 特殊数据流  </span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);  </span><br><span class="line">        dos.writeInt(<span class="number">1</span>);  </span><br><span class="line">        dos.writeUTF(<span class="string">&quot;今日一别,不知何时与君再相见&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        socket.close();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>服务端：<br>ServerSocket :<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ServerSocket</span><span class="params">(<span class="type">int</span> port)</span></span><br></pre></td></tr></table></figure></p>
<p>方法:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">publicSocket <span class="title function_">accept</span><span class="params">()</span> <span class="comment">// 阻塞等待客户端链接，一旦有客户端链接放回Socket对象代表服务端管道</span></span><br></pre></td></tr></table></figure></p>
<h4 id="实现：-一发一收"><a href="#实现：-一发一收" class="headerlink" title="实现： 一发一收"></a>实现： 一发一收</h4><blockquote>
<p>Server:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TCP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;  </span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;  </span><br><span class="line"><span class="keyword">import</span> java.net.Socket;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">// 创建ServerSocket对象，绑定端口号，监听客户端链接  </span></span><br><span class="line">            <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 调用accept方法，阻塞等待客户端链接，一旦有客户端链接会返回一个Socket类型对象  </span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">//获取输入流，读取客户端发送数据  </span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 把字节输入流包装成特殊数据流  </span></span><br><span class="line">            <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(is);  </span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> dis.readInt();  </span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> dis.readUTF();  </span><br><span class="line">            System.out.println(<span class="string">&quot;id = &quot;</span> + id + <span class="string">&quot; 收到一条消息: &quot;</span> + msg);  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 拿到IP和端口  </span></span><br><span class="line">            System.out.println(<span class="string">&quot;IP&quot;</span> + socket.getInetAddress().getHostAddress());  </span><br><span class="line">            System.out.println(<span class="string">&quot;端口:&quot;</span> + socket.getPort());  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Client:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TCP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;  </span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.net.Socket;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 1. 常见的Socket管道对象，请求与服务端Socket链接，可靠链接  </span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 2. 从socket通信管道得到一个字节输出流  </span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 3. 特殊数据流  </span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);  </span><br><span class="line">        dos.writeInt(<span class="number">1</span>);  </span><br><span class="line">        dos.writeUTF(<span class="string">&quot;今日一别,不知何时与君再相见&quot;</span>);  </span><br><span class="line">  </span><br><span class="line">        socket.close();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="多发多收-1"><a href="#多发多收-1" class="headerlink" title="多发多收"></a>多发多收</h4><p>Client:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TCP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;  </span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.net.Socket;  </span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// 1. 常见的Socket管道对象，请求与服务端Socket链接，可靠链接  </span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 2. 从socket通信管道得到一个字节输出流  </span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 3. 特殊数据流  </span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);  </span><br><span class="line">        <span class="type">var</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;  </span><br><span class="line">            String s;  </span><br><span class="line">            s = in.nextLine();  </span><br><span class="line">            <span class="keyword">if</span> (s == <span class="string">&quot;exit&quot;</span>) &#123;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            &#125;            </span><br><span class="line">            dos.writeUTF(s);  </span><br><span class="line">            dos.flush();  </span><br><span class="line">        &#125;        </span><br><span class="line">        socket.close();  </span><br><span class="line">        dos.close();  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Server<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TCP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;  </span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;  </span><br><span class="line"><span class="keyword">import</span> java.net.Socket;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">// 创建ServerSocket对象，绑定端口号，监听客户端链接  </span></span><br><span class="line">            <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 调用accept方法，阻塞等待客户端链接，一旦有客户端链接会返回一个Socket类型对象  </span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">//获取输入流，读取客户端发送数据  </span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();  </span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 把字节输入流包装成特殊数据流  </span></span><br><span class="line">            <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(is);  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> dis.readUTF();  </span><br><span class="line">                System.out.println(<span class="string">&quot; 收到一条消息: &quot;</span> + msg);  </span><br><span class="line">  </span><br><span class="line">                <span class="comment">// 拿到IP和端口  </span></span><br><span class="line">                System.out.println(<span class="string">&quot;IP&quot;</span> + socket.getInetAddress().getHostAddress());  </span><br><span class="line">                System.out.println(<span class="string">&quot;端口:&quot;</span> + socket.getPort());  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>注意到以上只能有一个接收端，因为只接受了一个socket，想实现多个接收，可以使用多线程：使用主线程接受客户链接，对于每个客户新开一个线程。<br>可以接受多个Client的Server<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> TCP;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;  </span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;  </span><br><span class="line"><span class="keyword">import</span> java.net.Socket;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">K</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> Socket socket;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">K</span><span class="params">(Socket socket)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.socket = socket;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();  </span><br><span class="line">            <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(is);  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> dis.readUTF();  </span><br><span class="line">                System.out.println(<span class="string">&quot; 收到一条消息: &quot;</span> + msg);  </span><br><span class="line">  </span><br><span class="line">                <span class="comment">// 拿到IP和端口  </span></span><br><span class="line">                System.out.println(<span class="string">&quot;IP&quot;</span> + socket.getInetAddress().getHostAddress());  </span><br><span class="line">                System.out.println(<span class="string">&quot;端口:&quot;</span> + socket.getPort());  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">            System.out.println(<span class="string">&quot;下线了&quot;</span>); <span class="comment">// 或者写在Final</span></span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);  </span><br><span class="line">            <span class="comment">// 调用accept方法，阻塞等待客户端链接，一旦有客户端链接会返回一个Socket类型对象  </span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">                <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();  </span><br><span class="line">                System.out.println(socket.getInetAddress().getHostAddress() + <span class="string">&quot;上线了&quot;</span>);  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">K</span>(socket).start();  </span><br><span class="line">            &#125;       </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h2 id="B-S架构"><a href="#B-S架构" class="headerlink" title="B / S架构"></a>B / S架构</h2><p> waiting for learning</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>线程</title>
    <url>/2025/03/10/%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<hr>
<h2 id="进程和线程的定义"><a href="#进程和线程的定义" class="headerlink" title="进程和线程的定义"></a>进程和线程的定义</h2><ul>
<li>进程： 一个应用程序</li>
<li>线程： 一个进程内的多个处理部分</li>
</ul>
<p>每当启动一个进程，CPU会分配给进程一部分时间单元，进程内的线程可以调用本进程内的资源</p>
<blockquote>
<p>eg.</p>
</blockquote>
<p>对于Java程序来说，在DOS命令窗口中输入：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java HelloWorld</span><br></pre></td></tr></table></figure></p>
<p>回车后，会先启动JVM， JVM就是一个进程，之后JVM在启动一个主线程调用main方法（main就是主线程）<br>同时启动垃圾回收线程复制看护，回收垃圾</p>
<p>最起码，Java程序至少有两个线程并发，一个是<strong>垃圾回收机制</strong>， 一个是<strong>main的主线程</strong>。</p>
<hr>
<h2 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h2><ul>
<li>出生状态</li>
<li>就绪状态</li>
<li>执行状态</li>
<li>阻塞状态</li>
<li>等待状态</li>
<li>死亡状态</li>
</ul>
<hr>
<h2 id="线程的构造方法"><a href="#线程的构造方法" class="headerlink" title="线程的构造方法"></a>线程的构造方法</h2><blockquote>
<p>实现线程主要是通过两种Java提供的方式， 分别为继承Java.lang.Thread类与实现Java,lang.Runnable接口</p>
</blockquote>
<h3 id="1-继承Thread类"><a href="#1-继承Thread类" class="headerlink" title="1. 继承Thread类"></a>1. 继承Thread类</h3><p>Thread类封装好了线程运作的基本操作，通过继承Thread类实现线程，只需要覆盖Thread类里面的run方法，之后调用start()方法可以启动线程。如果没有调用start方法，那么该对象只是一个实例，不是一个真正的线程</p>
<blockquote>
<p>实际上，start方法调用了run方法,如果start方法调用一个启动了的线程，会抛出IllegalThreadStateException异常</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Thread</span><span class="params">(String name)</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Thread</span><span class="params">(Runnable target)</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Thread</span><span class="params">(Runnable target, String name)</span></span><br></pre></td></tr></table></figure>
<h3 id="2-实现Runnable接口"><a href="#2-实现Runnable接口" class="headerlink" title="2.实现Runnable接口"></a>2.实现Runnable接口</h3><p>如果你的类继承自一个不是Thread的类，但是你又想启动一个新的线程，那么这时你需要实现Runnable接口去实现。实质上，Runnable是关联了一个Thread类，实现run接口相当于实现了Thread类的run方法，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwingandThread</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> &#123;</span><br><span class="line">    <span class="type">private</span> <span class="variable">JLabel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Thread t;</span><br><span class="line">    <span class="type">private</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Container</span> <span class="variable">container</span> <span class="operator">=</span> getContentPane();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SwingandThread</span><span class="params">()</span> &#123;</span><br><span class="line">        ... <span class="comment">// 写入一些方法</span></span><br><span class="line">        t = <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                ...<span class="comment">// 实现run</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样可以调用这个Thread， 注意道写接口的时候可以直接Lambda</p>
<h3 id="3-实现Callable接口"><a href="#3-实现Callable接口" class="headerlink" title="3. 实现Callable接口"></a>3. 实现Callable接口</h3><blockquote>
<p>前两种线程创建方式都存在一个问题： </p>
<ul>
<li>假如线程执行完毕之后有一些数据需要放回，但是他们的run方法都不能返回接口</li>
</ul>
</blockquote>
<ul>
<li>JDK 5.0提供了Callable接口和FutureTask类来实现（多线程的第三种创建方式）。</li>
<li>最大的优点，可以放返回线程结束的结果<br>futureTask本身是一个runnable类的对象，实现了runnable接口</li>
</ul>
<p>步骤：</p>
<ul>
<li>定义类实现Callable接口，把Callable封装成FutureTask类</li>
<li>用FutureTask创建线程</li>
<li>调用进程</li>
<li>通过FutureTask类得到执行结果</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;  </span><br><span class="line"><span class="keyword">import</span> java.util.*;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        Callable&lt;String&gt; t = <span class="keyword">new</span> <span class="title class_">MyCallable</span>(<span class="number">100</span>);  </span><br><span class="line">        FutureTask&lt;String&gt; s = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(t);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(s);  </span><br><span class="line">        t1.start();  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="comment">// 如果线程还未执行完毕，会让出CPU等第一个线程执行完毕后往下执行。</span></span><br><span class="line">            System.out.println(s.get()); <span class="comment">// 获得返回值  </span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyCallable</span><span class="params">(<span class="type">int</span> c)</span> &#123;  </span><br><span class="line">        n = c;  </span><br><span class="line">    &#125;    <span class="comment">// 2.实现call，定义线程执行体  </span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;  </span><br><span class="line">            sum += i;  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;子线程计算结果:&quot;</span> + sum;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="操作线程的方法"><a href="#操作线程的方法" class="headerlink" title="操作线程的方法"></a>操作线程的方法</h2><ul>
<li>run</li>
<li>start</li>
<li>String getName() : 默认是Thread-索引，主线程是”main “</li>
<li>setName(String name)</li>
<li>public static Thread currentThread() // 获取当前执行的线程对象</li>
<li>sleep()</li>
<li>public final void join().. : 让调用这个方法的线程先执行完<h3 id="1-线程的休眠"><a href="#1-线程的休眠" class="headerlink" title="1. 线程的休眠"></a>1. 线程的休眠</h3></li>
</ul>
<p>一种能调用线程的方法是调用 <strong>sleep()</strong> 方法，传入一个参数（毫秒）, 使得线程休眠</p>
<ul>
<li>sleep语法<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-线程优先调用-线程插队"><a href="#2-线程优先调用-线程插队" class="headerlink" title="2. 线程优先调用(线程插队)"></a>2. 线程优先调用(线程插队)</h3><blockquote>
<p>让调用这个方法的线程先执行完</p>
<ul>
<li>join</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;  </span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;  </span><br><span class="line"><span class="keyword">import</span> java.util.*;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        Callable&lt;String&gt; t = <span class="keyword">new</span> <span class="title class_">MyCallable</span>(<span class="number">100</span>);  </span><br><span class="line">        FutureTask&lt;String&gt; s = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(t);  </span><br><span class="line">  </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(s);  </span><br><span class="line">        t1.start();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;  </span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    t1.join(); <span class="comment">// 让t1跑完后再跑主线程  </span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">                    e.printStackTrace();  </span><br><span class="line">                &#125;            </span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;线程执行&quot;</span> + i);  </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> n;  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyCallable</span><span class="params">(<span class="type">int</span> c)</span> &#123;  </span><br><span class="line">        n = c;  </span><br><span class="line">    &#125;    <span class="comment">// 2.实现call，定义线程执行体  </span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;  </span><br><span class="line">            sum += i;  </span><br><span class="line">        &#125;        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;子线程计算结果:&quot;</span> + sum;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全*"></a>线程安全*</h2><blockquote>
<p>多个线程，同时操作同一个贡献资源的时候，可能会出现业务安全问题</p>
</blockquote>
<p>如 ：银行里一个账户有10w，两个人同时去银行取钱，都取到10w，如果操作的太快，那两个人都拿到10w，银行就亏了10w元，这可太神秘。呵呵呵呵。</p>
<h3 id="线程安全出现问题原因"><a href="#线程安全出现问题原因" class="headerlink" title="线程安全出现问题原因"></a>线程安全出现问题原因</h3><ul>
<li>存在多个线程</li>
<li>同时访问了一个共享资源</li>
<li>存在修改该共享资源</li>
</ul>
<h3 id="解决线程问题-很重要"><a href="#解决线程问题-很重要" class="headerlink" title="解决线程问题 (很重要)"></a>解决线程问题 (很重要)</h3><blockquote>
<p>核心思想： 让多个线程先后依次访问共享资源，避免出现线程安全问题</p>
</blockquote>
<p>常见方案: <strong>加锁</strong> ： 每次只允许一个线程加锁， 加锁后才能进入访问，访问完毕后自动解锁，然后其他线程才能加锁进来</p>
<h4 id="1-同步代码块"><a href="#1-同步代码块" class="headerlink" title="1. 同步代码块"></a>1. 同步代码块</h4><ul>
<li>synchronized<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(同步锁) &#123;</span><br><span class="line">    访问共享资源核心代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意道同步锁必须是唯一的一个对象（不能new， 不能new，不能new）</p>
<p>原理是， 调用后，把锁这一块内存占用，别的来了得等，等当前占用完毕后再交给下一个,延续之前取钱问题，模拟一下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">account</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawmoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123; <span class="comment">//最好用this </span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.money &gt;= money) &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;取钱成功&quot;</span>);  </span><br><span class="line">                <span class="built_in">this</span>.money -= money;  </span><br><span class="line">                System.out.println(<span class="string">&quot;当前账户剩余&quot;</span> + <span class="built_in">this</span>.money);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;余额不足&quot;</span>);  </span><br><span class="line">            &#125;       </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>锁对象选择的时候别乱选，最好是自己选择一些个新开匹配的唯一空间，或者是直接用对象的名字，或者对于实例是直接用this（推荐，且是高度面向对象）<br>对于静态方法，最好直接使用字节码（类名.class)对象作为锁对象。</p>
<h4 id="2-同步方法"><a href="#2-同步方法" class="headerlink" title="2. 同步方法"></a>2. 同步方法</h4><ul>
<li>把访问共享资源的核心方法上锁，以此保证线程安全。（HashTable用的就是同步方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">修饰符 <span class="keyword">synchronized</span> 返回值类型(形参列表) &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同步方法底层原理：</p>
<ul>
<li>底层也是有隐式对象锁，锁的范围是整个方法代码</li>
<li>如果方法是实例方法：同步方法默认用this作为锁的对象。</li>
<li>如果是静态方法：同步方法默认用类名.class作为锁的对象</li>
</ul>
<p>虽然性能差一点，但是安全</p>
<h4 id="3-Lock锁"><a href="#3-Lock锁" class="headerlink" title="3. Lock锁"></a>3. Lock锁</h4><ul>
<li>Lock锁是JDK5提供的锁操作，可以创建出一个锁对象进行加锁和解锁</li>
<li>Lock是接口，不能实例化，可以采用它的实现类ReentrantLock来构建Lock锁对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">()</span> <span class="comment">// 获得Lock锁的实现类对象</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">lock() <span class="comment">//上锁</span></span><br><span class="line">unlock() <span class="comment">//解锁</span></span><br></pre></td></tr></table></figure>
<p>继续之前例子：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;  </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">account</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(); <span class="comment">// 加上了final， 保证锁不会被撬（不然别人来个lk = null 哥们你不是炸了吗）  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawmoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;  </span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();  </span><br><span class="line">        lk.lock(); <span class="comment">// 上锁  </span></span><br><span class="line">  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.money &gt;= money) &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;取钱成功&quot;</span>);  </span><br><span class="line">                <span class="built_in">this</span>.money -= money;  </span><br><span class="line">                System.out.println(<span class="string">&quot;当前账户剩余&quot;</span> + <span class="built_in">this</span>.money);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                System.out.println(<span class="string">&quot;余额不足&quot;</span>);  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;  </span><br><span class="line">            lk.unlock(); <span class="comment">// 解锁  </span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="线程池（important"><a href="#线程池（important" class="headerlink" title="线程池（important)"></a>线程池（important)</h2><blockquote>
<p><strong>线程池就是一个可以复用线程的技术。</strong> 如果不用线程池，那每次有新的线程，都会创建一个线程，那以及其消耗性能</p>
</blockquote>
<p>工作线程<br>|<br>|<br>任务队列（只有runnable和callable接口）</p>
<h3 id="1-创建线程池"><a href="#1-创建线程池" class="headerlink" title="1. 创建线程池"></a>1. 创建线程池</h3><ul>
<li>使用ExecutorService的实现类ThreadPoolExecutor自创建一个线程池对象</li>
<li><p>使用Excutors(线程池的工具类)调用方法返回不同特点的线程池对象</p>
<h4 id="ThreadPoolExrcutor"><a href="#ThreadPoolExrcutor" class="headerlink" title="ThreadPoolExrcutor"></a>ThreadPoolExrcutor</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">int</span> corePoolSize, // 核心线程池数量</span></span><br><span class="line"><span class="params">    <span class="type">int</span> maximunPoolSize, // 最大线程数量</span></span><br><span class="line"><span class="params">    <span class="type">long</span> keepAliveTime, // 临时线程存活时间</span></span><br><span class="line"><span class="params">    TimeUnit unit, // 临时存活时间单位</span></span><br><span class="line"><span class="params">    BlockingQueue&lt;Runnable&gt; workQueue, // 指定任务队列</span></span><br><span class="line"><span class="params">    ThreadFactory threadFactort, // 指定线程工厂</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler //指定线程池的拒绝策略（太多了的处理方式）</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPool</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>, TimeUnit.SECONDS,  </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>), Executors.defaultThreadFactory(), </span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>处理任务</strong></p>
<p>ExecutorService常用方法：</p>
<ul>
<li>void execute(Runnable command) ： 执行Runnable任务</li>
<li><code>Future&lt;T&gt; submit(Callable&lt;T&gt;) task</code> : 执行Callable任务，返回任务对象</li>
<li>void shutdown() : 等全部任务执行完了之后关闭线程池</li>
<li><code>List&lt;Runnable&gt; shutdownNow()</code> : 立马关闭，停止正在执行的任务，并返回队列中未执行的任务 </li>
</ul>
<h4 id="通过Executors创建线程池"><a href="#通过Executors创建线程池" class="headerlink" title="通过Executors创建线程池"></a>通过Executors创建线程池</h4><ul>
<li>Executors是线程池的一个工具类，提供了很多静态方法返回不同的线程池对象</li>
</ul>
<p>Java通过Executors工厂类提供四种线程池，分别为：</p>
<ul>
<li>newCachedThreadPool ：创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，否则新建线程。（线程最大并发数不可控制）</li>
<li>newFixedThreadPool：创建一个固定大小的线程池，可控制线程最大并发数，超出的线程会在队列中等待。</li>
<li>newScheduledThreadPool ： 创建一个定时线程池，支持定时及周期性任务执行。</li>
<li>newSingleThreadExecutor ：创建一个单线程化的线程池，它只会用唯一的工作线程来执行任务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行。</li>
</ul>
<p>我们先创建一个统一的线程任务，方便测试四种线程池</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; is running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>newSingleThreadExecutor<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleThreadExecutorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">myRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            executorService.execute(myRunnable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;线程任务开始执行&quot;</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>输出结果<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">线程任务开始执行</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>底层实现<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 核心线程池大小=1</span></span><br><span class="line"><span class="comment"> * 最大线程池大小为1</span></span><br><span class="line"><span class="comment"> * 线程过期时间为0ms</span></span><br><span class="line"><span class="comment"> * LinkedBlockingQueue作为工作队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>从参数可以看出来，SingleThreadExecutor 相当于特殊的 FixedThreadPool，它的执行流程如下：</p>
<p>线程池中没有线程时，新建一个线程执行任务<br>有一个线程以后，将任务加入阻塞队列，不停的加<br>唯一的这一个线程不停地去队列里取任务执行<br>SingleThreadExecutor 用于串行执行任务的场景，每个任务必须按顺序执行，不需要并发执行。<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FixedThreadPoolTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">myRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            executorService.execute(myRunnable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;线程任务开始执行&quot;</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>输出结果<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">线程任务开始执行</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> is running...</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>底层实现<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 核心线程池大小=传入参数</span></span><br><span class="line"><span class="comment"> * 最大线程池大小为传入参数</span></span><br><span class="line"><span class="comment"> * 线程过期时间为0ms</span></span><br><span class="line"><span class="comment"> * LinkedBlockingQueue作为工作队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>可以看到，FixedThreadPool 的核心线程数和最大线程数都是指定值，也就是说当线程池中的线程数超过核心线程数后，任务都会被放到阻塞队列中。</p>
<p>此外 keepAliveTime 为 0，也就是多余的空余线程会被立即终止（由于这里没有多余线程，这个参数也没什么意义了）。</p>
<p>而这里选用的阻塞队列是 LinkedBlockingQueue，使用的是默认容量 Integer.MAX_VALUE，相当于没有上限。</p>
<p>因此这个线程池执行任务的流程如下：</p>
<p>线程数少于核心线程数，也就是设置的线程数时，新建线程执行任务<br>线程数等于核心线程数后，将任务加入阻塞队列<br>由于队列容量非常大，可以一直加<br>执行完任务的线程反复去队列中取任务执行<br>FixedThreadPool 用于负载比较重的服务器，为了资源的合理利用，需要限制当前线程数量。<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedThreadPoolTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">myRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            executorService.execute(myRunnable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;线程任务开始执行&quot;</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>输出结果</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">线程任务开始执行</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> is running...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>底层实现<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  核心线程池大小=0</span></span><br><span class="line"><span class="comment"> *  最大线程池大小为Integer.MAX_VALUE</span></span><br><span class="line"><span class="comment"> *  线程过期时间为60s</span></span><br><span class="line"><span class="comment"> *  使用SynchronousQueue作为工作队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>可以看到，CachedThreadPool 没有核心线程，非核心线程数无上限，也就是全部使用外包，但是每个外包空闲的时间只有 60 秒，超过后就会被回收。</p>
<p>CachedThreadPool 使用的队列是 SynchronousQueue，这个队列的作用就是传递任务，并不会保存。</p>
<p>因此当提交任务的速度大于处理任务的速度时，每次提交一个任务，就会创建一个线程。极端情况下会创建过多的线程，耗尽 CPU 和内存资源。</p>
<p>它的执行流程如下：</p>
<p>没有核心线程，直接向 SynchronousQueue 中提交任务<br>如果有空闲线程，就去取出任务执行；如果没有空闲线程，就新建一个<br>执行完任务的线程有 60 秒生存时间，如果在这个时间内可以接到新任务，就可以继续活下去，否则就拜拜<br>由于空闲 60 秒的线程会被终止，长时间保持空闲的 CachedThreadPool 不会占用任何资源。<br>CachedThreadPool 用于并发执行大量短期的小任务，或者是负载较轻的服务器。<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledThreadPoolTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">3</span>);</span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">myRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 参数1:目标对象,参数2:隔多长时间开始执行线程,参数3:执行周期,参数4:时间单位</span></span><br><span class="line">            scheduledExecutorService.scheduleAtFixedRate(myRunnable, <span class="number">1</span>, <span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;线程任务开始执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>输出结果<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">线程任务开始执行</span><br><span class="line"><span class="comment">// 打印【线程任务开始执行】后1秒输出</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> is running...</span><br><span class="line"><span class="comment">// 2秒后输出</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> is running...</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> is running...</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>底层实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 核心线程池大小=传入参数</span></span><br><span class="line"><span class="comment"> * 最大线程池大小为Integer.MAX_VALUE</span></span><br><span class="line"><span class="comment"> * 线程过期时间为0ms</span></span><br><span class="line"><span class="comment"> * DelayedWorkQueue作为工作队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ScheduledThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS,</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">DelayedWorkQueue</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ScheduledThreadPoolExecutor 的执行流程如下：</p>
<p>添加一个任务<br>线程池中的线程从 DelayQueue 中取任务<br>然后执行任务<br>具体执行任务的步骤也比较复杂：</p>
<p>线程从 DelayQueue 中获取 time 大于等于当前时间的 ScheduledFutureTask</p>
<p>执行完后修改这个 task 的 time 为下次被执行的时间</p>
<p>然后再把这个 task 放回队列中</p>
<p>ScheduledThreadPoolExecutor 用于需要多个后台线程执行周期任务，同时需要限制线程数量的场景。</p>
<p>Executors和ThreaPoolExecutor创建线程池的区别<br>Executors 各个方法的弊端：</p>
<p>newFixedThreadPool 和 newSingleThreadExecutor:<br>主要问题是堆积的请求处理队列可能会耗费非常大的内存，甚至 OOM。<br>newCachedThreadPool 和 newScheduledThreadPool:<br>主要问题是线程数最大数是 Integer.MAX_VALUE，可能会创建数量非常多的线程，甚至 OOM。<br>ThreaPoolExecutor</p>
<p>创建线程池方式只有一种，就是走它的构造函数，参数自己指定</p>
<blockquote>
<p>大型并发系统中使用Executors如果不注意可能会出现系统风险。</p>
<h3 id="线程池注意事项："><a href="#线程池注意事项：" class="headerlink" title="线程池注意事项："></a>线程池注意事项：</h3></blockquote>
<ul>
<li><p>什么时候创建临时线程？<br>新任务提交时发现核心线程都在忙，任务队列也满了，并且可以创建临时线程，此时才会创建临时线程</p>
</li>
<li><p>核心线程和临时线程都在忙，任务队列也满了，新的任务过来的时候才会拒绝任务</p>
</li>
</ul>
<blockquote>
<p>任务拒绝策略：</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>策略</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ThreadPoolExecutor.AbortPolicy()</td>
<td>丢弃任务并抛出RejectedExecutionExeception异常，<strong>是默认的策略</strong></td>
</tr>
<tr>
<td>ThreadPoolExecutor.DiscardPolicy()</td>
<td>丢弃任务但是不抛出异常，不推荐</td>
</tr>
<tr>
<td>ThreadPoolExecutor.DiscardOldestPolicy()</td>
<td>丢弃队列中等待最久的任务，把当前任务加入队列</td>
</tr>
<tr>
<td>ThreadPoolExecutor.CallerRunsPolicy()</td>
<td>由主线程负责调用任务的run()方法从而绕过线程池直接执行</td>
</tr>
</tbody>
</table>
</div>
<h2 id="多线程实际案例与遇到的问题"><a href="#多线程实际案例与遇到的问题" class="headerlink" title="多线程实际案例与遇到的问题"></a>多线程实际案例与遇到的问题</h2><blockquote>
<p>写一个抢红包程序，一共200个红包，100个员工去抢，抢完了之后排序输出金额</p>
</blockquote>
<p>Main:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line"><span class="keyword">import</span> java.util.List;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        <span class="type">RedPool</span> <span class="variable">rd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedPool</span>();  </span><br><span class="line">        List&lt;peo&gt; p = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">&quot;总红包数: &quot;</span> + rd.B.size());  </span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 创建 100 个线程  </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;  </span><br><span class="line">            p.add(<span class="keyword">new</span> <span class="title class_">peo</span>(i, rd));  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 启动所有线程  </span></span><br><span class="line">        <span class="keyword">for</span> (peo thread : p) &#123;  </span><br><span class="line">            thread.start();  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 等待所有线程完成  </span></span><br><span class="line">        <span class="keyword">for</span> (peo thread : p) &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                thread.join();  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;  </span><br><span class="line">                e.printStackTrace();  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="comment">// 线程执行完毕后进行排序  </span></span><br><span class="line">        p.sort((a, b) -&gt; Double.compare(b.money, a.money)); <span class="comment">// 从大到小排序  </span></span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">&quot;-------------游戏结束-------------&quot;</span>);  </span><br><span class="line">        <span class="keyword">for</span> (peo person : p) &#123;  </span><br><span class="line">            System.out.println(<span class="string">&quot;用户 &quot;</span> + person.id + <span class="string">&quot; 总共抢到了 &quot;</span> + person.money);  </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Peo:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">peo</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> money;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> id;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedPool rd;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">peo</span><span class="params">(<span class="type">int</span> id, RedPool r)</span> &#123;  </span><br><span class="line">        <span class="built_in">this</span>.id = id;  </span><br><span class="line">        <span class="built_in">this</span>.money = <span class="number">0</span>;  </span><br><span class="line">        <span class="built_in">this</span>.rd = r;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  </span><br><span class="line">            RedPool.bao selectedBao;  </span><br><span class="line">            <span class="keyword">synchronized</span> (rd.B) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (rd.B.isEmpty()) &#123;  </span><br><span class="line">                    <span class="keyword">break</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> r.nextInt(rd.B.size()); <span class="comment">// 随机选红包  </span></span><br><span class="line">                selectedBao = rd.B.get(idx);  </span><br><span class="line">                rd.B.remove(idx); <span class="comment">// 只同步这个操作  </span></span><br><span class="line">            &#125;  <span class="comment">// 🔥 释放锁，让其他线程有机会进入  </span></span><br><span class="line">  </span><br><span class="line">            <span class="comment">// 处理金额（这部分不需要锁）  </span></span><br><span class="line">            <span class="built_in">this</span>.money += selectedBao.money();  </span><br><span class="line">            System.out.println(<span class="string">&quot;用户 &quot;</span> + <span class="built_in">this</span>.id + <span class="string">&quot; 抢到了 &quot;</span> + selectedBao.money());  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意道在处理加锁的时候，如果加锁的范围太大，比如加到了处理金额部分，那么会出现bug，某个用户拿到了第一次进入锁的机会，就会把所有的钱全部抢完（因为把所有逻辑结束后他又开始继续枪锁使得别的线程无法run)</p>
<p>RedPool:<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;  </span><br><span class="line"><span class="keyword">import</span> java.util.List;  </span><br><span class="line"><span class="keyword">import</span> java.util.Random;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedPool</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TOT</span> <span class="operator">=</span> <span class="number">200</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">now</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">small</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> List&lt;bao&gt; B = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">f</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">// 解决可见性问题  </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedPool</span><span class="params">()</span> &#123;  </span><br><span class="line">        pushr();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushr</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">while</span> (now &lt; TOT) &#123; <span class="comment">// 用循环代替递归，防止栈溢出  </span></span><br><span class="line">            now++;  </span><br><span class="line">            <span class="type">int</span> <span class="variable">g</span> <span class="operator">=</span> <span class="number">1</span> + (<span class="type">int</span>) (Math.random() * <span class="number">2</span>);  </span><br><span class="line">            <span class="keyword">if</span> (g == <span class="number">1</span> &amp;&amp; small &lt; <span class="number">160</span>) &#123;  </span><br><span class="line">                B.add(<span class="keyword">new</span> <span class="title class_">bao</span>(now, <span class="number">1</span> + Math.random() * <span class="number">30</span>));  </span><br><span class="line">                small++; <span class="comment">// small 需要增加，否则可能超出 160 限制  </span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                B.add(<span class="keyword">new</span> <span class="title class_">bao</span>(now, <span class="number">31</span> + Math.random() * <span class="number">70</span>));  </span><br><span class="line">            &#125;        </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">bao</span><span class="params">(<span class="type">int</span> id, <span class="type">double</span> money)</span> &#123;&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>异常处理</title>
    <url>/2025/02/03/%E9%9B%86%E5%90%88%E7%B1%BB/</url>
    <content><![CDATA[<h2 id="1-Collection类"><a href="#1-Collection类" class="headerlink" title="1. Collection类"></a>1. Collection类</h2><p><code>Collection</code> 接口是 Java 集合框架中的根接口之一，定义了所有集合类共有的基本操作和行为。它位于 <code>java.util</code> 包中，继承自 <code>Iterable</code> 接口，因此所有实现了 <code>Collection</code> 的类都可以使用增强 for 循环进行遍历。</p>
<hr>
<h3 id="主要特点和方法"><a href="#主要特点和方法" class="headerlink" title="主要特点和方法"></a><strong>主要特点和方法</strong></h3><ul>
<li><p><strong>基础操作</strong>：</p>
<ul>
<li><code>add(E e)</code>：向集合中添加一个元素。</li>
<li><code>remove(Object o)</code>：从集合中删除指定的元素。</li>
<li><code>clear()</code>：清空集合中的所有元素。</li>
<li><code>size()</code>：返回集合中元素的数量。</li>
<li><code>isEmpty()</code>：判断集合是否为空。</li>
<li><code>contains(Object o)</code>：判断集合中是否包含某个元素。</li>
</ul>
</li>
<li><p><strong>遍历功能</strong>：</p>
<ul>
<li>继承自 <code>Iterable</code> 的 <code>iterator()</code> 方法，可以获取一个迭代器遍历集合中的元素。</li>
<li>从 Java 8 开始，还可以通过 <code>stream()</code> 方法使用 Stream API 进行流式操作。</li>
</ul>
</li>
<li><p><strong>批量操作</strong>：</p>
<ul>
<li><code>addAll(Collection&lt;? extends E&gt; c)</code>：将指定集合中的所有元素添加到当前集合中。</li>
<li><code>removeAll(Collection&lt;?&gt; c)</code>：删除当前集合中包含在指定集合中的所有元素。</li>
<li><code>retainAll(Collection&lt;?&gt; c)</code>：保留当前集合中与指定集合共有的元素。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a><strong>注意事项</strong></h3><ul>
<li><p><strong>抽象性质</strong>：<br>  <code>Collection</code> 接口不能被直接实例化，而是由其子接口（如 <code>List</code>、<code>Set</code>、<code>Queue</code> 等）来具体实现。</p>
</li>
<li><p><strong>无索引访问</strong>：<br>  <code>Collection</code> 接口没有定义基于索引的访问方法（例如 <code>get(int index)</code>），如果需要索引访问，可以考虑使用 <code>List</code> 接口及其实现类（如 <code>ArrayList</code>）。</p>
</li>
<li><p><strong>扩展性</strong>：<br>  所有 Java 集合类都遵循 <code>Collection</code> 接口定义的契约，这使得集合类之间可以进行通用的编程，而不用关注具体的实现细节。</p>
</li>
</ul>
<hr>
<h2 id="2-List"><a href="#2-List" class="headerlink" title="2. List"></a>2. List</h2><ul>
<li>get(int index) : 返回第index个元素</li>
<li>set(int index, Object obj) : 把第index个元素设置成obj</li>
</ul>
<ul>
<li><p><strong>有序性</strong>：<br>  <code>List</code> 中的元素按照插入顺序排列，开发者可以通过索引（从 0 开始）来访问、插入或删除元素。</p>
</li>
<li><p><strong>允许重复</strong>：<br>  与 <code>Set</code> 不同，<code>List</code> 允许集合中存在重复元素。</p>
</li>
<li><p><strong>扩展 Collection 接口</strong>：<br>  除了 <code>Collection</code> 中的基本操作外，<code>List</code> 还提供了与索引有关的操作，如 <code>get(int index)</code>、<code>set(int index, E element)</code>、<code>add(int index, E element)</code> 和 <code>remove(int index)</code>。</p>
</li>
</ul>
<hr>
<h3 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a>主要方法</h3><p>除了 <code>Collection</code> 提供的常用方法，<code>List</code> 接口还增加了以下与索引相关的操作：</p>
<ul>
<li><p><strong>添加和插入</strong></p>
<ul>
<li><code>boolean add(E e)</code>：在列表末尾追加元素。</li>
<li><code>void add(int index, E element)</code>：在指定位置插入元素，其后的元素依次后移。</li>
</ul>
</li>
<li><p><strong>访问元素</strong></p>
<ul>
<li><code>E get(int index)</code>：返回指定位置的元素。</li>
<li><code>E set(int index, E element)</code>：替换指定位置的元素，并返回原来的值。</li>
</ul>
</li>
<li><p><strong>删除元素</strong></p>
<ul>
<li><code>E remove(int index)</code>：删除指定位置的元素，并返回被删除的元素。</li>
<li><code>boolean remove(Object o)</code>：删除第一次出现的指定对象（若存在）。</li>
</ul>
</li>
<li><p><strong>查找元素</strong></p>
<ul>
<li><code>int indexOf(Object o)</code>：返回元素第一次出现的位置，如果不存在返回 -1。</li>
<li><code>int lastIndexOf(Object o)</code>：返回元素最后一次出现的位置。</li>
</ul>
</li>
<li><p><strong>子列表操作</strong></p>
<ul>
<li><code>List&lt;E&gt; subList(int fromIndex, int toIndex)</code>：返回列表中指定范围的视图，视图中的修改会反映在原列表上。</li>
</ul>
</li>
<li><p><strong>列表迭代器</strong></p>
<ul>
<li><code>ListIterator&lt;E&gt; listIterator()</code>：返回一个列表迭代器，可双向遍历列表，并在遍历过程中进行修改操作。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="常见的实现类"><a href="#常见的实现类" class="headerlink" title="常见的实现类"></a>常见的实现类</h3><p>Java 提供了多个 <code>List</code> 接口的实现，每种实现都有各自的特点和适用场景：</p>
<h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a><strong>ArrayList</strong></h3><ul>
<li><strong>底层实现</strong>：动态数组</li>
<li><strong>特点</strong>：<ul>
<li>随机访问非常快（时间复杂度 O(1)）</li>
<li>插入和删除（尤其是中间位置）可能较慢，因为需要移动数组元素</li>
<li>默认初始容量通常为 10，自动扩容时采用一定的增长策略</li>
</ul>
</li>
<li><strong>适用场景</strong>：频繁读取，较少修改（尤其是尾部添加）的场景</li>
</ul>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a><strong>LinkedList</strong></h3><ul>
<li><strong>底层实现</strong>：双向链表</li>
<li><strong>特点</strong>：<ul>
<li>插入和删除操作快（特别是在列表两端或已知节点处进行操作）</li>
<li>随机访问较慢（需要遍历节点，时间复杂度 O(n)）</li>
<li>除了作为 <code>List</code>，它还实现了 <code>Deque</code> 接口，适合当作队列或双端队列使用</li>
</ul>
</li>
<li><strong>适用场景</strong>：频繁在中间插入或删除元素的场景</li>
</ul>
<h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a><strong>Vector</strong></h3><ul>
<li><strong>底层实现</strong>：动态数组</li>
<li><strong>特点</strong>：<ul>
<li>与 <code>ArrayList</code> 类似，但所有方法都是同步的，因此线程安全</li>
<li>由于同步开销，性能相对较低</li>
<li>作为较早期的集合类，现多推荐使用 <code>ArrayList</code>（如果线程安全需求，则可考虑 <code>Collections.synchronizedList</code> 或 <code>CopyOnWriteArrayList</code> 等）</li>
</ul>
</li>
<li><strong>适用场景</strong>：需要线程安全且对性能要求不太苛刻的场景</li>
</ul>
<hr>
<h3 id="性能与使用注意"><a href="#性能与使用注意" class="headerlink" title="性能与使用注意"></a>性能与使用注意</h3><ul>
<li><p><strong>随机访问 vs 插入删除</strong></p>
<ul>
<li>如果你的应用需要频繁通过索引随机访问元素，建议使用 <code>ArrayList</code>。</li>
<li>如果需要在列表中间进行大量插入和删除操作，<code>LinkedList</code> 会更高效。</li>
</ul>
</li>
<li><p><strong>线程安全问题</strong></p>
<ul>
<li>默认情况下，<code>ArrayList</code> 和 <code>LinkedList</code> 都不是线程安全的。如果需要线程安全的列表，可以使用 <code>Collections.synchronizedList(new ArrayList&lt;&gt;())</code> 或选择并发集合如 <code>CopyOnWriteArrayList</code>（适合读多写少场景）。</li>
</ul>
</li>
<li><p><strong>内存占用</strong></p>
<ul>
<li><code>ArrayList</code> 在扩容时可能会分配较大的连续内存块，而 <code>LinkedList</code> 每个节点都需要额外的指针空间。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-Set"><a href="#3-Set" class="headerlink" title="3. Set"></a>3. Set</h2><h4 id="3-1-HashSet"><a href="#3-1-HashSet" class="headerlink" title="3.1 HashSet"></a>3.1 HashSet</h4><p>用哈希表实现， 和cpp un_orderset一样,无序， $O(1)$ 插入查询。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">se</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;E&gt;();</span><br><span class="line">se.add(??);</span><br><span class="line"></span><br><span class="line">sout  se.contain(???) ;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-TreeSet"><a href="#3-2-TreeSet" class="headerlink" title="3.2 TreeSet"></a>3.2 TreeSet</h3><p>使用红黑树实现， 和cpp普通set一样, $O(logn)$ 插入查询<br>存储的元素必须实现 <code>Comparable</code> 接口，或者在构造时提供 <code>Comparator</code>。默认是按第一个元素的大小从小到大排序额，<br>Comparable 接口里面的compareTo(Object O) 用于排列, 和Struct 里面的bool operator &gt; 一样</p>
<ul>
<li>comparator() : 返回比较器，最普通的NULL</li>
<li>first() 最小的元素</li>
<li>last()</li>
<li>headSet()</li>
<li>tailSet()</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Record</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Record</span><span class="params">(String name, <span class="type">int</span> score)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;: &quot;</span> + score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeSetExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 TreeSet 并提供自定义比较器，按 score 降序排列</span></span><br><span class="line">        TreeSet&lt;Record&gt; recordSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Record&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Record r1, Record r2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> Integer.compare(r2.score, r1.score); <span class="comment">// 降序排序</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加数据</span></span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">85</span>));</span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">92</span>));</span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Charlie&quot;</span>, <span class="number">78</span>));</span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;David&quot;</span>, <span class="number">92</span>)); <span class="comment">// score 相同，Comparator 需要处理</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历 TreeSet</span></span><br><span class="line">        <span class="keyword">for</span> (Record r : recordSet) &#123;</span><br><span class="line">            System.out.println(r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Lambda：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeSetLambdaExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 Lambda 表达式定义 Comparator</span></span><br><span class="line">        TreeSet&lt;Record&gt; recordSet = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(</span><br><span class="line">            (r1, r2) -&gt; r2.score != r1.score ? Integer.compare(r2.score, r1.score) : r1.name.compareTo(r2.name)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加数据</span></span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">85</span>));</span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">92</span>));</span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;Charlie&quot;</span>, <span class="number">78</span>));</span><br><span class="line">        recordSet.add(<span class="keyword">new</span> <span class="title class_">Record</span>(<span class="string">&quot;David&quot;</span>, <span class="number">92</span>)); <span class="comment">// 处理分数相同的情况</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历 TreeSet</span></span><br><span class="line">        recordSet.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>Map没有继承Collection接口。</p>
<ul>
<li>put(key, value)</li>
<li>containsKey(key)</li>
<li>containsValue(Object value)</li>
<li>get(Object key)</li>
<li>keySet(): 返回key值形成的集合</li>
<li>values() : 返回values形成的Collections集合</li>
<li>entrySet() : 返回一个Map.Entry类型的Set， 里面有getKey和getValue方法（Map.Entry)</li>
<li>merge(T Key, T Value, Operation) ： Ope可以使用Lambda， 对已经有的Key进行合并操作</li>
</ul>
<hr>
<ul>
<li><code>V getOrDefault(Object key, V defaultValue)</code>：获取键对应的值，如果不存在则返回默认值。</li>
<li><code>void forEach(BiConsumer&lt;? super K, ? super V&gt; action)</code>：遍历 Map 中所有键值对。</li>
<li><code>V computeIfAbsent(K key, Function&lt;? super K, ? extends V&gt; mappingFunction)</code>：如果键不存在，则通过给定函数成一个值并插入。   </li>
<li><code>V computeIfPresent(K key, BiFunction&lt;? super K, ? super V, ? extends V&gt; remappingFunction)</code>：如果键存在，则对其值进行重新计算。</li>
<li><code>V merge(K key, V value, BiFunction&lt;? super V, ? super V, ? extends V&gt; remappingFunction)</code>：合并键对应的值，可用于统计和聚合操作。</li>
</ul>
<hr>
<h3 id="常见实现类"><a href="#常见实现类" class="headerlink" title="常见实现类"></a>常见实现类</h3><p>Java 提供了多种 Map 的实现，根据不同需求可以选择合适的实现类：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>实现类</th>
<th>底层结构</th>
<th>排序/顺序</th>
<th>线程安全性</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HashMap</strong></td>
<td>哈希表</td>
<td>无序</td>
<td>非线程安全</td>
<td>允许 null 键和 null 值</td>
</tr>
<tr>
<td><strong>LinkedHashMap</strong></td>
<td>哈希表 + 链表</td>
<td>维护插入顺序（或访问顺序）</td>
<td>非线程安全</td>
<td>相比 HashMap，多了顺序维护，性能略低</td>
</tr>
<tr>
<td><strong>TreeMap</strong></td>
<td>红黑树</td>
<td>按键的自然顺序或 Comparator 排序</td>
<td>非线程安全</td>
<td>键必须实现 Comparable 接口或提供 Comparator</td>
</tr>
<tr>
<td><strong>Hashtable</strong></td>
<td>哈希表</td>
<td>无序</td>
<td>线程安全（同步方法）</td>
<td>不允许 null 键和 null 值（较老的实现，不推荐使用）</td>
</tr>
<tr>
<td><strong>ConcurrentHashMap</strong></td>
<td>分段锁哈希表</td>
<td>无序</td>
<td>线程安全（高并发）</td>
<td>高效支持并发操作，适用于多线程环境</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="Java-Map-与-C-STL-Map-的对比"><a href="#Java-Map-与-C-STL-Map-的对比" class="headerlink" title="Java Map 与 C++ STL Map 的对比"></a>Java Map 与 C++ STL Map 的对比</h3><div class="table-container">
<table>
<thead>
<tr>
<th>特性</th>
<th>C++ STL Map</th>
<th>Java Map</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>接口设计</strong></td>
<td>容器类，通常直接作为类使用</td>
<td>接口（Map 接口）＋具体实现类</td>
</tr>
<tr>
<td><strong>排序/无序</strong></td>
<td><code>std::map</code>（红黑树实现，自动排序），<code>std::unordered_map</code>（哈希表实现）</td>
<td>TreeMap（红黑树实现，排序），HashMap（哈希表实现，无序）</td>
</tr>
<tr>
<td><strong>键允许 null</strong></td>
<td>不支持 null 键（C++ 中 null 不适用）</td>
<td>HashMap 允许一个 null 键；TreeMap 不允许 null 键</td>
</tr>
<tr>
<td><strong>访问方式</strong></td>
<td>使用 <code>operator[]</code> 和 <code>at()</code> 方法</td>
<td>使用 <code>get()</code> 和 <code>put()</code> 方法，不支持下标操作</td>
</tr>
<tr>
<td><strong>迭代器</strong></td>
<td>提供双向迭代器（对于有序 map）</td>
<td>提供 keySet()/entrySet() 等视图，通常用 foreach 遍历</td>
</tr>
</tbody>
</table>
</div>
<hr>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><p>下面是一个简单的示例，展示如何使用 Map 接口及其常用方法（以 HashMap 为例），并演示如何遍历 Map 的不同视图：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个 HashMap 实例</span></span><br><span class="line">        Map&lt;String, Integer&gt; scoreMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 插入键值对</span></span><br><span class="line">        scoreMap.put(<span class="string">&quot;Alice&quot;</span>, <span class="number">85</span>);</span><br><span class="line">        scoreMap.put(<span class="string">&quot;Bob&quot;</span>, <span class="number">92</span>);</span><br><span class="line">        scoreMap.put(<span class="string">&quot;Charlie&quot;</span>, <span class="number">78</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">aliceScore</span> <span class="operator">=</span> scoreMap.get(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Alice 的分数: &quot;</span> + aliceScore);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查键是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (scoreMap.containsKey(<span class="string">&quot;David&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;David 存在于 Map 中&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;David 不存在于 Map 中&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 getOrDefault 方法</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">davidScore</span> <span class="operator">=</span> scoreMap.getOrDefault(<span class="string">&quot;David&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;David 的分数（默认值为 0）: &quot;</span> + davidScore);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 遍历 Map：通过 entrySet() 遍历键值对</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : scoreMap.entrySet()) &#123;</span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot; -&gt; &quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 Lambda 表达式遍历 Map</span></span><br><span class="line">        scoreMap.forEach((name, score) -&gt; </span><br><span class="line">            System.out.println(<span class="string">&quot;Lambda 遍历: &quot;</span> + name + <span class="string">&quot; -&gt; &quot;</span> + score)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 删除某个键值对</span></span><br><span class="line">        scoreMap.remove(<span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;删除 Charlie 后，Map 中的元素: &quot;</span> + scoreMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>说明：</strong></p>
<ul>
<li><strong>put()</strong>：插入或更新键值对。</li>
<li><strong>get() / getOrDefault()</strong>：获取指定键的值。</li>
<li><strong>containsKey()</strong>：检查某个键是否存在。</li>
<li><strong>remove()</strong>：删除指定键的映射。</li>
<li><strong>entrySet()、keySet()、values()</strong>：提供对 Map 内部数据的视图，方便遍历。</li>
</ul>
<hr>
<h2 id="6-进阶：Map-的默认方法（Java-8-）"><a href="#6-进阶：Map-的默认方法（Java-8-）" class="headerlink" title="6. 进阶：Map 的默认方法（Java 8+）"></a>6. 进阶：Map 的默认方法（Java 8+）</h2><p>Java 8 引入了一系列默认方法，进一步简化了 Map 的操作。例如：</p>
<ul>
<li><strong>computeIfAbsent()</strong><br>  如果指定的键不存在，则使用给定函数计算一个值并插入 Map：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">scoreMap.computeIfAbsent(<span class="string">&quot;David&quot;</span>, key -&gt; <span class="number">80</span>);  <span class="comment">// 如果 David 不存在，则赋值 80</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>merge()</strong>  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line">`scoreMap.merge(<span class="string">&quot;Alice&quot;</span>, <span class="number">5</span>, (oldVal, newVal) -&gt; oldVal + newVal);  <span class="comment">// Alice 的分数加 5`</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这些默认方法使得对 Map 的操作更加灵活和简洁。</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>about</title>
    <url>/about/index.html</url>
    <content><![CDATA[<hr>
<h3 id="关于作者"><a href="#关于作者" class="headerlink" title="关于作者"></a>关于作者</h3><ul>
<li>中国海洋大学本科生一枚。</li>
<li>本站诞生与某天心血来潮，用来分享学习中遇到的问题和算法题解总结。</li>
<li>请各路朋友多多指教 ！</li>
</ul>
<hr>
<h3 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h3><ul>
<li>微信 : a511017802</li>
<li>邮件 : 511017802@qq.com</li>
<li>博客 ：Tansuozhe1num.github.io</li>
</ul>
<hr>
]]></content>
  </entry>
  <entry>
    <title>文章分类</title>
    <url>/categories/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>tags</title>
    <url>/tags/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>哔哔一下</title>
    <url>/artitalk/index.html</url>
    <content><![CDATA[<!-- 引用 artitalk -->
<script type="text/javascript" src="https://unpkg.com/artitalk"></script>
<!-- 存放说说的容器 -->
<div id="artitalk_main"></div>
<script>
new Artitalk({
    serverURL: // Your LeanCloud site
    appId: 'kxghUXJtVZdyXBt4VLHWbXjv-gzGzoHsz', // Your LeanCloud appId
    appKey: 'kRvx5uuFfMszFghHFIU8HTyY', // Your LeanCloud appKey
    color1: 'linear-gradient(45deg,rgba(109,208,242,0.75) 15%,rgba(245,154,190,0.75) 85%)',
    color2: 'linear-gradient(45deg,rgba(109,208,242,0.75) 15%,rgba(245,154,190,0.75) 85%)',
})
</script>]]></content>
  </entry>
  <entry>
    <title>comment</title>
    <url>/comment/index.html</url>
    <content><![CDATA[]]></content>
  </entry>
</search>
